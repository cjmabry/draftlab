<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>nfldb API documentation</title>
    <meta name="description" content="Module nfldb provides command line tools and a library for maintaining
and querying a relational dat..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#nfldb.__version__">__version__</a></li>
    <li class="mono"><a href="#nfldb.api_version">api_version</a></li>
    <li class="mono"><a href="#nfldb.stat_categories">stat_categories</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#nfldb.QueryOR">QueryOR</a></li>
    <li class="mono"><a href="#nfldb.aggregate">aggregate</a></li>
    <li class="mono"><a href="#nfldb.connect">connect</a></li>
    <li class="mono"><a href="#nfldb.current">current</a></li>
    <li class="mono"><a href="#nfldb.guess_position">guess_position</a></li>
    <li class="mono"><a href="#nfldb.now">now</a></li>
    <li class="mono"><a href="#nfldb.player_search">player_search</a></li>
    <li class="mono"><a href="#nfldb.schema_version">schema_version</a></li>
    <li class="mono"><a href="#nfldb.set_timezone">set_timezone</a></li>
    <li class="mono"><a href="#nfldb.standard_team">standard_team</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Category">Category</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Category.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Clock">Clock</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Clock.from_str">from_str</a></li>
    <li class="mono"><a href="#nfldb.Clock.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Clock.add_seconds">add_seconds</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Drive">Drive</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Drive.fill_games">fill_games</a></li>
    <li class="mono"><a href="#nfldb.Drive.from_id">from_id</a></li>
    <li class="mono"><a href="#nfldb.Drive.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Drive.from_row_dict">from_row_dict</a></li>
    <li class="mono"><a href="#nfldb.Drive.from_row_tuple">from_row_tuple</a></li>
    <li class="mono"><a href="#nfldb.Drive.score">score</a></li>
    <li class="mono"><a href="#nfldb.Drive.sql_fields">sql_fields</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Enums">Enums</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.FieldPosition">FieldPosition</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.FieldPosition.from_str">from_str</a></li>
    <li class="mono"><a href="#nfldb.FieldPosition.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Game">Game</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Game.from_id">from_id</a></li>
    <li class="mono"><a href="#nfldb.Game.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Game.from_row_dict">from_row_dict</a></li>
    <li class="mono"><a href="#nfldb.Game.from_row_tuple">from_row_tuple</a></li>
    <li class="mono"><a href="#nfldb.Game.plays_range">plays_range</a></li>
    <li class="mono"><a href="#nfldb.Game.score_at_time">score_at_time</a></li>
    <li class="mono"><a href="#nfldb.Game.score_in_plays">score_in_plays</a></li>
    <li class="mono"><a href="#nfldb.Game.sql_fields">sql_fields</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Play">Play</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Play.fill_drives">fill_drives</a></li>
    <li class="mono"><a href="#nfldb.Play.from_id">from_id</a></li>
    <li class="mono"><a href="#nfldb.Play.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Play.from_row_dict">from_row_dict</a></li>
    <li class="mono"><a href="#nfldb.Play.from_row_tuple">from_row_tuple</a></li>
    <li class="mono"><a href="#nfldb.Play.score">score</a></li>
    <li class="mono"><a href="#nfldb.Play.sql_fields">sql_fields</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.PlayPlayer">PlayPlayer</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.PlayPlayer.fill_players">fill_players</a></li>
    <li class="mono"><a href="#nfldb.PlayPlayer.fill_plays">fill_plays</a></li>
    <li class="mono"><a href="#nfldb.PlayPlayer.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.PlayPlayer.from_row_dict">from_row_dict</a></li>
    <li class="mono"><a href="#nfldb.PlayPlayer.from_row_tuple">from_row_tuple</a></li>
    <li class="mono"><a href="#nfldb.PlayPlayer.sql_fields">sql_fields</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Player">Player</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Player.from_id">from_id</a></li>
    <li class="mono"><a href="#nfldb.Player.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Player.from_row_dict">from_row_dict</a></li>
    <li class="mono"><a href="#nfldb.Player.from_row_tuple">from_row_tuple</a></li>
    <li class="mono"><a href="#nfldb.Player.sql_fields">sql_fields</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.PossessionTime">PossessionTime</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.PossessionTime.from_str">from_str</a></li>
    <li class="mono"><a href="#nfldb.PossessionTime.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Query">Query</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Query.__init__">__init__</a></li>
    <li class="mono"><a href="#nfldb.Query.aggregate">aggregate</a></li>
    <li class="mono"><a href="#nfldb.Query.andalso">andalso</a></li>
    <li class="mono"><a href="#nfldb.Query.as_aggregate">as_aggregate</a></li>
    <li class="mono"><a href="#nfldb.Query.as_drives">as_drives</a></li>
    <li class="mono"><a href="#nfldb.Query.as_games">as_games</a></li>
    <li class="mono"><a href="#nfldb.Query.as_play_players">as_play_players</a></li>
    <li class="mono"><a href="#nfldb.Query.as_players">as_players</a></li>
    <li class="mono"><a href="#nfldb.Query.as_plays">as_plays</a></li>
    <li class="mono"><a href="#nfldb.Query.drive">drive</a></li>
    <li class="mono"><a href="#nfldb.Query.game">game</a></li>
    <li class="mono"><a href="#nfldb.Query.limit">limit</a></li>
    <li class="mono"><a href="#nfldb.Query.orelse">orelse</a></li>
    <li class="mono"><a href="#nfldb.Query.play">play</a></li>
    <li class="mono"><a href="#nfldb.Query.play_player">play_player</a></li>
    <li class="mono"><a href="#nfldb.Query.player">player</a></li>
    <li class="mono"><a href="#nfldb.Query.show_where">show_where</a></li>
    <li class="mono"><a href="#nfldb.Query.sort">sort</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Team">Team</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Team.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nfldb.Tx">Tx</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nfldb.Tx.__init__">__init__</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">nfldb</span> module</h1>
  <p>Module nfldb provides command line tools and a library for maintaining
and querying a relational database of play-by-play NFL data. The data
is imported from <a href="https://github.com/BurntSushi/nflgame">nflgame</a>,
which in turn gets its data from a JSON feed on NFL.com's live
GameCenter pages. This data includes, but is not limited to, game
schedules, scores, rosters and play-by-play data for every preseason,
regular season and postseason game dating back to 2009.</p>
<p>Here is a small teaser that shows how to use nfldb to find the top five
passers in the 2012 regular season:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">nfldb</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="n">q</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;passing_yds&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">as_aggregate</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">pp</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">passing_yds</span>
</pre></div>


<p>And the output is:</p>
<div class="codehilite"><pre>[andrew@Liger ~] python2 top-five.py
Drew Brees (NO, QB) 5177
Matthew Stafford (DET, QB) 4965
Tony Romo (DAL, QB) 4903
Tom Brady (NE, QB) 4799
Matt Ryan (ATL, QB) 4719
</pre></div>


<p>In theory, both <code>nfldb</code> and <code>nflgame</code> provide access to the same data.
The difference is in the execution. In order to search data in nflgame,
a large JSON file needs to be read from disk and loaded into Python
data structures for each game. Conversely, nfldb's data is stored in
a relational database, which can be searched and retrieved faster
than nflgame by a few orders of magnitude. Moreover, the relational
organization of data in nfldb allows for a convenient
<a href="http://goo.gl/Sd6MN2">query interface</a> to search NFL play data.</p>
<p>The database can be updated with real time data from active games by
running the <code>nfldb-update</code> script included with this module as often
as you're comfortable pinging NFL.com. (N.B. The JSON data itself only
updates every 15 seconds, so running <code>nfldb-update</code> faster than that
would be wasteful.) Roster updates are done automatically at a minimum
interval of 12 hours.</p>
<p>nfldb has <a href="http://pdoc.burntsushi.net/nfldb">comprehensive API documentation</a>
and a <a href="https://github.com/BurntSushi/nfldb/wiki">wiki with examples</a>.</p>
<p>nfldb can be used in conjunction with
<a href="https://pypi.python.org/pypi/nflvid">nflvid</a>
to
<a href="http://goo.gl/Mckaf0">search and watch NFL game footage</a>.</p>
<p>If you need help, please join us at our IRC channel <code>#nflgame</code> on
FreeNode.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb', this);">Show source &equiv;</a></p>
  <div id="source-nfldb" class="source">
    <div class="codehilite"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module nfldb provides command line tools and a library for maintaining</span>
<span class="sd">and querying a relational database of play-by-play NFL data. The data</span>
<span class="sd">is imported from [nflgame](https://github.com/BurntSushi/nflgame),</span>
<span class="sd">which in turn gets its data from a JSON feed on NFL.com&#39;s live</span>
<span class="sd">GameCenter pages. This data includes, but is not limited to, game</span>
<span class="sd">schedules, scores, rosters and play-by-play data for every preseason,</span>
<span class="sd">regular season and postseason game dating back to 2009.</span>

<span class="sd">Here is a small teaser that shows how to use nfldb to find the top five</span>
<span class="sd">passers in the 2012 regular season:</span>

<span class="sd">    #!python</span>
<span class="sd">    import nfldb</span>

<span class="sd">    db = nfldb.connect()</span>
<span class="sd">    q = nfldb.Query(db)</span>

<span class="sd">    q.game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">    for pp in q.sort(&#39;passing_yds&#39;).limit(5).as_aggregate():</span>
<span class="sd">        print pp.player, pp.passing_yds</span>

<span class="sd">And the output is:</span>

<span class="sd">    [andrew@Liger ~] python2 top-five.py</span>
<span class="sd">    Drew Brees (NO, QB) 5177</span>
<span class="sd">    Matthew Stafford (DET, QB) 4965</span>
<span class="sd">    Tony Romo (DAL, QB) 4903</span>
<span class="sd">    Tom Brady (NE, QB) 4799</span>
<span class="sd">    Matt Ryan (ATL, QB) 4719</span>

<span class="sd">In theory, both `nfldb` and `nflgame` provide access to the same data.</span>
<span class="sd">The difference is in the execution. In order to search data in nflgame,</span>
<span class="sd">a large JSON file needs to be read from disk and loaded into Python</span>
<span class="sd">data structures for each game. Conversely, nfldb&#39;s data is stored in</span>
<span class="sd">a relational database, which can be searched and retrieved faster</span>
<span class="sd">than nflgame by a few orders of magnitude. Moreover, the relational</span>
<span class="sd">organization of data in nfldb allows for a convenient</span>
<span class="sd">[query interface](http://goo.gl/Sd6MN2) to search NFL play data.</span>

<span class="sd">The database can be updated with real time data from active games by</span>
<span class="sd">running the `nfldb-update` script included with this module as often</span>
<span class="sd">as you&#39;re comfortable pinging NFL.com. (N.B. The JSON data itself only</span>
<span class="sd">updates every 15 seconds, so running `nfldb-update` faster than that</span>
<span class="sd">would be wasteful.) Roster updates are done automatically at a minimum</span>
<span class="sd">interval of 12 hours.</span>

<span class="sd">nfldb has [comprehensive API documentation](http://pdoc.burntsushi.net/nfldb)</span>
<span class="sd">and a [wiki with examples](https://github.com/BurntSushi/nfldb/wiki).</span>

<span class="sd">nfldb can be used in conjunction with</span>
<span class="sd">[nflvid](https://pypi.python.org/pypi/nflvid)</span>
<span class="sd">to</span>
<span class="sd">[search and watch NFL game footage](http://goo.gl/Mckaf0).</span>

<span class="sd">If you need help, please join us at our IRC channel `#nflgame` on</span>
<span class="sd">FreeNode.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">nfldb.db</span> <span class="kn">import</span> <span class="n">__pdoc__</span> <span class="k">as</span> <span class="n">__db_pdoc__</span>
<span class="kn">from</span> <span class="nn">nfldb.db</span> <span class="kn">import</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">connect</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">set_timezone</span><span class="p">,</span> <span class="n">schema_version</span>
<span class="kn">from</span> <span class="nn">nfldb.db</span> <span class="kn">import</span> <span class="n">Tx</span>
<span class="kn">from</span> <span class="nn">nfldb.query</span> <span class="kn">import</span> <span class="n">__pdoc__</span> <span class="k">as</span> <span class="n">__query_pdoc__</span>
<span class="kn">from</span> <span class="nn">nfldb.query</span> <span class="kn">import</span> <span class="n">aggregate</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">guess_position</span><span class="p">,</span> <span class="n">player_search</span>
<span class="kn">from</span> <span class="nn">nfldb.query</span> <span class="kn">import</span> <span class="n">Query</span><span class="p">,</span> <span class="n">QueryOR</span>
<span class="kn">from</span> <span class="nn">nfldb.team</span> <span class="kn">import</span> <span class="n">standard_team</span>
<span class="kn">from</span> <span class="nn">nfldb.types</span> <span class="kn">import</span> <span class="n">__pdoc__</span> <span class="k">as</span> <span class="n">__types_pdoc__</span>
<span class="kn">from</span> <span class="nn">nfldb.types</span> <span class="kn">import</span> <span class="n">stat_categories</span>
<span class="kn">from</span> <span class="nn">nfldb.types</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Clock</span><span class="p">,</span> <span class="n">Enums</span><span class="p">,</span> <span class="n">Drive</span><span class="p">,</span> <span class="n">FieldPosition</span><span class="p">,</span> <span class="n">Game</span>
<span class="kn">from</span> <span class="nn">nfldb.types</span> <span class="kn">import</span> <span class="n">Play</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">PlayPlayer</span><span class="p">,</span> <span class="n">PossessionTime</span><span class="p">,</span> <span class="n">Team</span>
<span class="kn">from</span> <span class="nn">nfldb.version</span> <span class="kn">import</span> <span class="n">__pdoc__</span> <span class="k">as</span> <span class="n">__version_pdoc__</span>
<span class="kn">from</span> <span class="nn">nfldb.version</span> <span class="kn">import</span> <span class="n">__version__</span>

<span class="n">__pdoc__</span> <span class="o">=</span> <span class="n">__db_pdoc__</span>
<span class="n">__pdoc__</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__pdoc__</span><span class="p">,</span> <span class="o">**</span><span class="n">__query_pdoc__</span><span class="p">)</span>
<span class="n">__pdoc__</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__pdoc__</span><span class="p">,</span> <span class="o">**</span><span class="n">__types_pdoc__</span><span class="p">)</span>
<span class="n">__pdoc__</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__pdoc__</span><span class="p">,</span> <span class="o">**</span><span class="n">__version_pdoc__</span><span class="p">)</span>


<span class="c"># Export selected identifiers from sub-modules.</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># nfldb.db</span>
    <span class="s">&#39;api_version&#39;</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span><span class="p">,</span> <span class="s">&#39;now&#39;</span><span class="p">,</span> <span class="s">&#39;set_timezone&#39;</span><span class="p">,</span> <span class="s">&#39;schema_version&#39;</span><span class="p">,</span>
    <span class="s">&#39;Tx&#39;</span><span class="p">,</span>

    <span class="c"># nfldb.query</span>
    <span class="s">&#39;aggregate&#39;</span><span class="p">,</span> <span class="s">&#39;current&#39;</span><span class="p">,</span> <span class="s">&#39;guess_position&#39;</span><span class="p">,</span> <span class="s">&#39;player_search&#39;</span><span class="p">,</span>
    <span class="s">&#39;Query&#39;</span><span class="p">,</span> <span class="s">&#39;QueryOR&#39;</span><span class="p">,</span>

    <span class="c"># nfldb.team</span>
    <span class="s">&#39;standard_team&#39;</span><span class="p">,</span>

    <span class="c"># nfldb.types</span>
    <span class="s">&#39;select_columns&#39;</span><span class="p">,</span> <span class="s">&#39;stat_categories&#39;</span><span class="p">,</span>
    <span class="s">&#39;Category&#39;</span><span class="p">,</span> <span class="s">&#39;Clock&#39;</span><span class="p">,</span> <span class="s">&#39;Enums&#39;</span><span class="p">,</span> <span class="s">&#39;Drive&#39;</span><span class="p">,</span> <span class="s">&#39;FieldPosition&#39;</span><span class="p">,</span> <span class="s">&#39;Game&#39;</span><span class="p">,</span>
    <span class="s">&#39;Play&#39;</span><span class="p">,</span> <span class="s">&#39;Player&#39;</span><span class="p">,</span> <span class="s">&#39;PlayPlayer&#39;</span><span class="p">,</span> <span class="s">&#39;PossessionTime&#39;</span><span class="p">,</span> <span class="s">&#39;Team&#39;</span><span class="p">,</span>

    <span class="c"># nfldb.version</span>
    <span class="s">&#39;__version__&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="nfldb.__version__" class="name">var <span class="ident">__version__</span></p>
      
  
    <div class="desc"><p>The version of the installed nfldb module.</p></div>
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="nfldb.api_version" class="name">var <span class="ident">api_version</span></p>
      
  
    <div class="desc"><p>The schema version that this library corresponds to. When the schema
version of the database is less than this value, <a href="#nfldb.connect"><code>connect</code></a> will
automatically update the schema to the latest version before doing
anything else.</p></div>
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="nfldb.stat_categories" class="name">var <span class="ident">stat_categories</span></p>
      
  
    <div class="desc"><p>An ordered dictionary of every statistical category available for
play-by-play data. The keys are the category identifier (e.g.,
<code>passing_yds</code>) and the values are <a href="#nfldb.Category"><code>Category</code></a> objects.</p></div>
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="nfldb.QueryOR">
    <p>def <span class="ident">QueryOR</span>(</p><p>db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a disjunctive <a href="#nfldb.Query"><code>Query</code></a> object, where every
condition is combined disjunctively. Namely, it is an alias for
<code>nfldb.Query(db, orelse=True)</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.QueryOR', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.QueryOR" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">QueryOR</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a disjunctive `nfldb.Query` object, where every</span>
<span class="sd">    condition is combined disjunctively. Namely, it is an alias for</span>
<span class="sd">    `nfldb.Query(db, orelse=True)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.aggregate">
    <p>def <span class="ident">aggregate</span>(</p><p>objs)</p>
    </div>
    

    
  
    <div class="desc"><p>Given any collection of Python objects that provide a
<code>play_players</code> attribute, <code>aggregate</code> will return a list of
<code>PlayPlayer</code> objects with statistics aggregated (summed) over each
player. (As a special case, if an element in <code>objs</code> is itself a
<a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> object, then it is used and a <code>play_players</code>
attribute is not rquired.)</p>
<p>For example, <code>objs</code> could be a mixed list of <a href="#nfldb.Game"><code>Game</code></a> and
<a href="#nfldb.Play"><code>Play</code></a> objects.</p>
<p>The order of the list returned is stable with respect to the
order of players obtained from each element in <code>objs</code>.</p>
<p>It is recommended to use <a href="#nfldb.Query.aggregate"><code>aggregate</code></a> and
<a href="#nfldb.Query.as_aggregate"><code>as_aggregate</code></a> instead of this function since summing
statistics in the database is much faster. However, this function
is provided for aggregation that cannot be expressed by the query
interface.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.aggregate', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.aggregate" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">objs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given any collection of Python objects that provide a</span>
<span class="sd">    `play_players` attribute, `aggregate` will return a list of</span>
<span class="sd">    `PlayPlayer` objects with statistics aggregated (summed) over each</span>
<span class="sd">    player. (As a special case, if an element in `objs` is itself a</span>
<span class="sd">    `nfldb.PlayPlayer` object, then it is used and a `play_players`</span>
<span class="sd">    attribute is not rquired.)</span>

<span class="sd">    For example, `objs` could be a mixed list of `nfldb.Game` and</span>
<span class="sd">    `nfldb.Play` objects.</span>

<span class="sd">    The order of the list returned is stable with respect to the</span>
<span class="sd">    order of players obtained from each element in `objs`.</span>

<span class="sd">    It is recommended to use `nfldb.Query.aggregate` and</span>
<span class="sd">    `nfldb.Query.as_aggregate` instead of this function since summing</span>
<span class="sd">    statistics in the database is much faster. However, this function</span>
<span class="sd">    is provided for aggregation that cannot be expressed by the query</span>
<span class="sd">    interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summed</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="n">pps</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">)</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">play_players</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">player_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">summed</span><span class="p">:</span>
                <span class="n">summed</span><span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">player_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">summed</span><span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">player_id</span><span class="p">]</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">summed</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.connect">
    <p>def <span class="ident">connect</span>(</p><p>database=None, user=None, password=None, host=None, port=None, timezone=None, config_path=&#39;&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a <code>psycopg2._psycopg.connection</code> object from the
<code>psycopg2.connect</code> function. If database is <code>None</code>, then <code>connect</code>
will look for a configuration file using <code>nfldb.config</code> with
<code>config_path</code>. Otherwise, the connection will use the parameters
given.</p>
<p>If <code>database</code> is <code>None</code> and no config file can be found, then an
<code>IOError</code> exception is raised.</p>
<p>This function will also compare the current schema version of the
database against the API version <a href="#nfldb.api_version"><code>api_version</code></a> and assert
that they are equivalent. If the schema library version is less
than the the API version, then the schema will be automatically
upgraded. If the schema version is newer than the library version,
then this function will raise an assertion error. An assertion
error will also be raised if the schema version is 0 and the
database is not empty.</p>
<p>N.B. The <code>timezone</code> parameter should be set to a value that
PostgreSQL will accept. Select from the <code>pg_timezone_names</code> view
to get a list of valid time zones.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.connect', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.connect" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">timezone</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a `psycopg2._psycopg.connection` object from the</span>
<span class="sd">    `psycopg2.connect` function. If database is `None`, then `connect`</span>
<span class="sd">    will look for a configuration file using `nfldb.config` with</span>
<span class="sd">    `config_path`. Otherwise, the connection will use the parameters</span>
<span class="sd">    given.</span>

<span class="sd">    If `database` is `None` and no config file can be found, then an</span>
<span class="sd">    `IOError` exception is raised.</span>

<span class="sd">    This function will also compare the current schema version of the</span>
<span class="sd">    database against the API version `nfldb.api_version` and assert</span>
<span class="sd">    that they are equivalent. If the schema library version is less</span>
<span class="sd">    than the the API version, then the schema will be automatically</span>
<span class="sd">    upgraded. If the schema version is newer than the library version,</span>
<span class="sd">    then this function will raise an assertion error. An assertion</span>
<span class="sd">    error will also be raised if the schema version is 0 and the</span>
<span class="sd">    database is not empty.</span>

<span class="sd">    N.B. The `timezone` parameter should be set to a value that</span>
<span class="sd">    PostgreSQL will accept. Select from the `pg_timezone_names` view</span>
<span class="sd">    to get a list of valid time zones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">conf</span><span class="p">,</span> <span class="n">tried</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">config_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Could not find valid configuration file. &quot;</span>
                          <span class="s">&quot;Tried the following paths: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tried</span><span class="p">)</span>

        <span class="n">timezone</span><span class="p">,</span> <span class="n">database</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;timezone&#39;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">]</span>
        <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>

    <span class="c"># Start the migration. Make sure if this is the initial setup that</span>
    <span class="c"># the DB is empty.</span>
    <span class="n">sversion</span> <span class="o">=</span> <span class="n">schema_version</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">sversion</span> <span class="o">&lt;=</span> <span class="n">api_version</span><span class="p">,</span> \
        <span class="s">&#39;Library with version </span><span class="si">%d</span><span class="s"> is older than the schema with version </span><span class="si">%d</span><span class="s">&#39;</span> \
        <span class="o">%</span> <span class="p">(</span><span class="n">api_version</span><span class="p">,</span> <span class="n">sversion</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">sversion</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sversion</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_is_empty</span><span class="p">(</span><span class="n">conn</span><span class="p">)),</span> \
        <span class="s">&#39;Schema has version 0 but is not empty.&#39;</span>
    <span class="n">set_timezone</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;UTC&#39;</span><span class="p">)</span>
    <span class="n">_migrate</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">api_version</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timezone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">set_timezone</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">timezone</span><span class="p">)</span>

    <span class="c"># Bind SQL -&gt; Python casting functions.</span>
    <span class="kn">from</span> <span class="nn">nfldb.types</span> <span class="kn">import</span> <span class="n">Clock</span><span class="p">,</span> <span class="n">_Enum</span><span class="p">,</span> <span class="n">Enums</span><span class="p">,</span> <span class="n">FieldPosition</span><span class="p">,</span> <span class="n">PossessionTime</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;game_phase&#39;</span><span class="p">,</span> <span class="n">_Enum</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">))</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;season_phase&#39;</span><span class="p">,</span> <span class="n">_Enum</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">season_phase</span><span class="p">))</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;game_day&#39;</span><span class="p">,</span> <span class="n">_Enum</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_day</span><span class="p">))</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;player_pos&#39;</span><span class="p">,</span> <span class="n">_Enum</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="p">))</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;player_status&#39;</span><span class="p">,</span> <span class="n">_Enum</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">player_status</span><span class="p">))</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;game_time&#39;</span><span class="p">,</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">)</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;pos_period&#39;</span><span class="p">,</span> <span class="n">PossessionTime</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">)</span>
    <span class="n">_bind_type</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;field_pos&#39;</span><span class="p">,</span> <span class="n">FieldPosition</span><span class="o">.</span><span class="n">_pg_cast</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conn</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.current">
    <p>def <span class="ident">current</span>(</p><p>db)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a triple of <a href="#nfldb.Enums.season_phase"><code>season_phase</code></a>, season year and week
corresponding to values that <code>nfldb</code> thinks are current.</p>
<p>Note that this only queries the database. Only the <code>nfldb-update</code>
script fetches the current state from NFL.com.</p>
<p>The values retrieved may be <code>None</code> if the season is over or if they
haven't been updated yet by the <code>nfldb-update</code> script.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.current', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.current" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">current</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a triple of `nfldb.Enums.season_phase`, season year and week</span>
<span class="sd">    corresponding to values that `nfldb` thinks are current.</span>

<span class="sd">    Note that this only queries the database. Only the `nfldb-update`</span>
<span class="sd">    script fetches the current state from NFL.com.</span>

<span class="sd">    The values retrieved may be `None` if the season is over or if they</span>
<span class="sd">    haven&#39;t been updated yet by the `nfldb-update` script.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT season_type, season_year, week FROM meta&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.guess_position">
    <p>def <span class="ident">guess_position</span>(</p><p>pps)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> objects for the same player,
guess the position of the player based on the statistics recorded.</p>
<p>Note that this only distinguishes the offensive positions of QB,
RB, WR, P and K. If defensive stats are detected, then the position
returned defaults to LB.</p>
<p>The algorithm used is simple majority vote. Whichever position is
the most common is returned (and this may be <code>UNK</code>).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.guess_position', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.guess_position" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">guess_position</span><span class="p">(</span><span class="n">pps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of `nfldb.PlayPlayer` objects for the same player,</span>
<span class="sd">    guess the position of the player based on the statistics recorded.</span>

<span class="sd">    Note that this only distinguishes the offensive positions of QB,</span>
<span class="sd">    RB, WR, P and K. If defensive stats are detected, then the position</span>
<span class="sd">    returned defaults to LB.</span>

<span class="sd">    The algorithm used is simple majority vote. Whichever position is</span>
<span class="sd">    the most common is returned (and this may be `UNK`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="o">.</span><span class="n">UNK</span>

    <span class="n">counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">guess_position</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span> <span class="n">count</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.now">
    <p>def <span class="ident">now</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the current date/time in UTC as a <code>datetime.datetime</code>
object. It can be used to compare against date/times in any of the
<code>nfldb</code> objects without worrying about timezones.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.now', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.now" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">now</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the current date/time in UTC as a `datetime.datetime`</span>
<span class="sd">    object. It can be used to compare against date/times in any of the</span>
<span class="sd">    `nfldb` objects without worrying about timezones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.player_search">
    <p>def <span class="ident">player_search</span>(</p><p>db, full_name, team=None, position=None, limit=1, soundex=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a database handle and a player's full name, this function
searches the database for players with full names <em>similar</em> to the
one given. Similarity is measured by the
<a href="http://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein distance</a>,
or by <a href="http://en.wikipedia.org/wiki/Soundex">Soundex similarity</a>.</p>
<p>Results are returned as tuples. The first element is the is a
<a href="#nfldb.Player"><code>Player</code></a> object and the second element is the Levenshtein
(or Soundex) distance. When <code>limit</code> is <code>1</code> (the default), then the
return value is a tuple.  When <code>limit</code> is more than <code>1</code>, then the
return value is a list of tuples.</p>
<p>If no results are found, then <code>(None, None)</code> is returned when
<code>limit == 1</code> or the empty list is returned when <code>limit &gt; 1</code>.</p>
<p>If <code>team</code> is not <code>None</code>, then only players <strong>currently</strong> on the
team provided will be returned. Any players with an unknown team
are therefore omitted.</p>
<p>If <code>position</code> is not <code>None</code>, then only players <strong>currently</strong>
at that position will be returned. Any players with an unknown
position are therefore omitted.</p>
<p>In order to use this function, the PostgreSQL <code>levenshtein</code>
function must be available. If running this functions gives
you an error about "No function matches the given name and
argument types", then you can install the <code>levenshtein</code> function
into your database by running the SQL query <code>CREATE EXTENSION
fuzzystrmatch</code> as a superuser like <code>postgres</code>. For example:</p>
<div class="codehilite"><pre>psql -U postgres -c <span class="s1">&#39;CREATE EXTENSION fuzzystrmatch;&#39;</span> nfldb
</pre></div>


<p>Note that enabled the <code>fuzzystrmatch</code> extension also provides
functions for comparing using Soundex.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.player_search', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.player_search" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">player_search</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">soundex</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a database handle and a player&#39;s full name, this function</span>
<span class="sd">    searches the database for players with full names *similar* to the</span>
<span class="sd">    one given. Similarity is measured by the</span>
<span class="sd">    [Levenshtein distance](http://en.wikipedia.org/wiki/Levenshtein_distance),</span>
<span class="sd">    or by [Soundex similarity](http://en.wikipedia.org/wiki/Soundex).</span>

<span class="sd">    Results are returned as tuples. The first element is the is a</span>
<span class="sd">    `nfldb.Player` object and the second element is the Levenshtein</span>
<span class="sd">    (or Soundex) distance. When `limit` is `1` (the default), then the</span>
<span class="sd">    return value is a tuple.  When `limit` is more than `1`, then the</span>
<span class="sd">    return value is a list of tuples.</span>

<span class="sd">    If no results are found, then `(None, None)` is returned when</span>
<span class="sd">    `limit == 1` or the empty list is returned when `limit &gt; 1`.</span>

<span class="sd">    If `team` is not `None`, then only players **currently** on the</span>
<span class="sd">    team provided will be returned. Any players with an unknown team</span>
<span class="sd">    are therefore omitted.</span>

<span class="sd">    If `position` is not `None`, then only players **currently**</span>
<span class="sd">    at that position will be returned. Any players with an unknown</span>
<span class="sd">    position are therefore omitted.</span>

<span class="sd">    In order to use this function, the PostgreSQL `levenshtein`</span>
<span class="sd">    function must be available. If running this functions gives</span>
<span class="sd">    you an error about &quot;No function matches the given name and</span>
<span class="sd">    argument types&quot;, then you can install the `levenshtein` function</span>
<span class="sd">    into your database by running the SQL query `CREATE EXTENSION</span>
<span class="sd">    fuzzystrmatch` as a superuser like `postgres`. For example:</span>

<span class="sd">        #!bash</span>
<span class="sd">        psql -U postgres -c &#39;CREATE EXTENSION fuzzystrmatch;&#39; nfldb</span>

<span class="sd">    Note that enabled the `fuzzystrmatch` extension also provides</span>
<span class="sd">    functions for comparing using Soundex.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">soundex</span><span class="p">:</span>
        <span class="c"># Careful, soundex distances are sorted in reverse of Levenshtein</span>
        <span class="c"># distances.</span>
        <span class="c"># Difference yields an integer in [0, 4].</span>
        <span class="c"># A 4 is an exact match.</span>
        <span class="n">fuzzy</span> <span class="o">=</span> <span class="s">&#39;difference(full_name, </span><span class="si">%s</span><span class="s">)&#39;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">            SELECT {columns}</span>
<span class="s">            FROM player</span>
<span class="s">            WHERE {where}</span>
<span class="s">            ORDER BY distance DESC LIMIT {limit}</span>
<span class="s">        &#39;&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fuzzy</span> <span class="o">=</span> <span class="s">&#39;levenshtein(full_name, </span><span class="si">%s</span><span class="s">)&#39;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">            SELECT {columns}</span>
<span class="s">            FROM player</span>
<span class="s">            WHERE {where}</span>
<span class="s">            ORDER BY distance ASC LIMIT {limit}</span>
<span class="s">        &#39;&#39;&#39;</span>
    <span class="n">qteam</span><span class="p">,</span> <span class="n">qposition</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">team</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">qteam</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s">&#39;team = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">team</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">qposition</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="s">&#39;position = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">position</span><span class="p">,))</span>

        <span class="n">fuzzy_filled</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">mogrify</span><span class="p">(</span><span class="n">fuzzy</span><span class="p">,</span> <span class="p">(</span><span class="n">full_name</span><span class="p">,))</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">())</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> AS distance&#39;</span> <span class="o">%</span> <span class="n">fuzzy_filled</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span>
            <span class="n">where</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="n">fuzzy_filled</span> <span class="o">+</span> <span class="s">&#39; IS NOT NULL&#39;</span><span class="p">,</span> <span class="n">qteam</span><span class="p">,</span> <span class="n">qposition</span><span class="p">),</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="n">full_name</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="o">.</span><span class="n">from_row_dict</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;distance&#39;</span><span class="p">])</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.schema_version">
    <p>def <span class="ident">schema_version</span>(</p><p>conn)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the schema version of the given database. If the version
is not stored in the database, then <code>0</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.schema_version', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.schema_version" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">schema_version</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the schema version of the given database. If the version</span>
<span class="sd">    is not stored in the database, then `0` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT version FROM meta LIMIT 1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="s">&#39;version&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.set_timezone">
    <p>def <span class="ident">set_timezone</span>(</p><p>conn, timezone)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the timezone for which all datetimes will be displayed
as. Valid values are exactly the same set of values accepted
by PostgreSQL. (Select from the <code>pg_timezone_names</code> view to
get a list of valid time zones.)</p>
<p>Note that all datetimes are stored in UTC. This setting only
affects how datetimes are viewed from select queries.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.set_timezone', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.set_timezone" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">set_timezone</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">timezone</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the timezone for which all datetimes will be displayed</span>
<span class="sd">    as. Valid values are exactly the same set of values accepted</span>
<span class="sd">    by PostgreSQL. (Select from the `pg_timezone_names` view to</span>
<span class="sd">    get a list of valid time zones.)</span>

<span class="sd">    Note that all datetimes are stored in UTC. This setting only</span>
<span class="sd">    affects how datetimes are viewed from select queries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SET timezone = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">timezone</span><span class="p">,))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nfldb.standard_team">
    <p>def <span class="ident">standard_team</span>(</p><p>team)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a standard abbreviation when team corresponds to a team
known by nfldb (case insensitive). If no team can be found, then
<code>"UNK"</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.standard_team', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.standard_team" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">standard_team</span><span class="p">(</span><span class="n">team</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a standard abbreviation when team corresponds to a team</span>
<span class="sd">    known by nfldb (case insensitive). If no team can be found, then</span>
<span class="sd">    `&quot;UNK&quot;` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">team</span> <span class="ow">or</span> <span class="n">team</span><span class="o">.</span><span class="n">lower</span> <span class="o">==</span> <span class="s">&#39;new york&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;UNK&#39;</span>

    <span class="n">team</span> <span class="o">=</span> <span class="n">team</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">variants</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">variants</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">team</span> <span class="o">==</span> <span class="n">variant</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">variants</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="s">&#39;UNK&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="nfldb.Category" class="name">class <span class="ident">Category</span></p>
      
  
    <div class="desc"><p>Represents meta data about a statistical category. This includes
the category's scope, GSIS identifier, name and short description.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Category', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Category" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Category</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents meta data about a statistical category. This includes</span>
<span class="sd">    the category&#39;s scope, GSIS identifier, name and short description.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;category_id&#39;</span><span class="p">,</span> <span class="s">&#39;gsis_number&#39;</span><span class="p">,</span> <span class="s">&#39;category_type&#39;</span><span class="p">,</span>
                 <span class="s">&#39;is_real&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category_id</span><span class="p">,</span> <span class="n">gsis_number</span><span class="p">,</span> <span class="n">category_type</span><span class="p">,</span>
                 <span class="n">is_real</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_id</span> <span class="o">=</span> <span class="n">category_id</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A unique name for this category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_number</span> <span class="o">=</span> <span class="n">gsis_number</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A unique numeric identifier for this category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_type</span> <span class="o">=</span> <span class="n">category_type</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The scope of this category represented with</span>
<span class="sd">        `nfldb.Enums.category_scope`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_real</span> <span class="o">=</span> <span class="n">is_real</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether this statistic is a real number or not. Currently,</span>
<span class="sd">        only the `defense_sk` statistic has `Category.is_real` set to</span>
<span class="sd">        `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A free-form text description of this category.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_sql_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The SQL definition of this column. Statistics are always</span>
<span class="sd">        NOT NULL and have a default value of `0`.</span>

<span class="sd">        When `Category.is_real` is `True`, then the SQL type is `real`.</span>
<span class="sd">        Otherwise, it&#39;s `smallint`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;real&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_real</span> <span class="k">else</span> <span class="s">&#39;smallint&#39;</span>
        <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;0.0&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_real</span> <span class="k">else</span> <span class="s">&#39;0&#39;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> NOT NULL DEFAULT </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category_id</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_id</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category_id</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Category">Category</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Category.category_id" class="name">var <span class="ident">category_id</span></p>
            

            
  
    <div class="desc"><p>A unique name for this category.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Category.category_type" class="name">var <span class="ident">category_type</span></p>
            

            
  
    <div class="desc"><p>The scope of this category represented with
<a href="#nfldb.Enums.category_scope"><code>category_scope</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Category.description" class="name">var <span class="ident">description</span></p>
            

            
  
    <div class="desc"><p>A free-form text description of this category.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Category.gsis_number" class="name">var <span class="ident">gsis_number</span></p>
            

            
  
    <div class="desc"><p>A unique numeric identifier for this category.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Category.is_real" class="name">var <span class="ident">is_real</span></p>
            

            
  
    <div class="desc"><p>Whether this statistic is a real number or not. Currently,
only the <code>defense_sk</code> statistic has <code>Category.is_real</code> set to
<code>True</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Category.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, category_id, gsis_number, category_type, is_real, description)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Category.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Category.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category_id</span><span class="p">,</span> <span class="n">gsis_number</span><span class="p">,</span> <span class="n">category_type</span><span class="p">,</span>
             <span class="n">is_real</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category_id</span> <span class="o">=</span> <span class="n">category_id</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unique name for this category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_number</span> <span class="o">=</span> <span class="n">gsis_number</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unique numeric identifier for this category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category_type</span> <span class="o">=</span> <span class="n">category_type</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The scope of this category represented with</span>
<span class="sd">    `nfldb.Enums.category_scope`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_real</span> <span class="o">=</span> <span class="n">is_real</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Whether this statistic is a real number or not. Currently,</span>
<span class="sd">    only the `defense_sk` statistic has `Category.is_real` set to</span>
<span class="sd">    `True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A free-form text description of this category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Clock" class="name">class <span class="ident">Clock</span></p>
      
  
    <div class="desc"><p>Represents a single point in time during a game. This includes the
quarter and the game clock time in addition to other phases of the
game such as before the game starts, half time, overtime and when
the game ends.</p>
<p>Note that the clock time does not uniquely identify a play, since
not all plays consume time on the clock. (e.g., A two point
conversion.)</p>
<p>This class defines a total ordering on clock times. Namely, c1 &lt; c2
if and only if c2 is closer to the end of the game than c1.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Clock', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Clock" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Clock</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single point in time during a game. This includes the</span>
<span class="sd">    quarter and the game clock time in addition to other phases of the</span>
<span class="sd">    game such as before the game starts, half time, overtime and when</span>
<span class="sd">    the game ends.</span>

<span class="sd">    Note that the clock time does not uniquely identify a play, since</span>
<span class="sd">    not all plays consume time on the clock. (e.g., A two point</span>
<span class="sd">    conversion.)</span>

<span class="sd">    This class defines a total ordering on clock times. Namely, c1 &lt; c2</span>
<span class="sd">    if and only if c2 is closer to the end of the game than c1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nonqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Pregame</span><span class="p">,</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="p">,</span>
              <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Final</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The phases of the game that do not have a time component.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_phase_max</span> <span class="o">=</span> <span class="mi">900</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The maximum number of seconds in a game phase.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduces a new `nfldb.Clock` object given strings of the game</span>
<span class="sd">        phase and the clock. `phase` may be one of the values in the</span>
<span class="sd">        `nfldb.Enums.game_phase` enumeration. `clock` must be a clock</span>
<span class="sd">        string in the format `MM:SS`, e.g., `4:01` corresponds to a</span>
<span class="sd">        game phase with 4 minutes and 1 second remaining.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> \
            <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; is not a valid game phase. choose one of </span><span class="si">%s</span><span class="s">&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">))</span>

        <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span> <span class="o">-</span> <span class="p">((</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">[</span><span class="n">phase</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pg_cast</span><span class="p">(</span><span class="n">sqlv</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Casts a SQL string of the form `(game_phase, elapsed)` to a</span>
<span class="sd">        `nfldb.Clock` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phase</span><span class="p">,</span> <span class="n">elapsed</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">sqlv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">[</span><span class="n">phase</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduces a new `nfldb.Clock` object. `phase` should</span>
<span class="sd">        be a value from the `nfldb.Enums.game_phase` enumeration</span>
<span class="sd">        while `elapsed` should be the number of seconds elapsed in</span>
<span class="sd">        the `phase`. Note that `elapsed` is only applicable when</span>
<span class="sd">        `phase` is a quarter (including overtime). In all other</span>
<span class="sd">        cases, it will be set to `0`.</span>

<span class="sd">        `elapsed` should be in the range `[0, 900]` where `900`</span>
<span class="sd">        corresponds to the clock time `0:00` and `0` corresponds</span>
<span class="sd">        to the clock time `15:00`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">elapsed</span> <span class="o">&lt;=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span>

        <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_nonqs</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The phase represented by this clock object. It is guaranteed</span>
<span class="sd">        to have type `nfldb.Enums.game_phase`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">elapsed</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of seconds remaining in this clock&#39;s phase of the</span>
<span class="sd">        game. It is always set to `0` whenever the phase is not a</span>
<span class="sd">        quarter in the game.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">add_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the number of seconds given to the current clock time</span>
<span class="sd">        and returns a new clock time. `seconds` may be positive</span>
<span class="sd">        or negative. If a boundary is reached (e.g., `Pregame` or</span>
<span class="sd">        `Final`), then subtracting or adding more seconds has no</span>
<span class="sd">        effect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">+</span> <span class="n">seconds</span>
        <span class="n">phase_jump</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">elapsed</span> <span class="o">&gt;</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span><span class="p">:</span>
            <span class="n">phase_jump</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">//</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span>

        <span class="c"># Always skip over halftime.</span>
        <span class="n">phase_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">phase_jump</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">phase_val</span><span class="p">:</span>
            <span class="n">phase_val</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">phase_val</span> <span class="o">&lt;=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">phase_val</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">(</span><span class="n">phase_val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">elapsed</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">phase_val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Pregame</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Final</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the clock has a time component, then the number of whole</span>
<span class="sd">        minutes **left in this phase** is returned. Otherwise, `0` is</span>
<span class="sd">        returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the clock has a time component, then the number of seconds</span>
<span class="sd">        **left in this phase** is returned. Otherwise, `0` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_nonqs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phase</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">phase</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">elapsed</span>

    <span class="k">def</span> <span class="nf">__conform__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="ow">is</span> <span class="n">ISQLQuote</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;ROW(&#39;</span><span class="si">%s</span><span class="s">&#39;, </span><span class="si">%d</span><span class="s">)::game_time&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Clock">Clock</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Clock.from_str">
    <p>def <span class="ident">from_str</span>(</p><p>phase, clock)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new <a href="#nfldb.Clock"><code>Clock</code></a> object given strings of the game
phase and the clock. <code>phase</code> may be one of the values in the
<a href="#nfldb.Enums.game_phase"><code>game_phase</code></a> enumeration. <code>clock</code> must be a clock
string in the format <code>MM:SS</code>, e.g., <code>4:01</code> corresponds to a
game phase with 4 minutes and 1 second remaining.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Clock.from_str', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Clock.from_str" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new `nfldb.Clock` object given strings of the game</span>
<span class="sd">    phase and the clock. `phase` may be one of the values in the</span>
<span class="sd">    `nfldb.Enums.game_phase` enumeration. `clock` must be a clock</span>
<span class="sd">    string in the format `MM:SS`, e.g., `4:01` corresponds to a</span>
<span class="sd">    game phase with 4 minutes and 1 second remaining.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> \
        <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; is not a valid game phase. choose one of </span><span class="si">%s</span><span class="s">&#39;</span> \
        <span class="o">%</span> <span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">))</span>
    <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span> <span class="o">-</span> <span class="p">((</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">[</span><span class="n">phase</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Clock.elapsed" class="name">var <span class="ident">elapsed</span></p>
            

            
  
    <div class="desc"><p>The number of seconds remaining in this clock's phase of the
game. It is always set to <code>0</code> whenever the phase is not a
quarter in the game.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Clock.minutes" class="name">var <span class="ident">minutes</span></p>
            

            
  
    <div class="desc"><p>If the clock has a time component, then the number of whole
minutes <strong>left in this phase</strong> is returned. Otherwise, <code>0</code> is
returned.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Clock.phase" class="name">var <span class="ident">phase</span></p>
            

            
  
    <div class="desc"><p>The phase represented by this clock object. It is guaranteed
to have type <a href="#nfldb.Enums.game_phase"><code>game_phase</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Clock.seconds" class="name">var <span class="ident">seconds</span></p>
            

            
  
    <div class="desc"><p>If the clock has a time component, then the number of seconds
<strong>left in this phase</strong> is returned. Otherwise, <code>0</code> is returned.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Clock.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, phase, elapsed)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new <a href="#nfldb.Clock"><code>Clock</code></a> object. <code>phase</code> should
be a value from the <a href="#nfldb.Enums.game_phase"><code>game_phase</code></a> enumeration
while <code>elapsed</code> should be the number of seconds elapsed in
the <code>phase</code>. Note that <code>elapsed</code> is only applicable when
<code>phase</code> is a quarter (including overtime). In all other
cases, it will be set to <code>0</code>.</p>
<p><code>elapsed</code> should be in the range <code>[0, 900]</code> where <code>900</code>
corresponds to the clock time <code>0:00</code> and <code>0</code> corresponds
to the clock time <code>15:00</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Clock.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Clock.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new `nfldb.Clock` object. `phase` should</span>
<span class="sd">    be a value from the `nfldb.Enums.game_phase` enumeration</span>
<span class="sd">    while `elapsed` should be the number of seconds elapsed in</span>
<span class="sd">    the `phase`. Note that `elapsed` is only applicable when</span>
<span class="sd">    `phase` is a quarter (including overtime). In all other</span>
<span class="sd">    cases, it will be set to `0`.</span>
<span class="sd">    `elapsed` should be in the range `[0, 900]` where `900`</span>
<span class="sd">    corresponds to the clock time `0:00` and `0` corresponds</span>
<span class="sd">    to the clock time `15:00`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">elapsed</span> <span class="o">&lt;=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span>
    <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_nonqs</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The phase represented by this clock object. It is guaranteed</span>
<span class="sd">    to have type `nfldb.Enums.game_phase`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">elapsed</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of seconds remaining in this clock&#39;s phase of the</span>
<span class="sd">    game. It is always set to `0` whenever the phase is not a</span>
<span class="sd">    quarter in the game.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Clock.add_seconds">
    <p>def <span class="ident">add_seconds</span>(</p><p>self, seconds)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds the number of seconds given to the current clock time
and returns a new clock time. <code>seconds</code> may be positive
or negative. If a boundary is reached (e.g., <code>Pregame</code> or
<code>Final</code>), then subtracting or adding more seconds has no
effect.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Clock.add_seconds', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Clock.add_seconds" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds the number of seconds given to the current clock time</span>
<span class="sd">    and returns a new clock time. `seconds` may be positive</span>
<span class="sd">    or negative. If a boundary is reached (e.g., `Pregame` or</span>
<span class="sd">    `Final`), then subtracting or adding more seconds has no</span>
<span class="sd">    effect.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">+</span> <span class="n">seconds</span>
    <span class="n">phase_jump</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">elapsed</span> <span class="o">&gt;</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span><span class="p">:</span>
        <span class="n">phase_jump</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">//</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span>
    <span class="c"># Always skip over halftime.</span>
    <span class="n">phase_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">phase_jump</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">phase_val</span><span class="p">:</span>
        <span class="n">phase_val</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">phase_val</span> <span class="o">&lt;=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">phase_val</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="p">(</span><span class="n">phase_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">elapsed</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Clock</span><span class="o">.</span><span class="n">_phase_max</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">phase_val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Pregame</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">game_phase</span><span class="o">.</span><span class="n">Final</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Drive" class="name">class <span class="ident">Drive</span></p>
      
  
    <div class="desc"><p>Represents a single drive in an NFL game. Each drive has an
assortment of meta data, possibly including the start and end
times, the start and end field positions, the result of the drive,
the number of penalties and first downs, and more.</p>
<p>Each drive corresponds to <strong>zero or more</strong> plays. A drive usually
corresponds to at least one play, but if the game is active, there
exist valid ephemeral states where a drive has no plays.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Drive</span> <span class="p">(</span><span class="n">SQLDrive</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single drive in an NFL game. Each drive has an</span>
<span class="sd">    assortment of meta data, possibly including the start and end</span>
<span class="sd">    times, the start and end field positions, the result of the drive,</span>
<span class="sd">    the number of penalties and first downs, and more.</span>

<span class="sd">    Each drive corresponds to **zero or more** plays. A drive usually</span>
<span class="sd">    corresponds to at least one play, but if the game is active, there</span>
<span class="sd">    exist valid ephemeral states where a drive has no plays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="n">SQLDrive</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;_db&#39;</span><span class="p">,</span> <span class="s">&#39;_game&#39;</span><span class="p">,</span> <span class="s">&#39;_plays&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given `g` as a `nfldb.Game` object and `d` as a</span>
<span class="sd">        `nflgame.game.Drive` object, `_from_nflgame` converts `d` to a</span>
<span class="sd">        `nfldb.Drive` object.</span>

<span class="sd">        Generally, this function should not be used. It is called</span>
<span class="sd">        automatically by `nfldb.Game._from_nflgame`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbd</span> <span class="o">=</span> <span class="n">Drive</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">gsis_id</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">drive_num</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">_nflgame_clock</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">time_start</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">start_field</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">field_start</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">end_field</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">field_end</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">_nflgame_clock</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">time_end</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">pos_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">first_downs</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">result</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">penalty_yards</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">penalty_yds</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">yards_gained</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">total_yds</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">play_count</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">play_cnt</span>

        <span class="n">dbd</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="n">g</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">plays</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Play</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">dbd</span><span class="p">,</span> <span class="n">play</span><span class="p">))</span>

        <span class="c"># At this point, some plays don&#39;t have valid game times. Fix it!</span>
        <span class="c"># If we absolutely cannot fix it, drop the play. Maintain integrity!</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">play</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="n">_next_play_with</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">play</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="n">play</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">_play_time</span><span class="p">(</span><span class="n">dbd</span><span class="p">,</span> <span class="n">play</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">play</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">dbd</span><span class="o">.</span><span class="n">_plays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">play</span><span class="p">)</span>
        <span class="n">dbd</span><span class="o">.</span><span class="n">_plays</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dbd</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a GSIS identifier (e.g., `2012090500`) as a string</span>
<span class="sd">        and a integer drive id, this returns a `nfldb.Drive` object</span>
<span class="sd">        corresponding to the given identifiers.</span>

<span class="sd">        If no corresponding drive is found, then `None` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">nfldb.query</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="n">drive_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">drives</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_drives</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drives</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">drives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">drives</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of `drives`, fill all of their `game` attributes</span>
<span class="sd">        using as few queries as possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">drives</span><span class="p">,</span> <span class="s">&#39;_game&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new and empty `nfldb.Drive` object with the given</span>
<span class="sd">        database connection.</span>

<span class="sd">        This constructor should not be used by clients. Instead, you</span>
<span class="sd">        should get `nfldb.Drive` objects from `nfldb.Query` or from one</span>
<span class="sd">        of the other constructors, like `nfldb.Drive.from_id` or</span>
<span class="sd">        `nfldb.Drive.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">        writing your own SQL queries.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The GSIS identifier for the game that this drive belongs to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numeric drive identifier for this drive. It may be</span>
<span class="sd">        interpreted as a sequence number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_field</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The starting field position of this drive represented</span>
<span class="sd">        with `nfldb.FieldPosition`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The starting clock time of this drive, represented with</span>
<span class="sd">        `nfldb.Clock`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_field</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ending field position of this drive represented with</span>
<span class="sd">        `nfldb.FieldPosition`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ending clock time of this drive, represented with</span>
<span class="sd">        `nfldb.Clock`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team in possession during this drive, represented as</span>
<span class="sd">        a team abbreviation string. Use the `nfldb.Team` constructor</span>
<span class="sd">        to get more information on a team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The possession time of this drive, represented with</span>
<span class="sd">        `nfldb.PossessionTime`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of first downs that occurred in this drive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A freeform text field straight from NFL&#39;s GameCenter data that</span>
<span class="sd">        sometimes contains the result of a drive (e.g., `Touchdown`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yards</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of yards lost or gained from penalties in this</span>
<span class="sd">        drive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yards_gained</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The total number of yards gained or lost in this drive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_count</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The total number of plays executed by the offense in this</span>
<span class="sd">        drive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The date and time that this drive was added.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The date and time that this drive was last updated.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the `nfldb.Game` object that contains this drive. The</span>
<span class="sd">        game is retrieved from the database if it hasn&#39;t been already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_game</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Game</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_game</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of all `nfldb.Play`s in this drive. They are</span>
<span class="sd">        automatically retrieved from the database if they haven&#39;t been</span>
<span class="sd">        already.</span>

<span class="sd">        If there are no plays in the drive, then an empty list is</span>
<span class="sd">        returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nfldb.query</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
            <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;play_id&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)])</span>
            <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">_drive</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the score of the game immediately after this drive as a</span>
<span class="sd">        tuple of the form `(home_score, away_score)`.</span>

<span class="sd">        If `before` is `True`, then the score will *not* include this</span>
<span class="sd">        drive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of `nfldb.PlayPlayer` objects in this drive. Data is</span>
<span class="sd">        retrieved from the database if it hasn&#39;t been already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plays</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play</span><span class="o">.</span><span class="n">play_players</span><span class="p">:</span>
                <span class="n">pps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pps</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Drive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Remove any plays that are stale.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            DELETE FROM play</span>
<span class="s">            WHERE gsis_id = </span><span class="si">%s</span><span class="s"> AND drive_id = </span><span class="si">%s</span><span class="s"> AND NOT (play_id = ANY (</span><span class="si">%s</span><span class="s">))</span>
<span class="s">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">play_id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="ow">or</span> <span class="p">[]):</span>
            <span class="n">play</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%-12s</span><span class="s">] </span><span class="si">%-3s</span><span class="s"> from </span><span class="si">%-6s</span><span class="s"> to </span><span class="si">%-6s</span><span class="s"> &#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;(lasted </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">)&#39;</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_field</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Drive">Drive</a></li>
          <li>nfldb.types.SQLDrive</li>
          <li>nfldb.sql.Entity</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.fill_games">
    <p>def <span class="ident">fill_games</span>(</p><p>db, drives)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <code>drives</code>, fill all of their <code>game</code> attributes
using as few queries as possible.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.fill_games', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.fill_games" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">drives</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of `drives`, fill all of their `game` attributes</span>
<span class="sd">    using as few queries as possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">drives</span><span class="p">,</span> <span class="s">&#39;_game&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.from_id">
    <p>def <span class="ident">from_id</span>(</p><p>db, gsis_id, drive_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a GSIS identifier (e.g., <code>2012090500</code>) as a string
and a integer drive id, this returns a <a href="#nfldb.Drive"><code>Drive</code></a> object
corresponding to the given identifiers.</p>
<p>If no corresponding drive is found, then <code>None</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.from_id', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.from_id" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a GSIS identifier (e.g., `2012090500`) as a string</span>
<span class="sd">    and a integer drive id, this returns a `nfldb.Drive` object</span>
<span class="sd">    corresponding to the given identifiers.</span>
<span class="sd">    If no corresponding drive is found, then `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">nfldb.query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="n">drive_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">drives</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_drives</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drives</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">drives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Drive.drive_id" class="name">var <span class="ident">drive_id</span></p>
            

            
  
    <div class="desc"><p>The numeric drive identifier for this drive. It may be
interpreted as a sequence number.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.end_field" class="name">var <span class="ident">end_field</span></p>
            

            
  
    <div class="desc"><p>The ending field position of this drive represented with
<a href="#nfldb.FieldPosition"><code>FieldPosition</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.end_time" class="name">var <span class="ident">end_time</span></p>
            

            
  
    <div class="desc"><p>The ending clock time of this drive, represented with
<a href="#nfldb.Clock"><code>Clock</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.first_downs" class="name">var <span class="ident">first_downs</span></p>
            

            
  
    <div class="desc"><p>The number of first downs that occurred in this drive.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.game" class="name">var <span class="ident">game</span></p>
            

            
  
    <div class="desc"><p>Returns the <a href="#nfldb.Game"><code>Game</code></a> object that contains this drive. The
game is retrieved from the database if it hasn't been already.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.gsis_id" class="name">var <span class="ident">gsis_id</span></p>
            

            
  
    <div class="desc"><p>The GSIS identifier for the game that this drive belongs to.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.penalty_yards" class="name">var <span class="ident">penalty_yards</span></p>
            

            
  
    <div class="desc"><p>The number of yards lost or gained from penalties in this
drive.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.play_count" class="name">var <span class="ident">play_count</span></p>
            

            
  
    <div class="desc"><p>The total number of plays executed by the offense in this
drive.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.play_players" class="name">var <span class="ident">play_players</span></p>
            

            
  
    <div class="desc"><p>A list of <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> objects in this drive. Data is
retrieved from the database if it hasn't been already.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.plays" class="name">var <span class="ident">plays</span></p>
            

            
  
    <div class="desc"><p>A list of all <a href="#nfldb.Play"><code>Play</code></a>s in this drive. They are
automatically retrieved from the database if they haven't been
already.</p>
<p>If there are no plays in the drive, then an empty list is
returned.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.pos_team" class="name">var <span class="ident">pos_team</span></p>
            

            
  
    <div class="desc"><p>The team in possession during this drive, represented as
a team abbreviation string. Use the <a href="#nfldb.Team"><code>Team</code></a> constructor
to get more information on a team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.pos_time" class="name">var <span class="ident">pos_time</span></p>
            

            
  
    <div class="desc"><p>The possession time of this drive, represented with
<a href="#nfldb.PossessionTime"><code>PossessionTime</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.result" class="name">var <span class="ident">result</span></p>
            

            
  
    <div class="desc"><p>A freeform text field straight from NFL's GameCenter data that
sometimes contains the result of a drive (e.g., <code>Touchdown</code>).</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.start_field" class="name">var <span class="ident">start_field</span></p>
            

            
  
    <div class="desc"><p>The starting field position of this drive represented
with <a href="#nfldb.FieldPosition"><code>FieldPosition</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.start_time" class="name">var <span class="ident">start_time</span></p>
            

            
  
    <div class="desc"><p>The starting clock time of this drive, represented with
<a href="#nfldb.Clock"><code>Clock</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.time_inserted" class="name">var <span class="ident">time_inserted</span></p>
            

            
  
    <div class="desc"><p>The date and time that this drive was added.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.time_updated" class="name">var <span class="ident">time_updated</span></p>
            

            
  
    <div class="desc"><p>The date and time that this drive was last updated.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Drive.yards_gained" class="name">var <span class="ident">yards_gained</span></p>
            

            
  
    <div class="desc"><p>The total number of yards gained or lost in this drive.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new and empty <a href="#nfldb.Drive"><code>Drive</code></a> object with the given
database connection.</p>
<p>This constructor should not be used by clients. Instead, you
should get <a href="#nfldb.Drive"><code>Drive</code></a> objects from <a href="#nfldb.Query"><code>Query</code></a> or from one
of the other constructors, like <a href="#nfldb.Drive.from_id"><code>from_id</code></a> or
<a href="#nfldb.Drive.from_row_dict"><code>from_row_dict</code></a>. (The latter is useful only if you're
writing your own SQL queries.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new and empty `nfldb.Drive` object with the given</span>
<span class="sd">    database connection.</span>
<span class="sd">    This constructor should not be used by clients. Instead, you</span>
<span class="sd">    should get `nfldb.Drive` objects from `nfldb.Query` or from one</span>
<span class="sd">    of the other constructors, like `nfldb.Drive.from_id` or</span>
<span class="sd">    `nfldb.Drive.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">    writing your own SQL queries.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GSIS identifier for the game that this drive belongs to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The numeric drive identifier for this drive. It may be</span>
<span class="sd">    interpreted as a sequence number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_field</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting field position of this drive represented</span>
<span class="sd">    with `nfldb.FieldPosition`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting clock time of this drive, represented with</span>
<span class="sd">    `nfldb.Clock`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_field</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending field position of this drive represented with</span>
<span class="sd">    `nfldb.FieldPosition`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ending clock time of this drive, represented with</span>
<span class="sd">    `nfldb.Clock`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team in possession during this drive, represented as</span>
<span class="sd">    a team abbreviation string. Use the `nfldb.Team` constructor</span>
<span class="sd">    to get more information on a team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The possession time of this drive, represented with</span>
<span class="sd">    `nfldb.PossessionTime`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of first downs that occurred in this drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A freeform text field straight from NFL&#39;s GameCenter data that</span>
<span class="sd">    sometimes contains the result of a drive (e.g., `Touchdown`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yards</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of yards lost or gained from penalties in this</span>
<span class="sd">    drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yards_gained</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The total number of yards gained or lost in this drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">play_count</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The total number of plays executed by the offense in this</span>
<span class="sd">    drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The date and time that this drive was added.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The date and time that this drive was last updated.&quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.from_row_dict">
    <p>def <span class="ident">from_row_dict</span>(</p><p>cls, db, row)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new entity object from a full SQL row result from
the entity's tables. (i.e., <code>row</code> is a dictionary mapping
column to value.) Note that the column names must be of the
form '{entity_name}_{column_name}'. For example, in the <code>game</code>
table, the <code>gsis_id</code> column must be named <code>game_gsis_id</code> in
<code>row</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.from_row_dict', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.from_row_dict" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new entity object from a full SQL row result from</span>
<span class="sd">    the entity&#39;s tables. (i.e., `row` is a dictionary mapping</span>
<span class="sd">    column to value.) Note that the column names must be of the</span>
<span class="sd">    form &#39;{entity_name}_{column_name}&#39;. For example, in the `game`</span>
<span class="sd">    table, the `gsis_id` column must be named `game_gsis_id` in</span>
<span class="sd">    `row`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_primary_table</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span>
    <span class="n">slice_from</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">slice_from</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.from_row_tuple">
    <p>def <span class="ident">from_row_tuple</span>(</p><p>cls, db, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tuple <code>t</code> corresponding to a result from a SELECT query,
this will construct a new instance for this entity. Note that
the tuple <code>t</code> must be in <em>exact</em> correspondence with the columns
returned by <code>nfldb.Entity.sql_fields</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.from_row_tuple', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.from_row_tuple" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tuple `t` corresponding to a result from a SELECT query,</span>
<span class="sd">    this will construct a new instance for this entity. Note that</span>
<span class="sd">    the tuple `t` must be in *exact* correspondence with the columns</span>
<span class="sd">    returned by `nfldb.Entity.sql_fields`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.score">
    <p>def <span class="ident">score</span>(</p><p>self, before=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the score of the game immediately after this drive as a
tuple of the form <code>(home_score, away_score)</code>.</p>
<p>If <code>before</code> is <code>True</code>, then the score will <em>not</em> include this
drive.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.score', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.score" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the score of the game immediately after this drive as a</span>
<span class="sd">    tuple of the form `(home_score, away_score)`.</span>
<span class="sd">    If `before` is `True`, then the score will *not* include this</span>
<span class="sd">    drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Drive.sql_fields">
    <p>def <span class="ident">sql_fields</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of all SQL fields across all tables for this
entity, including derived fields. This method can be used
in conjunction with <code>nfldb.Entity.from_row_tuple</code> to quickly
create new <code>nfldb</code> objects without every constructing a dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Drive.sql_fields', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Drive.sql_fields" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sql_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all SQL fields across all tables for this</span>
<span class="sd">    entity, including derived fields. This method can be used</span>
<span class="sd">    in conjunction with `nfldb.Entity.from_row_tuple` to quickly</span>
<span class="sd">    create new `nfldb` objects without every constructing a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_cached_sql_fields&#39;</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_columns</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">+=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Enums" class="name">class <span class="ident">Enums</span></p>
      
  
    <div class="desc"><p>Enums groups all enum types used in the database schema.
All possible values for each enum type are represented as lists.
The ordering of each list is the same as the ordering in the
database. In particular, this ordering specifies a total ordering
that can be used in Python code to compare values in the same
enumeration.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Enums', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Enums" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Enums</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enums groups all enum types used in the database schema.</span>
<span class="sd">    All possible values for each enum type are represented as lists.</span>
<span class="sd">    The ordering of each list is the same as the ordering in the</span>
<span class="sd">    database. In particular, this ordering specifies a total ordering</span>
<span class="sd">    that can be used in Python code to compare values in the same</span>
<span class="sd">    enumeration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">game_phase</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;game_phase&#39;</span><span class="p">,</span>
                       <span class="p">[</span><span class="s">&#39;Pregame&#39;</span><span class="p">,</span> <span class="s">&#39;Q1&#39;</span><span class="p">,</span> <span class="s">&#39;Q2&#39;</span><span class="p">,</span> <span class="s">&#39;Half&#39;</span><span class="p">,</span>
                        <span class="s">&#39;Q3&#39;</span><span class="p">,</span> <span class="s">&#39;Q4&#39;</span><span class="p">,</span> <span class="s">&#39;OT&#39;</span><span class="p">,</span> <span class="s">&#39;OT2&#39;</span><span class="p">,</span> <span class="s">&#39;Final&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the phase of the game. e.g., `Q1` or `Half`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">season_phase</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;season_phase&#39;</span><span class="p">,</span>
                         <span class="p">[</span><span class="s">&#39;Preseason&#39;</span><span class="p">,</span> <span class="s">&#39;Regular&#39;</span><span class="p">,</span> <span class="s">&#39;Postseason&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents one of the three phases of an NFL season: `Preseason`,</span>
<span class="sd">    `Regular` or `Postseason`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">game_day</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;game_day&#39;</span><span class="p">,</span>
                     <span class="p">[</span><span class="s">&#39;Sunday&#39;</span><span class="p">,</span> <span class="s">&#39;Monday&#39;</span><span class="p">,</span> <span class="s">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="s">&#39;Wednesday&#39;</span><span class="p">,</span>
                      <span class="s">&#39;Thursday&#39;</span><span class="p">,</span> <span class="s">&#39;Friday&#39;</span><span class="p">,</span> <span class="s">&#39;Saturday&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The day of the week on which a game was played. The week starts</span>
<span class="sd">    on `Sunday`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">player_pos</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;player_pos&#39;</span><span class="p">,</span>
                       <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;CB&#39;</span><span class="p">,</span> <span class="s">&#39;DB&#39;</span><span class="p">,</span> <span class="s">&#39;DE&#39;</span><span class="p">,</span> <span class="s">&#39;DL&#39;</span><span class="p">,</span> <span class="s">&#39;DT&#39;</span><span class="p">,</span> <span class="s">&#39;FB&#39;</span><span class="p">,</span> <span class="s">&#39;FS&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span>
                        <span class="s">&#39;ILB&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">,</span> <span class="s">&#39;LB&#39;</span><span class="p">,</span> <span class="s">&#39;LS&#39;</span><span class="p">,</span> <span class="s">&#39;MLB&#39;</span><span class="p">,</span> <span class="s">&#39;NT&#39;</span><span class="p">,</span> <span class="s">&#39;OG&#39;</span><span class="p">,</span> <span class="s">&#39;OL&#39;</span><span class="p">,</span> <span class="s">&#39;OLB&#39;</span><span class="p">,</span>
                        <span class="s">&#39;OT&#39;</span><span class="p">,</span> <span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="s">&#39;QB&#39;</span><span class="p">,</span> <span class="s">&#39;RB&#39;</span><span class="p">,</span> <span class="s">&#39;SAF&#39;</span><span class="p">,</span> <span class="s">&#39;SS&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="s">&#39;TE&#39;</span><span class="p">,</span> <span class="s">&#39;WR&#39;</span><span class="p">,</span>
                        <span class="s">&#39;UNK&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The set of all possible player positions in abbreviated form.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">player_status</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;player_status&#39;</span><span class="p">,</span>
                          <span class="p">[</span><span class="s">&#39;Active&#39;</span><span class="p">,</span> <span class="s">&#39;InjuredReserve&#39;</span><span class="p">,</span> <span class="s">&#39;NonFootballInjury&#39;</span><span class="p">,</span>
                           <span class="s">&#39;Suspended&#39;</span><span class="p">,</span> <span class="s">&#39;PUP&#39;</span><span class="p">,</span> <span class="s">&#39;UnsignedDraftPick&#39;</span><span class="p">,</span>
                           <span class="s">&#39;Exempt&#39;</span><span class="p">,</span> <span class="s">&#39;Unknown&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The current status of a player that is actively on a</span>
<span class="sd">    roster. The statuses are taken from the key at the bottom of</span>
<span class="sd">    http://goo.gl/HHsnjD</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">category_scope</span> <span class="o">=</span> <span class="n">_Enum</span><span class="p">(</span><span class="s">&#39;category_scope&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;play&#39;</span><span class="p">,</span> <span class="s">&#39;player&#39;</span><span class="p">])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The scope of a particular statistic. Typically, statistics refer</span>
<span class="sd">    to a specific `player`, but sometimes a statistic refers to the</span>
<span class="sd">    totality of a play. For example, `third_down_att` is a `play`</span>
<span class="sd">    statistic that records third down attempts.</span>

<span class="sd">    Currently, `play` and `player` are the only possible values.</span>

<span class="sd">    Note that this type is not represented directly in the database</span>
<span class="sd">    schema. Values of this type are constructed from data in</span>
<span class="sd">    `category.py`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nflgame_season_phase</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;PRE&#39;</span><span class="p">:</span> <span class="n">season_phase</span><span class="o">.</span><span class="n">Preseason</span><span class="p">,</span>
        <span class="s">&#39;REG&#39;</span><span class="p">:</span> <span class="n">season_phase</span><span class="o">.</span><span class="n">Regular</span><span class="p">,</span>
        <span class="s">&#39;POST&#39;</span><span class="p">:</span> <span class="n">season_phase</span><span class="o">.</span><span class="n">Postseason</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps a season type in `nflgame` to a `nfldb.Enums.season_phase`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nflgame_game_phase</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;Pregame&#39;</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Pregame</span><span class="p">,</span>
        <span class="s">&#39;Halftime&#39;</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="p">,</span>
        <span class="s">&#39;Final&#39;</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Final</span><span class="p">,</span>
        <span class="s">&#39;final&#39;</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Final</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Q1</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Half</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Q3</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">Q4</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">OT</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">:</span> <span class="n">game_phase</span><span class="o">.</span><span class="n">OT2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps a game phase in `nflgame` to a `nfldb.Enums.game_phase`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nflgame_game_day</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;Sun&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Sunday</span><span class="p">,</span>
        <span class="s">&#39;Mon&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Monday</span><span class="p">,</span>
        <span class="s">&#39;Tue&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Tuesday</span><span class="p">,</span>
        <span class="s">&#39;Wed&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Wednesday</span><span class="p">,</span>
        <span class="s">&#39;Thu&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Thursday</span><span class="p">,</span>
        <span class="s">&#39;Fri&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Friday</span><span class="p">,</span>
        <span class="s">&#39;Sat&#39;</span><span class="p">:</span> <span class="n">game_day</span><span class="o">.</span><span class="n">Saturday</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps a game day of the week in `nflgame` to a</span>
<span class="sd">    `nfldb.Enums.game_day`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nflgame_player_status</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;ACT&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">Active</span><span class="p">,</span>
        <span class="s">&#39;RES&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">InjuredReserve</span><span class="p">,</span>
        <span class="s">&#39;NON&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">NonFootballInjury</span><span class="p">,</span>
        <span class="s">&#39;Suspended&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">Suspended</span><span class="p">,</span>
        <span class="s">&#39;PUP&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">PUP</span><span class="p">,</span>
        <span class="s">&#39;UDF&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">UnsignedDraftPick</span><span class="p">,</span>
        <span class="s">&#39;EXE&#39;</span><span class="p">:</span> <span class="n">player_status</span><span class="o">.</span><span class="n">Exempt</span><span class="p">,</span>
        <span class="c"># Everything else is `player_status.Unknown`</span>
    <span class="p">}</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Enums">Enums</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="nfldb.Enums.category_scope" class="name">var <span class="ident">category_scope</span></p>
            

            
  
    <div class="desc"><p>The scope of a particular statistic. Typically, statistics refer
to a specific <code>player</code>, but sometimes a statistic refers to the
totality of a play. For example, <code>third_down_att</code> is a <code>play</code>
statistic that records third down attempts.</p>
<p>Currently, <code>play</code> and <code>player</code> are the only possible values.</p>
<p>Note that this type is not represented directly in the database
schema. Values of this type are constructed from data in
<code>category.py</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Enums.game_day" class="name">var <span class="ident">game_day</span></p>
            

            
  
    <div class="desc"><p>The day of the week on which a game was played. The week starts
on <code>Sunday</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Enums.game_phase" class="name">var <span class="ident">game_phase</span></p>
            

            
  
    <div class="desc"><p>Represents the phase of the game. e.g., <code>Q1</code> or <code>Half</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Enums.player_pos" class="name">var <span class="ident">player_pos</span></p>
            

            
  
    <div class="desc"><p>The set of all possible player positions in abbreviated form.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Enums.player_status" class="name">var <span class="ident">player_status</span></p>
            

            
  
    <div class="desc"><p>The current status of a player that is actively on a
roster. The statuses are taken from the key at the bottom of
http://goo.gl/HHsnjD</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Enums.season_phase" class="name">var <span class="ident">season_phase</span></p>
            

            
  
    <div class="desc"><p>Represents one of the three phases of an NFL season: <code>Preseason</code>,
<code>Regular</code> or <code>Postseason</code>.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.FieldPosition" class="name">class <span class="ident">FieldPosition</span></p>
      
  
    <div class="desc"><p>Represents field position.</p>
<p>The representation is an integer offset where the 50 yard line
corresponds to '0'. Being in one's own territory corresponds to a
negative offset while being in the opponent's territory corresponds
to a positive offset.</p>
<p>e.g., NE has the ball on the NE 45, the offset is -5.
e.g., NE has the ball on the NYG 2, the offset is 48.</p>
<p>This class also defines a total ordering on field
positions. Namely, given f1 and f2, f1 &lt; f2 if and only if f2
is closer to the goal line for the team with possession of the
football.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.FieldPosition', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.FieldPosition" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">FieldPosition</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents field position.</span>

<span class="sd">    The representation is an integer offset where the 50 yard line</span>
<span class="sd">    corresponds to &#39;0&#39;. Being in one&#39;s own territory corresponds to a</span>
<span class="sd">    negative offset while being in the opponent&#39;s territory corresponds</span>
<span class="sd">    to a positive offset.</span>

<span class="sd">    e.g., NE has the ball on the NE 45, the offset is -5.</span>
<span class="sd">    e.g., NE has the ball on the NYG 2, the offset is 48.</span>

<span class="sd">    This class also defines a total ordering on field</span>
<span class="sd">    positions. Namely, given f1 and f2, f1 &lt; f2 if and only if f2</span>
<span class="sd">    is closer to the goal line for the team with possession of the</span>
<span class="sd">    football.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;_offset&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pg_cast</span><span class="p">(</span><span class="n">sqlv</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sqlv</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sqlv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a string `pos` in the format `FIELD YARDLINE`, this</span>
<span class="sd">        returns a new `FieldPosition` object representing the yardline</span>
<span class="sd">        given. `FIELD` must be the string `OWN` or `OPP` and `YARDLINE`</span>
<span class="sd">        must be an integer in the range `[0, 50]`.</span>

<span class="sd">        For example, `OPP 19` corresponds to an offset of `31`</span>
<span class="sd">        and `OWN 5` corresponds to an offset of `-45`. Midfield can be</span>
<span class="sd">        expressed as either `MIDFIELD`, `OWN 50` or `OPP 50`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;MIDFIELD&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">field</span><span class="p">,</span> <span class="n">yrdline</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">yrdline</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">yrdline</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;OWN&#39;</span><span class="p">,</span> <span class="s">&#39;OPP&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">yrdline</span> <span class="o">&lt;=</span> <span class="mi">50</span>

        <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s">&#39;OWN&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">yrdline</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="n">yrdline</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a new `nfldb.FieldPosition` given a field `offset`.</span>
<span class="sd">        `offset` must be in the integer range [-50, 50].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="o">-</span><span class="mi">50</span> <span class="o">&lt;=</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">offset</span>

    <span class="k">def</span> <span class="nf">_add_yards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yards</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new `nfldb.FieldPosition` with `yards` added to this</span>
<span class="sd">        field position. The value of `yards` may be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span>
        <span class="n">newoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">+</span> <span class="n">yards</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">newoffset</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if and only if this field position is known and</span>
<span class="sd">        valid.</span>

<span class="sd">        Invalid field positions cannot be compared with other field</span>
<span class="sd">        positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldPosition</span><span class="p">):</span>
            <span class="n">toadd</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">toadd</span> <span class="o">=</span> <span class="n">other</span>
        <span class="n">newoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">+</span> <span class="n">toadd</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">newoffset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_offset</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_offset</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;N/A&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OPP </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OWN </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;MIDFIELD&#39;</span>

    <span class="k">def</span> <span class="nf">__conform__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="ow">is</span> <span class="n">ISQLQuote</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;NULL&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;ROW(</span><span class="si">%d</span><span class="s">)::field_pos&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.FieldPosition">FieldPosition</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.FieldPosition.from_str">
    <p>def <span class="ident">from_str</span>(</p><p>pos)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a string <code>pos</code> in the format <code>FIELD YARDLINE</code>, this
returns a new <code>FieldPosition</code> object representing the yardline
given. <code>FIELD</code> must be the string <code>OWN</code> or <code>OPP</code> and <code>YARDLINE</code>
must be an integer in the range <code>[0, 50]</code>.</p>
<p>For example, <code>OPP 19</code> corresponds to an offset of <code>31</code>
and <code>OWN 5</code> corresponds to an offset of <code>-45</code>. Midfield can be
expressed as either <code>MIDFIELD</code>, <code>OWN 50</code> or <code>OPP 50</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.FieldPosition.from_str', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.FieldPosition.from_str" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a string `pos` in the format `FIELD YARDLINE`, this</span>
<span class="sd">    returns a new `FieldPosition` object representing the yardline</span>
<span class="sd">    given. `FIELD` must be the string `OWN` or `OPP` and `YARDLINE`</span>
<span class="sd">    must be an integer in the range `[0, 50]`.</span>
<span class="sd">    For example, `OPP 19` corresponds to an offset of `31`</span>
<span class="sd">    and `OWN 5` corresponds to an offset of `-45`. Midfield can be</span>
<span class="sd">    expressed as either `MIDFIELD`, `OWN 50` or `OPP 50`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;MIDFIELD&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">field</span><span class="p">,</span> <span class="n">yrdline</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">,</span> <span class="n">yrdline</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">yrdline</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;OWN&#39;</span><span class="p">,</span> <span class="s">&#39;OPP&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">yrdline</span> <span class="o">&lt;=</span> <span class="mi">50</span>
    <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s">&#39;OWN&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">yrdline</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="n">yrdline</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.FieldPosition.valid" class="name">var <span class="ident">valid</span></p>
            

            
  
    <div class="desc"><p>Returns <code>True</code> if and only if this field position is known and
valid.</p>
<p>Invalid field positions cannot be compared with other field
positions.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.FieldPosition.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, offset)</p>
    </div>
    

    
  
    <div class="desc"><p>Makes a new <a href="#nfldb.FieldPosition"><code>FieldPosition</code></a> given a field <code>offset</code>.
<code>offset</code> must be in the integer range [-50, 50].</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.FieldPosition.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.FieldPosition.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a new `nfldb.FieldPosition` given a field `offset`.</span>
<span class="sd">    `offset` must be in the integer range [-50, 50].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>
    <span class="k">assert</span> <span class="o">-</span><span class="mi">50</span> <span class="o">&lt;=</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="mi">50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">offset</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Game" class="name">class <span class="ident">Game</span></p>
      
  
    <div class="desc"><p>Represents a single NFL game in the preseason, regular season or
post season. Each game has an assortment of meta data, including
a quarterly breakdown of scores, turnovers, the time the game
started, the season week the game occurred in, and more.</p>
<p>Each game corresponds to <strong>zero or more</strong> drives. A game usually
corresponds to at least one drive, but if the game is active, there
exist valid ephemeral states where a game has no drives.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Game</span> <span class="p">(</span><span class="n">SQLGame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single NFL game in the preseason, regular season or</span>
<span class="sd">    post season. Each game has an assortment of meta data, including</span>
<span class="sd">    a quarterly breakdown of scores, turnovers, the time the game</span>
<span class="sd">    started, the season week the game occurred in, and more.</span>

<span class="sd">    Each game corresponds to **zero or more** drives. A game usually</span>
<span class="sd">    corresponds to at least one drive, but if the game is active, there</span>
<span class="sd">    exist valid ephemeral states where a game has no drives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="n">SQLGame</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;_db&#39;</span><span class="p">,</span> <span class="s">&#39;_drives&#39;</span><span class="p">,</span> <span class="s">&#39;_plays&#39;</span><span class="p">]</span>

    <span class="c"># Document instance variables for derived SQL fields.</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Game.winner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;The winner of this game.&#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Game.loser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;The loser of this game.&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a `nflgame.game.Game` object to a `nfldb.Game`</span>
<span class="sd">        object.</span>

<span class="sd">        `db` should be a psycopg2 connection returned by</span>
<span class="sd">        `nfldb.connect`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbg</span> <span class="o">=</span> <span class="n">Game</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">eid</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">gamekey</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">_nflgame_start_time</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">schedule</span><span class="p">)</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;week&#39;</span><span class="p">]</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">day_of_week</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">_nflgame_game_day</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;wday&#39;</span><span class="p">]]</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">season_year</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">season_type</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">_nflgame_season_phase</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;season_type&#39;</span><span class="p">]]</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_team</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">home</span><span class="p">)</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score_q1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home_q1</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score_q2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home_q2</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score_q3</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home_q3</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score_q4</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home_q4</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_score_q5</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_home_q5</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">home_turnovers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;to&#39;</span><span class="p">])</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_team</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score_q1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away_q1</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score_q2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away_q2</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score_q3</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away_q3</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score_q4</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away_q4</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_score_q5</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">score_away_q5</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">away_turnovers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;to&#39;</span><span class="p">])</span>

        <span class="c"># If it&#39;s been 8 hours since game start, we always conclude finished!</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">dbg</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">dbg</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">dbg</span><span class="o">.</span><span class="n">_drives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">drives</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s">&#39;game&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">dbg</span><span class="o">.</span><span class="n">_drives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Drive</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">drive</span><span class="p">))</span>
        <span class="n">dbg</span><span class="o">.</span><span class="n">_drives</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">drive_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dbg</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_schedule</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a schedule dictionary from the `nflgame.schedule`</span>
<span class="sd">        module to a bare-bones `nfldb.Game` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This is about as evil as it gets. Duck typing to the MAX!</span>
        <span class="k">class</span> <span class="nc">_Game</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">s</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s">&#39;gamekey&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drives</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">False</span>

                <span class="n">zeroes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;score_</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q1&#39;</span><span class="p">,</span> <span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q2&#39;</span><span class="p">,</span>
                          <span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q3&#39;</span><span class="p">,</span> <span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q4&#39;</span><span class="p">,</span> <span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q5&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">which</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">((</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;away&#39;</span><span class="p">),</span> <span class="n">zeroes</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span> <span class="o">%</span> <span class="n">which</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;home&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s">&#39;away&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>
        <span class="k">return</span> <span class="n">Game</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">_Game</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a GSIS identifier (e.g., `2012090500`) as a string,</span>
<span class="sd">        returns a `nfldb.Game` object corresponding to `gsis_id`.</span>

<span class="sd">        If no corresponding game is found, `None` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">nfldb.query</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">games</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">as_games</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">games</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">games</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new and empty `nfldb.Game` object with the given</span>
<span class="sd">        database connection.</span>

<span class="sd">        This constructor should not be used by clients. Instead, you</span>
<span class="sd">        should get `nfldb.Game` objects from `nfldb.Query` or from one</span>
<span class="sd">        of the other constructors, like `nfldb.Game.from_id` or</span>
<span class="sd">        `nfldb.Game.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">        writing your own SQL queries.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The psycopg2 database connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The NFL GameCenter id of the game. It is a string</span>
<span class="sd">        with 10 characters. The first 8 correspond to the date of the</span>
<span class="sd">        game, while the last 2 correspond to an id unique to the week that</span>
<span class="sd">        the game was played.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another unique identifier for a game used by the</span>
<span class="sd">        NFL. It is a sequence number represented as a 5 character string.</span>
<span class="sd">        The gamekey is specifically used to tie games to other resources,</span>
<span class="sd">        like the NFL&#39;s content delivery network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A Python datetime object corresponding to the start time of</span>
<span class="sd">        the game. The timezone of this value will be equivalent to the</span>
<span class="sd">        timezone specified by `nfldb.set_timezone` (which is by default</span>
<span class="sd">        set to the value specified in the configuration file).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The week number of this game. It is always relative</span>
<span class="sd">        to the phase of the season. Namely, the first week of preseason</span>
<span class="sd">        is 1 and so is the first week of the regular season.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">day_of_week</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The day of the week this game was played on.</span>
<span class="sd">        Possible values correspond to the `nfldb.Enums.game_day` enum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">season_year</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The year of the season of this game. This</span>
<span class="sd">        does not necessarily match the year that the game was played. For</span>
<span class="sd">        example, games played in January 2013 are in season 2012.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">season_type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The phase of the season. e.g., `Preseason`,</span>
<span class="sd">        `Regular season` or `Postseason`. All valid values correspond</span>
<span class="sd">        to the `nfldb.Enums.season_phase`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A boolean that is `True` if and only if the game has finished.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team abbreviation for the home team. Use the `nfldb.Team`</span>
<span class="sd">        constructor to get more information on a team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The current total score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 1st quarter score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 2nd quarter score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q3</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 3rd quarter score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q4</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 4th quarter score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q5</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The OT quarter score for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_turnovers</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;Total turnovers for the home team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team abbreviation for the away team. Use the `nfldb.Team`</span>
<span class="sd">        constructor to get more information on a team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The current total score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 1st quarter score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 2nd quarter score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q3</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 3rd quarter score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q4</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The 4th quarter score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q5</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The OT quarter score for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away_turnovers</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;Total turnovers for the away team.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The date and time that this game was added.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The date and time that this game was last updated.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The team abbreviation for the winner of this game.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The team abbreviation for the loser of this game.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_playing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` is the game is currently being played and</span>
<span class="sd">        `False` otherwise.</span>

<span class="sd">        A game is being played if it is not finished and if the current</span>
<span class="sd">        time proceeds the game&#39;s start time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="ow">and</span> <span class="n">now</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of `nfldb.Drive`s for this game. They are automatically</span>
<span class="sd">        loaded from the database if they haven&#39;t been already.</span>

<span class="sd">        If there are no drives found in the game, then an empty list</span>
<span class="sd">        is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nfldb.query</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">)</span><span class="o">.</span><span class="n">as_drives</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of `nfldb.Play` objects in this game. Data is retrieved</span>
<span class="sd">        from the database if it hasn&#39;t been already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nfldb.query</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
            <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;play_id&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">)</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span>

    <span class="k">def</span> <span class="nf">plays_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of `nfldb.Play` objects for this game in the</span>
<span class="sd">        time range specified. The range corresponds to a half-open</span>
<span class="sd">        interval, i.e., `[start, end)`. Namely, all plays starting at</span>
<span class="sd">        or after `start` up to plays starting *before* `end`.</span>

<span class="sd">        The plays are returned in the order in which they occurred.</span>

<span class="sd">        `start` and `end` should be instances of the</span>
<span class="sd">        `nfldb.Clock` class. (Hint: Values can be created with the</span>
<span class="sd">        `nfldb.Clock.from_str` function.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">nfldb.query</span> <span class="kn">as</span> <span class="nn">query</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">time__ge</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">time__lt</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;play_id&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">score_in_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plays</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the scores made by the home and away teams from the</span>
<span class="sd">        sequence of plays given. The scores are returned as a `(home,</span>
<span class="sd">        away)` tuple. Note that this method assumes that `plays` is</span>
<span class="sd">        sorted in the order in which the plays occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This method is a heuristic to compute the total number of points</span>
        <span class="c"># scored in a set of plays. Naively, this should be a simple summation</span>
        <span class="c"># of the `points` attribute of each field. However, it seems that</span>
        <span class="c"># the JSON feed (where this data comes from) heavily biases toward</span>
        <span class="c"># omitting XPs. Therefore, we attempt to add them. A brief outline</span>
        <span class="c"># of the heuristic follows.</span>
        <span class="c">#</span>
        <span class="c"># In *most* cases, a TD is followed by either an XP attempt or a 2 PTC</span>
        <span class="c"># attempt by the same team. Therefore, after each TD, we look for the</span>
        <span class="c"># next play that fits this criteria, while being careful not to find</span>
        <span class="c"># a play that has already counted toward the score. If no play was</span>
        <span class="c"># found, then we assume there was an XP attempt and that it was good.</span>
        <span class="c"># Otherwise, if a play is found matching the given TD, the point total</span>
        <span class="c"># of that play is added to the score.</span>
        <span class="c">#</span>
        <span class="c"># Note that this relies on the property that every TD is paired with</span>
        <span class="c"># an XP/2PTC with respect to the final score of a game. Namely, when</span>
        <span class="c"># searching for the XP/2PTC after a TD, it may find a play that came</span>
        <span class="c"># after a different TD. But this is OK, so long as we never double</span>
        <span class="c"># count any particular play.</span>
        <span class="k">def</span> <span class="nf">is_twopta</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">passing_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">receiving_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">rushing_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">counted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c"># don&#39;t double count</span>
        <span class="n">home</span><span class="p">,</span> <span class="n">away</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plays</span><span class="p">):</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">points</span>
            <span class="k">if</span> <span class="n">pts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">:</span>
                <span class="n">counted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pts</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="k">def</span> <span class="nf">after_td</span><span class="p">(</span><span class="n">p2</span><span class="p">):</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">==</span> <span class="n">p2</span><span class="o">.</span><span class="n">pos_team</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">kicking_xpa</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">is_twopta</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
                                <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">)</span>

                    <span class="nb">next</span> <span class="o">=</span> <span class="n">_next_play_with</span><span class="p">(</span><span class="n">plays</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">after_td</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">next</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">pts</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="nb">next</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">:</span>
                        <span class="n">pts</span> <span class="o">+=</span> <span class="nb">next</span><span class="o">.</span><span class="n">points</span>
                        <span class="n">counted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">next</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">scoring_team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_team</span><span class="p">:</span>
                    <span class="n">home</span> <span class="o">+=</span> <span class="n">pts</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">away</span> <span class="o">+=</span> <span class="n">pts</span>
        <span class="k">return</span> <span class="n">home</span><span class="p">,</span> <span class="n">away</span>

    <span class="k">def</span> <span class="nf">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the score of the game at the time specified as a</span>
<span class="sd">        `(home, away)` tuple.</span>

<span class="sd">        `time` should be an instance of the `nfldb.Clock` class.</span>
<span class="sd">        (Hint: Values can be created with the `nfldb.Clock.from_str`</span>
<span class="sd">        function.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s">&#39;Pregame&#39;</span><span class="p">,</span> <span class="s">&#39;0:00&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_in_plays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plays_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of `nfldb.PlayPlayer` objects in this game. Data is</span>
<span class="sd">        retrieved from the database if it hasn&#39;t been already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plays</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play</span><span class="o">.</span><span class="n">play_players</span><span class="p">:</span>
                <span class="n">pps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pps</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of tuples of player data. The first element is the team</span>
<span class="sd">        the player was on during the game and the second element is a</span>
<span class="sd">        `nfldb.Player` object corresponding to that player&#39;s meta data</span>
<span class="sd">        (including the team he&#39;s currently on). The list is returned</span>
<span class="sd">        without duplicates and sorted by team and player name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">players</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_players</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">player_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pset</span><span class="p">:</span>
                <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pp</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">player</span><span class="p">))</span>
                <span class="n">pset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Game</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Remove any drives that are stale.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            DELETE FROM drive</span>
<span class="s">            WHERE gsis_id = </span><span class="si">%s</span><span class="s"> AND NOT (drive_id = ANY (</span><span class="si">%s</span><span class="s">))</span>
<span class="s">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">drive_id</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="ow">or</span> <span class="p">[]):</span>
            <span class="n">drive</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s"> week </span><span class="si">%d</span><span class="s"> on </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">) at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%m/</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%I:%M%p&#39;</span><span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away_score</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_score</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Game">Game</a></li>
          <li>nfldb.types.SQLGame</li>
          <li>nfldb.sql.Entity</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Game.from_id">
    <p>def <span class="ident">from_id</span>(</p><p>db, gsis_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a GSIS identifier (e.g., <code>2012090500</code>) as a string,
returns a <a href="#nfldb.Game"><code>Game</code></a> object corresponding to <code>gsis_id</code>.</p>
<p>If no corresponding game is found, <code>None</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.from_id', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.from_id" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a GSIS identifier (e.g., `2012090500`) as a string,</span>
<span class="sd">    returns a `nfldb.Game` object corresponding to `gsis_id`.</span>
<span class="sd">    If no corresponding game is found, `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">nfldb.query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">games</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">as_games</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">games</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">games</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Game.away_score" class="name">var <span class="ident">away_score</span></p>
            

            
  
    <div class="desc"><p>The current total score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_score_q1" class="name">var <span class="ident">away_score_q1</span></p>
            

            
  
    <div class="desc"><p>The 1st quarter score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_score_q2" class="name">var <span class="ident">away_score_q2</span></p>
            

            
  
    <div class="desc"><p>The 2nd quarter score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_score_q3" class="name">var <span class="ident">away_score_q3</span></p>
            

            
  
    <div class="desc"><p>The 3rd quarter score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_score_q4" class="name">var <span class="ident">away_score_q4</span></p>
            

            
  
    <div class="desc"><p>The 4th quarter score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_score_q5" class="name">var <span class="ident">away_score_q5</span></p>
            

            
  
    <div class="desc"><p>The OT quarter score for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_team" class="name">var <span class="ident">away_team</span></p>
            

            
  
    <div class="desc"><p>The team abbreviation for the away team. Use the <a href="#nfldb.Team"><code>Team</code></a>
constructor to get more information on a team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.away_turnovers" class="name">var <span class="ident">away_turnovers</span></p>
            

            
  
    <div class="desc"><p>Total turnovers for the away team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.day_of_week" class="name">var <span class="ident">day_of_week</span></p>
            

            
  
    <div class="desc"><p>The day of the week this game was played on.
Possible values correspond to the <a href="#nfldb.Enums.game_day"><code>game_day</code></a> enum.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.drives" class="name">var <span class="ident">drives</span></p>
            

            
  
    <div class="desc"><p>A list of <a href="#nfldb.Drive"><code>Drive</code></a>s for this game. They are automatically
loaded from the database if they haven't been already.</p>
<p>If there are no drives found in the game, then an empty list
is returned.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.finished" class="name">var <span class="ident">finished</span></p>
            

            
  
    <div class="desc"><p>A boolean that is <code>True</code> if and only if the game has finished.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.gamekey" class="name">var <span class="ident">gamekey</span></p>
            

            
  
    <div class="desc"><p>Another unique identifier for a game used by the
NFL. It is a sequence number represented as a 5 character string.
The gamekey is specifically used to tie games to other resources,
like the NFL's content delivery network.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.gsis_id" class="name">var <span class="ident">gsis_id</span></p>
            

            
  
    <div class="desc"><p>The NFL GameCenter id of the game. It is a string
with 10 characters. The first 8 correspond to the date of the
game, while the last 2 correspond to an id unique to the week that
the game was played.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score" class="name">var <span class="ident">home_score</span></p>
            

            
  
    <div class="desc"><p>The current total score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score_q1" class="name">var <span class="ident">home_score_q1</span></p>
            

            
  
    <div class="desc"><p>The 1st quarter score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score_q2" class="name">var <span class="ident">home_score_q2</span></p>
            

            
  
    <div class="desc"><p>The 2nd quarter score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score_q3" class="name">var <span class="ident">home_score_q3</span></p>
            

            
  
    <div class="desc"><p>The 3rd quarter score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score_q4" class="name">var <span class="ident">home_score_q4</span></p>
            

            
  
    <div class="desc"><p>The 4th quarter score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_score_q5" class="name">var <span class="ident">home_score_q5</span></p>
            

            
  
    <div class="desc"><p>The OT quarter score for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_team" class="name">var <span class="ident">home_team</span></p>
            

            
  
    <div class="desc"><p>The team abbreviation for the home team. Use the <a href="#nfldb.Team"><code>Team</code></a>
constructor to get more information on a team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.home_turnovers" class="name">var <span class="ident">home_turnovers</span></p>
            

            
  
    <div class="desc"><p>Total turnovers for the home team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.is_playing" class="name">var <span class="ident">is_playing</span></p>
            

            
  
    <div class="desc"><p>Returns <code>True</code> is the game is currently being played and
<code>False</code> otherwise.</p>
<p>A game is being played if it is not finished and if the current
time proceeds the game's start time.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.loser" class="name">var <span class="ident">loser</span></p>
            

            
  
    <div class="desc"><p>The loser of this game.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.play_players" class="name">var <span class="ident">play_players</span></p>
            

            
  
    <div class="desc"><p>A list of <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> objects in this game. Data is
retrieved from the database if it hasn't been already.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.players" class="name">var <span class="ident">players</span></p>
            

            
  
    <div class="desc"><p>A list of tuples of player data. The first element is the team
the player was on during the game and the second element is a
<a href="#nfldb.Player"><code>Player</code></a> object corresponding to that player's meta data
(including the team he's currently on). The list is returned
without duplicates and sorted by team and player name.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.plays" class="name">var <span class="ident">plays</span></p>
            

            
  
    <div class="desc"><p>A list of <a href="#nfldb.Play"><code>Play</code></a> objects in this game. Data is retrieved
from the database if it hasn't been already.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.season_type" class="name">var <span class="ident">season_type</span></p>
            

            
  
    <div class="desc"><p>The phase of the season. e.g., <code>Preseason</code>,
<code>Regular season</code> or <code>Postseason</code>. All valid values correspond
to the <a href="#nfldb.Enums.season_phase"><code>season_phase</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.season_year" class="name">var <span class="ident">season_year</span></p>
            

            
  
    <div class="desc"><p>The year of the season of this game. This
does not necessarily match the year that the game was played. For
example, games played in January 2013 are in season 2012.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.start_time" class="name">var <span class="ident">start_time</span></p>
            

            
  
    <div class="desc"><p>A Python datetime object corresponding to the start time of
the game. The timezone of this value will be equivalent to the
timezone specified by <a href="#nfldb.set_timezone"><code>set_timezone</code></a> (which is by default
set to the value specified in the configuration file).</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.time_inserted" class="name">var <span class="ident">time_inserted</span></p>
            

            
  
    <div class="desc"><p>The date and time that this game was added.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.time_updated" class="name">var <span class="ident">time_updated</span></p>
            

            
  
    <div class="desc"><p>The date and time that this game was last updated.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.week" class="name">var <span class="ident">week</span></p>
            

            
  
    <div class="desc"><p>The week number of this game. It is always relative
to the phase of the season. Namely, the first week of preseason
is 1 and so is the first week of the regular season.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Game.winner" class="name">var <span class="ident">winner</span></p>
            

            
  
    <div class="desc"><p>The winner of this game.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Game.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new and empty <a href="#nfldb.Game"><code>Game</code></a> object with the given
database connection.</p>
<p>This constructor should not be used by clients. Instead, you
should get <a href="#nfldb.Game"><code>Game</code></a> objects from <a href="#nfldb.Query"><code>Query</code></a> or from one
of the other constructors, like <a href="#nfldb.Game.from_id"><code>from_id</code></a> or
<a href="#nfldb.Game.from_row_dict"><code>from_row_dict</code></a>. (The latter is useful only if you're
writing your own SQL queries.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new and empty `nfldb.Game` object with the given</span>
<span class="sd">    database connection.</span>
<span class="sd">    This constructor should not be used by clients. Instead, you</span>
<span class="sd">    should get `nfldb.Game` objects from `nfldb.Query` or from one</span>
<span class="sd">    of the other constructors, like `nfldb.Game.from_id` or</span>
<span class="sd">    `nfldb.Game.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">    writing your own SQL queries.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The psycopg2 database connection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_drives</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_plays</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The NFL GameCenter id of the game. It is a string</span>
<span class="sd">    with 10 characters. The first 8 correspond to the date of the</span>
<span class="sd">    game, while the last 2 correspond to an id unique to the week that</span>
<span class="sd">    the game was played.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Another unique identifier for a game used by the</span>
<span class="sd">    NFL. It is a sequence number represented as a 5 character string.</span>
<span class="sd">    The gamekey is specifically used to tie games to other resources,</span>
<span class="sd">    like the NFL&#39;s content delivery network.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Python datetime object corresponding to the start time of</span>
<span class="sd">    the game. The timezone of this value will be equivalent to the</span>
<span class="sd">    timezone specified by `nfldb.set_timezone` (which is by default</span>
<span class="sd">    set to the value specified in the configuration file).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The week number of this game. It is always relative</span>
<span class="sd">    to the phase of the season. Namely, the first week of preseason</span>
<span class="sd">    is 1 and so is the first week of the regular season.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">day_of_week</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The day of the week this game was played on.</span>
<span class="sd">    Possible values correspond to the `nfldb.Enums.game_day` enum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">season_year</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The year of the season of this game. This</span>
<span class="sd">    does not necessarily match the year that the game was played. For</span>
<span class="sd">    example, games played in January 2013 are in season 2012.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">season_type</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The phase of the season. e.g., `Preseason`,</span>
<span class="sd">    `Regular season` or `Postseason`. All valid values correspond</span>
<span class="sd">    to the `nfldb.Enums.season_phase`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A boolean that is `True` if and only if the game has finished.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team abbreviation for the home team. Use the `nfldb.Team`</span>
<span class="sd">    constructor to get more information on a team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The current total score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q1</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 1st quarter score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q2</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 2nd quarter score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q3</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 3rd quarter score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q4</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 4th quarter score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_score_q5</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The OT quarter score for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home_turnovers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;Total turnovers for the home team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team abbreviation for the away team. Use the `nfldb.Team`</span>
<span class="sd">    constructor to get more information on a team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The current total score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q1</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 1st quarter score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q2</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 2nd quarter score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q3</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 3rd quarter score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q4</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The 4th quarter score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_score_q5</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The OT quarter score for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away_turnovers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;Total turnovers for the away team.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The date and time that this game was added.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The date and time that this game was last updated.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The team abbreviation for the winner of this game.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The team abbreviation for the loser of this game.&quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.from_row_dict">
    <p>def <span class="ident">from_row_dict</span>(</p><p>cls, db, row)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new entity object from a full SQL row result from
the entity's tables. (i.e., <code>row</code> is a dictionary mapping
column to value.) Note that the column names must be of the
form '{entity_name}_{column_name}'. For example, in the <code>game</code>
table, the <code>gsis_id</code> column must be named <code>game_gsis_id</code> in
<code>row</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.from_row_dict', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.from_row_dict" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new entity object from a full SQL row result from</span>
<span class="sd">    the entity&#39;s tables. (i.e., `row` is a dictionary mapping</span>
<span class="sd">    column to value.) Note that the column names must be of the</span>
<span class="sd">    form &#39;{entity_name}_{column_name}&#39;. For example, in the `game`</span>
<span class="sd">    table, the `gsis_id` column must be named `game_gsis_id` in</span>
<span class="sd">    `row`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_primary_table</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span>
    <span class="n">slice_from</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">slice_from</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.from_row_tuple">
    <p>def <span class="ident">from_row_tuple</span>(</p><p>cls, db, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tuple <code>t</code> corresponding to a result from a SELECT query,
this will construct a new instance for this entity. Note that
the tuple <code>t</code> must be in <em>exact</em> correspondence with the columns
returned by <code>nfldb.Entity.sql_fields</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.from_row_tuple', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.from_row_tuple" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tuple `t` corresponding to a result from a SELECT query,</span>
<span class="sd">    this will construct a new instance for this entity. Note that</span>
<span class="sd">    the tuple `t` must be in *exact* correspondence with the columns</span>
<span class="sd">    returned by `nfldb.Entity.sql_fields`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.plays_range">
    <p>def <span class="ident">plays_range</span>(</p><p>self, start, end)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of <a href="#nfldb.Play"><code>Play</code></a> objects for this game in the
time range specified. The range corresponds to a half-open
interval, i.e., <code>[start, end)</code>. Namely, all plays starting at
or after <code>start</code> up to plays starting <em>before</em> <code>end</code>.</p>
<p>The plays are returned in the order in which they occurred.</p>
<p><code>start</code> and <code>end</code> should be instances of the
<a href="#nfldb.Clock"><code>Clock</code></a> class. (Hint: Values can be created with the
<a href="#nfldb.Clock.from_str"><code>from_str</code></a> function.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.plays_range', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.plays_range" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">plays_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of `nfldb.Play` objects for this game in the</span>
<span class="sd">    time range specified. The range corresponds to a half-open</span>
<span class="sd">    interval, i.e., `[start, end)`. Namely, all plays starting at</span>
<span class="sd">    or after `start` up to plays starting *before* `end`.</span>
<span class="sd">    The plays are returned in the order in which they occurred.</span>
<span class="sd">    `start` and `end` should be instances of the</span>
<span class="sd">    `nfldb.Clock` class. (Hint: Values can be created with the</span>
<span class="sd">    `nfldb.Clock.from_str` function.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">nfldb.query</span> <span class="kn">as</span> <span class="nn">query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">time__ge</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">time__lt</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;play_id&#39;</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.score_at_time">
    <p>def <span class="ident">score_at_time</span>(</p><p>self, time)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the score of the game at the time specified as a
<code>(home, away)</code> tuple.</p>
<p><code>time</code> should be an instance of the <a href="#nfldb.Clock"><code>Clock</code></a> class.
(Hint: Values can be created with the <a href="#nfldb.Clock.from_str"><code>from_str</code></a>
function.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.score_at_time', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.score_at_time" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the score of the game at the time specified as a</span>
<span class="sd">    `(home, away)` tuple.</span>
<span class="sd">    `time` should be an instance of the `nfldb.Clock` class.</span>
<span class="sd">    (Hint: Values can be created with the `nfldb.Clock.from_str`</span>
<span class="sd">    function.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s">&#39;Pregame&#39;</span><span class="p">,</span> <span class="s">&#39;0:00&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_in_plays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plays_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.score_in_plays">
    <p>def <span class="ident">score_in_plays</span>(</p><p>self, plays)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the scores made by the home and away teams from the
sequence of plays given. The scores are returned as a <code>(home,
away)</code> tuple. Note that this method assumes that <code>plays</code> is
sorted in the order in which the plays occurred.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.score_in_plays', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.score_in_plays" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">score_in_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plays</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the scores made by the home and away teams from the</span>
<span class="sd">    sequence of plays given. The scores are returned as a `(home,</span>
<span class="sd">    away)` tuple. Note that this method assumes that `plays` is</span>
<span class="sd">    sorted in the order in which the plays occurred.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># This method is a heuristic to compute the total number of points</span>
    <span class="c"># scored in a set of plays. Naively, this should be a simple summation</span>
    <span class="c"># of the `points` attribute of each field. However, it seems that</span>
    <span class="c"># the JSON feed (where this data comes from) heavily biases toward</span>
    <span class="c"># omitting XPs. Therefore, we attempt to add them. A brief outline</span>
    <span class="c"># of the heuristic follows.</span>
    <span class="c">#</span>
    <span class="c"># In *most* cases, a TD is followed by either an XP attempt or a 2 PTC</span>
    <span class="c"># attempt by the same team. Therefore, after each TD, we look for the</span>
    <span class="c"># next play that fits this criteria, while being careful not to find</span>
    <span class="c"># a play that has already counted toward the score. If no play was</span>
    <span class="c"># found, then we assume there was an XP attempt and that it was good.</span>
    <span class="c"># Otherwise, if a play is found matching the given TD, the point total</span>
    <span class="c"># of that play is added to the score.</span>
    <span class="c">#</span>
    <span class="c"># Note that this relies on the property that every TD is paired with</span>
    <span class="c"># an XP/2PTC with respect to the final score of a game. Namely, when</span>
    <span class="c"># searching for the XP/2PTC after a TD, it may find a play that came</span>
    <span class="c"># after a different TD. But this is OK, so long as we never double</span>
    <span class="c"># count any particular play.</span>
    <span class="k">def</span> <span class="nf">is_twopta</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">passing_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">receiving_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">rushing_twopta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">counted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c"># don&#39;t double count</span>
    <span class="n">home</span><span class="p">,</span> <span class="n">away</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plays</span><span class="p">):</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">points</span>
        <span class="k">if</span> <span class="n">pts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">:</span>
            <span class="n">counted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pts</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">after_td</span><span class="p">(</span><span class="n">p2</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">==</span> <span class="n">p2</span><span class="o">.</span><span class="n">pos_team</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">kicking_xpa</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">is_twopta</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
                            <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">)</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="n">_next_play_with</span><span class="p">(</span><span class="n">plays</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">after_td</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">next</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="nb">next</span><span class="o">.</span><span class="n">play_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counted</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">+=</span> <span class="nb">next</span><span class="o">.</span><span class="n">points</span>
                    <span class="n">counted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">next</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">scoring_team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_team</span><span class="p">:</span>
                <span class="n">home</span> <span class="o">+=</span> <span class="n">pts</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">away</span> <span class="o">+=</span> <span class="n">pts</span>
    <span class="k">return</span> <span class="n">home</span><span class="p">,</span> <span class="n">away</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Game.sql_fields">
    <p>def <span class="ident">sql_fields</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of all SQL fields across all tables for this
entity, including derived fields. This method can be used
in conjunction with <code>nfldb.Entity.from_row_tuple</code> to quickly
create new <code>nfldb</code> objects without every constructing a dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Game.sql_fields', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Game.sql_fields" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sql_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all SQL fields across all tables for this</span>
<span class="sd">    entity, including derived fields. This method can be used</span>
<span class="sd">    in conjunction with `nfldb.Entity.from_row_tuple` to quickly</span>
<span class="sd">    create new `nfldb` objects without every constructing a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_cached_sql_fields&#39;</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_columns</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">+=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Play" class="name">class <span class="ident">Play</span></p>
      
  
    <div class="desc"><p>Represents a single play in an NFL game. Each play has an
assortment of meta data, possibly including the time on the clock
in which the ball was snapped, the starting field position, the
down, yards to go, etc. Not all plays have values for each field
(for example, a timeout is considered a play but has no data for
<a href="#nfldb.Play.down"><code>down</code></a> or <a href="#nfldb.Play.yardline"><code>yardline</code></a>).</p>
<p>In addition to meta data describing the context of the game at the time
the ball was snapped, plays also have statistics corresponding to the
fields in <a href="#nfldb.stat_categories"><code>stat_categories</code></a> with a <a href="#nfldb.Category.category_type"><code>category_type</code></a>
of <code>play</code>. For example, <code>third_down_att</code>, <code>fourth_down_failed</code> and
<code>fourth_down_conv</code>. While the binary nature of these fields suggest
a boolean value, they are actually integers. This makes them amenable
to aggregation.</p>
<p>Plays are also associated with player statistics or "events" that
occurred in a play. For example, in a single play one player could
pass the ball to another player. This is recorded as two different
player statistics: a pass and a reception. Each one is represented
as a <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> object. Plays may have <strong>zero or more</strong> of
these player statistics.</p>
<p>Finally, it is important to note that there are (currently) some
useful statistics missing. For example, there is currently no
reliable means of determining the time on the clock when the play
finished.  Also, there is no field describing the field position at
the end of the play, although this may be added in the future.</p>
<p>Most of the statistical fields are documented on the
<a href="http://goo.gl/YY587P">statistical categories</a>
wiki page. Each statistical field is an instance attribute in
this class.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Play</span> <span class="p">(</span><span class="n">SQLPlay</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single play in an NFL game. Each play has an</span>
<span class="sd">    assortment of meta data, possibly including the time on the clock</span>
<span class="sd">    in which the ball was snapped, the starting field position, the</span>
<span class="sd">    down, yards to go, etc. Not all plays have values for each field</span>
<span class="sd">    (for example, a timeout is considered a play but has no data for</span>
<span class="sd">    `nfldb.Play.down` or `nfldb.Play.yardline`).</span>

<span class="sd">    In addition to meta data describing the context of the game at the time</span>
<span class="sd">    the ball was snapped, plays also have statistics corresponding to the</span>
<span class="sd">    fields in `nfldb.stat_categories` with a `nfldb.Category.category_type`</span>
<span class="sd">    of `play`. For example, `third_down_att`, `fourth_down_failed` and</span>
<span class="sd">    `fourth_down_conv`. While the binary nature of these fields suggest</span>
<span class="sd">    a boolean value, they are actually integers. This makes them amenable</span>
<span class="sd">    to aggregation.</span>

<span class="sd">    Plays are also associated with player statistics or &quot;events&quot; that</span>
<span class="sd">    occurred in a play. For example, in a single play one player could</span>
<span class="sd">    pass the ball to another player. This is recorded as two different</span>
<span class="sd">    player statistics: a pass and a reception. Each one is represented</span>
<span class="sd">    as a `nfldb.PlayPlayer` object. Plays may have **zero or more** of</span>
<span class="sd">    these player statistics.</span>

<span class="sd">    Finally, it is important to note that there are (currently) some</span>
<span class="sd">    useful statistics missing. For example, there is currently no</span>
<span class="sd">    reliable means of determining the time on the clock when the play</span>
<span class="sd">    finished.  Also, there is no field describing the field position at</span>
<span class="sd">    the end of the play, although this may be added in the future.</span>

<span class="sd">    Most of the statistical fields are documented on the</span>
<span class="sd">    [statistical categories](http://goo.gl/YY587P)</span>
<span class="sd">    wiki page. Each statistical field is an instance attribute in</span>
<span class="sd">    this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="n">SQLPlay</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;_db&#39;</span><span class="p">,</span> <span class="s">&#39;_drive&#39;</span><span class="p">,</span> <span class="s">&#39;_play_players&#39;</span><span class="p">]</span>

    <span class="c"># Document instance variables for derived SQL fields.</span>
    <span class="c"># We hide them from the public interface, but make the doco</span>
    <span class="c"># available to nfldb-mk-stat-table. Evil!</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Play.offense_yds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_Play.offense_yds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any yardage that is manufactured by the offense.</span>
<span class="sd">        Namely, the following fields:</span>
<span class="sd">        `nfldb.Play.passing_yds`,</span>
<span class="sd">        `nfldb.Play.rushing_yds`,</span>
<span class="sd">        `nfldb.Play.receiving_yds` and</span>
<span class="sd">        `nfldb.Play.fumbles_rec_yds`.</span>

<span class="sd">        This field is useful when searching for plays by net yardage</span>
<span class="sd">        regardless of how the yards were obtained.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Play.offense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_Play.offense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any touchdown manufactured by the offense via</span>
<span class="sd">        a passing, reception, rush or fumble recovery.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Play.defense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_Play.defense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any touchdown manufactured by the defense.</span>
<span class="sd">        e.g., a pick-6, fumble recovery TD, punt/FG block TD, etc.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;Play.points&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of points scored in this player statistic. This</span>
<span class="sd">        accounts for touchdowns, extra points, two point conversions,</span>
<span class="sd">        field goals and safeties.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given `d` as a `nfldb.Drive` object and `p` as a</span>
<span class="sd">        `nflgame.game.Play` object, `_from_nflgame` converts `p` to a</span>
<span class="sd">        `nfldb.Play` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Fix up some fields so they meet the constraints of the schema.</span>
        <span class="c"># The `time` field is cleaned up afterwards in</span>
        <span class="c"># `nfldb.Drive._from_nflgame`, since it needs data about surrounding</span>
        <span class="c"># plays.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">time</span> <span class="k">else</span> <span class="n">_nflgame_clock</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">yardline</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">yardline</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">down</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">down</span> <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">down</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">team</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">team</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">team</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;UNK&#39;</span>

        <span class="n">dbplay</span> <span class="o">=</span> <span class="n">Play</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">gsis_id</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">drive_id</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">playid</span><span class="p">)</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="n">team</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="n">yardline</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">down</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">yards_to_go</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">yards_togo</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">desc</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">note</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_play_categories</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">dbplay</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c"># Note that `Play` objects also normally contain aggregated</span>
        <span class="c"># statistics, but we forgo that here because this constructor</span>
        <span class="c"># is only used to load plays into the database.</span>

        <span class="n">dbplay</span><span class="o">.</span><span class="n">_drive</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">dbplay</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="n">dbpp</span> <span class="o">=</span> <span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">dbplay</span><span class="p">,</span> <span class="n">pp</span><span class="p">)</span>
            <span class="n">dbplay</span><span class="o">.</span><span class="n">_play_players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dbpp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dbplay</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="p">,</span> <span class="n">play_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a GSIS identifier (e.g., `2012090500`) as a string,</span>
<span class="sd">        an integer drive id and an integer play id, this returns a</span>
<span class="sd">        `nfldb.Play` object corresponding to the given identifiers.</span>

<span class="sd">        If no corresponding play is found, then `None` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">nfldb.query</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="n">drive_id</span><span class="p">,</span> <span class="n">play_id</span><span class="o">=</span><span class="n">play_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plays</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">plays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_drives</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">plays</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of `plays`, fill all of their `drive` attributes</span>
<span class="sd">        using as few queries as possible. This will also fill the</span>
<span class="sd">        drives with game data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Drive</span><span class="p">,</span> <span class="n">plays</span><span class="p">,</span> <span class="s">&#39;_drive&#39;</span><span class="p">)</span>
        <span class="n">Drive</span><span class="o">.</span><span class="n">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">_drive</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plays</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new and empty `nfldb.Play` object with the given</span>
<span class="sd">        database connection.</span>

<span class="sd">        This constructor should not be used by clients. Instead, you</span>
<span class="sd">        should get `nfldb.Play` objects from `nfldb.Query` or from one</span>
<span class="sd">        of the other constructors, like `nfldb.Play.from_id` or</span>
<span class="sd">        `nfldb.Play.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">        writing your own SQL queries.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drive</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The GSIS identifier for the game that this play belongs to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numeric drive identifier for this play. It may be</span>
<span class="sd">        interpreted as a sequence number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numeric play identifier for this play. It can typically</span>
<span class="sd">        be interpreted as a sequence number scoped to the week that</span>
<span class="sd">        this game was played, but it&#39;s unfortunately not completely</span>
<span class="sd">        consistent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The time on the clock when the play started, represented with</span>
<span class="sd">        a `nfldb.Clock` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team in possession during this play, represented as</span>
<span class="sd">        a team abbreviation string. Use the `nfldb.Team` constructor</span>
<span class="sd">        to get more information on a team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The starting field position of this play represented with</span>
<span class="sd">        `nfldb.FieldPosition`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The down on which this play begin. This may be `0` for</span>
<span class="sd">        &quot;special&quot; plays like timeouts or 2 point conversions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yards_to_go</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of yards to go to get a first down or score a</span>
<span class="sd">        touchdown at the start of the play.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A (basically) free-form text description of the play. This is</span>
<span class="sd">        typically what you see on NFL GameCenter web pages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A miscellaneous note field (as a string). Not sure what it&#39;s</span>
<span class="sd">        used for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The date and time that this play was added to the</span>
<span class="sd">        database. This can be very useful when sorting plays by the</span>
<span class="sd">        order in which they occurred in real time. Unfortunately, such</span>
<span class="sd">        a sort requires that play data is updated relatively close to</span>
<span class="sd">        when it actually occurred.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The date and time that this play was last updated.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `nfldb.Drive` object that contains this play. The drive is</span>
<span class="sd">        retrieved from the database if it hasn&#39;t been already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drive</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drive</span> <span class="o">=</span> <span class="n">Drive</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drive</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of all `nfldb.PlayPlayer`s in this play. They are</span>
<span class="sd">        automatically retrieved from the database if they haven&#39;t been</span>
<span class="sd">        already.</span>

<span class="sd">        If there are no players attached to this play, then an empty</span>
<span class="sd">        list is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nfldb.query</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
            <span class="n">q</span><span class="o">.</span><span class="n">play_player</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span>
                          <span class="n">play_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_play_players</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span><span class="p">:</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scoring_team</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If this is a scoring play, returns the team that scored points.</span>
<span class="sd">        Otherwise, returns None.</span>

<span class="sd">        N.B. `nfldb.Play.scoring_team` returns a valid team if and only</span>
<span class="sd">        if `nfldb.Play.points` is greater than 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_players</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">scoring_team</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the score of the game immediately after this play as a</span>
<span class="sd">        tuple of the form `(home_score, away_score)`.</span>

<span class="sd">        If `before` is `True`, then the score will *not* include this</span>
<span class="sd">        play.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">Game</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="c"># The heuristic in `nfldb.Game.score_in_plays` blends TDs and XPs</span>
        <span class="c"># into a single play (with respect to scoring). So we have to undo</span>
        <span class="c"># that if we want the score of the game after a TD but before an XP.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kicking_xpmade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">score_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring_team</span>
            <span class="k">if</span> <span class="n">score_team</span> <span class="o">==</span> <span class="n">game</span><span class="o">.</span><span class="n">home_team</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Play</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

        <span class="c"># Remove any &quot;play players&quot; that are stale.</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            DELETE FROM play_player</span>
<span class="s">            WHERE gsis_id = </span><span class="si">%s</span><span class="s"> AND drive_id = </span><span class="si">%s</span><span class="s"> AND play_id = </span><span class="si">%s</span><span class="s"></span>
<span class="s">                  AND NOT (player_id = ANY (</span><span class="si">%s</span><span class="s">))</span>
<span class="s">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span><span class="p">,</span>
              <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">player_id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="ow">or</span> <span class="p">[])]))</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="ow">or</span> <span class="p">[]):</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s"> and </span><span class="si">%d</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                   <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yards_to_go</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                   <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Play</span><span class="o">.</span><span class="n">__slots__</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Play">Play</a></li>
          <li>nfldb.types.SQLPlay</li>
          <li>nfldb.sql.Entity</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Play.fill_drives">
    <p>def <span class="ident">fill_drives</span>(</p><p>db, plays)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <code>plays</code>, fill all of their <code>drive</code> attributes
using as few queries as possible. This will also fill the
drives with game data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.fill_drives', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.fill_drives" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fill_drives</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">plays</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of `plays`, fill all of their `drive` attributes</span>
<span class="sd">    using as few queries as possible. This will also fill the</span>
<span class="sd">    drives with game data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Drive</span><span class="p">,</span> <span class="n">plays</span><span class="p">,</span> <span class="s">&#39;_drive&#39;</span><span class="p">)</span>
    <span class="n">Drive</span><span class="o">.</span><span class="n">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">_drive</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plays</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Play.from_id">
    <p>def <span class="ident">from_id</span>(</p><p>db, gsis_id, drive_id, play_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a GSIS identifier (e.g., <code>2012090500</code>) as a string,
an integer drive id and an integer play id, this returns a
<a href="#nfldb.Play"><code>Play</code></a> object corresponding to the given identifiers.</p>
<p>If no corresponding play is found, then <code>None</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.from_id', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.from_id" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="p">,</span> <span class="n">play_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a GSIS identifier (e.g., `2012090500`) as a string,</span>
<span class="sd">    an integer drive id and an integer play id, this returns a</span>
<span class="sd">    `nfldb.Play` object corresponding to the given identifiers.</span>
<span class="sd">    If no corresponding play is found, then `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">nfldb.query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">gsis_id</span><span class="o">=</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">drive_id</span><span class="o">=</span><span class="n">drive_id</span><span class="p">,</span> <span class="n">play_id</span><span class="o">=</span><span class="n">play_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plays</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">plays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Play.description" class="name">var <span class="ident">description</span></p>
            

            
  
    <div class="desc"><p>A (basically) free-form text description of the play. This is
typically what you see on NFL GameCenter web pages.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.down" class="name">var <span class="ident">down</span></p>
            

            
  
    <div class="desc"><p>The down on which this play begin. This may be <code>0</code> for
"special" plays like timeouts or 2 point conversions.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.drive" class="name">var <span class="ident">drive</span></p>
            

            
  
    <div class="desc"><p>The <a href="#nfldb.Drive"><code>Drive</code></a> object that contains this play. The drive is
retrieved from the database if it hasn't been already.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.drive_id" class="name">var <span class="ident">drive_id</span></p>
            

            
  
    <div class="desc"><p>The numeric drive identifier for this play. It may be
interpreted as a sequence number.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.game_date" class="name">var <span class="ident">game_date</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.gsis_id" class="name">var <span class="ident">gsis_id</span></p>
            

            
  
    <div class="desc"><p>The GSIS identifier for the game that this play belongs to.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.note" class="name">var <span class="ident">note</span></p>
            

            
  
    <div class="desc"><p>A miscellaneous note field (as a string). Not sure what it's
used for.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.play_id" class="name">var <span class="ident">play_id</span></p>
            

            
  
    <div class="desc"><p>The numeric play identifier for this play. It can typically
be interpreted as a sequence number scoped to the week that
this game was played, but it's unfortunately not completely
consistent.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.play_players" class="name">var <span class="ident">play_players</span></p>
            

            
  
    <div class="desc"><p>A list of all <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a>s in this play. They are
automatically retrieved from the database if they haven't been
already.</p>
<p>If there are no players attached to this play, then an empty
list is returned.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.points" class="name">var <span class="ident">points</span></p>
            

            
  
    <div class="desc"><p>The number of points scored in this player statistic. This
accounts for touchdowns, extra points, two point conversions,
field goals and safeties.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.pos_team" class="name">var <span class="ident">pos_team</span></p>
            

            
  
    <div class="desc"><p>The team in possession during this play, represented as
a team abbreviation string. Use the <a href="#nfldb.Team"><code>Team</code></a> constructor
to get more information on a team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.scoring_team" class="name">var <span class="ident">scoring_team</span></p>
            

            
  
    <div class="desc"><p>If this is a scoring play, returns the team that scored points.
Otherwise, returns None.</p>
<p>N.B. <a href="#nfldb.Play.scoring_team"><code>scoring_team</code></a> returns a valid team if and only
if <a href="#nfldb.Play.points"><code>points</code></a> is greater than 0.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.time" class="name">var <span class="ident">time</span></p>
            

            
  
    <div class="desc"><p>The time on the clock when the play started, represented with
a <a href="#nfldb.Clock"><code>Clock</code></a> object.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.time_inserted" class="name">var <span class="ident">time_inserted</span></p>
            

            
  
    <div class="desc"><p>The date and time that this play was added to the
database. This can be very useful when sorting plays by the
order in which they occurred in real time. Unfortunately, such
a sort requires that play data is updated relatively close to
when it actually occurred.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.time_updated" class="name">var <span class="ident">time_updated</span></p>
            

            
  
    <div class="desc"><p>The date and time that this play was last updated.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.yardline" class="name">var <span class="ident">yardline</span></p>
            

            
  
    <div class="desc"><p>The starting field position of this play represented with
<a href="#nfldb.FieldPosition"><code>FieldPosition</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Play.yards_to_go" class="name">var <span class="ident">yards_to_go</span></p>
            

            
  
    <div class="desc"><p>The number of yards to go to get a first down or score a
touchdown at the start of the play.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Play.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new and empty <a href="#nfldb.Play"><code>Play</code></a> object with the given
database connection.</p>
<p>This constructor should not be used by clients. Instead, you
should get <a href="#nfldb.Play"><code>Play</code></a> objects from <a href="#nfldb.Query"><code>Query</code></a> or from one
of the other constructors, like <a href="#nfldb.Play.from_id"><code>from_id</code></a> or
<a href="#nfldb.Play.from_row_dict"><code>from_row_dict</code></a>. (The latter is useful only if you're
writing your own SQL queries.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new and empty `nfldb.Play` object with the given</span>
<span class="sd">    database connection.</span>
<span class="sd">    This constructor should not be used by clients. Instead, you</span>
<span class="sd">    should get `nfldb.Play` objects from `nfldb.Query` or from one</span>
<span class="sd">    of the other constructors, like `nfldb.Play.from_id` or</span>
<span class="sd">    `nfldb.Play.from_row_dict`. (The latter is useful only if you&#39;re</span>
<span class="sd">    writing your own SQL queries.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_drive</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GSIS identifier for the game that this play belongs to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The numeric drive identifier for this play. It may be</span>
<span class="sd">    interpreted as a sequence number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The numeric play identifier for this play. It can typically</span>
<span class="sd">    be interpreted as a sequence number scoped to the week that</span>
<span class="sd">    this game was played, but it&#39;s unfortunately not completely</span>
<span class="sd">    consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The time on the clock when the play started, represented with</span>
<span class="sd">    a `nfldb.Clock` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team in possession during this play, represented as</span>
<span class="sd">    a team abbreviation string. Use the `nfldb.Team` constructor</span>
<span class="sd">    to get more information on a team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The starting field position of this play represented with</span>
<span class="sd">    `nfldb.FieldPosition`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The down on which this play begin. This may be `0` for</span>
<span class="sd">    &quot;special&quot; plays like timeouts or 2 point conversions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yards_to_go</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The number of yards to go to get a first down or score a</span>
<span class="sd">    touchdown at the start of the play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A (basically) free-form text description of the play. This is</span>
<span class="sd">    typically what you see on NFL GameCenter web pages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A miscellaneous note field (as a string). Not sure what it&#39;s</span>
<span class="sd">    used for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_inserted</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The date and time that this play was added to the</span>
<span class="sd">    database. This can be very useful when sorting plays by the</span>
<span class="sd">    order in which they occurred in real time. Unfortunately, such</span>
<span class="sd">    a sort requires that play data is updated relatively close to</span>
<span class="sd">    when it actually occurred.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_updated</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The date and time that this play was last updated.&quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Play.from_row_dict">
    <p>def <span class="ident">from_row_dict</span>(</p><p>cls, db, row)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new entity object from a full SQL row result from
the entity's tables. (i.e., <code>row</code> is a dictionary mapping
column to value.) Note that the column names must be of the
form '{entity_name}_{column_name}'. For example, in the <code>game</code>
table, the <code>gsis_id</code> column must be named <code>game_gsis_id</code> in
<code>row</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.from_row_dict', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.from_row_dict" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new entity object from a full SQL row result from</span>
<span class="sd">    the entity&#39;s tables. (i.e., `row` is a dictionary mapping</span>
<span class="sd">    column to value.) Note that the column names must be of the</span>
<span class="sd">    form &#39;{entity_name}_{column_name}&#39;. For example, in the `game`</span>
<span class="sd">    table, the `gsis_id` column must be named `game_gsis_id` in</span>
<span class="sd">    `row`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_primary_table</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span>
    <span class="n">slice_from</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">slice_from</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Play.from_row_tuple">
    <p>def <span class="ident">from_row_tuple</span>(</p><p>cls, db, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tuple <code>t</code> corresponding to a result from a SELECT query,
this will construct a new instance for this entity. Note that
the tuple <code>t</code> must be in <em>exact</em> correspondence with the columns
returned by <code>nfldb.Entity.sql_fields</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.from_row_tuple', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.from_row_tuple" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tuple `t` corresponding to a result from a SELECT query,</span>
<span class="sd">    this will construct a new instance for this entity. Note that</span>
<span class="sd">    the tuple `t` must be in *exact* correspondence with the columns</span>
<span class="sd">    returned by `nfldb.Entity.sql_fields`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Play.score">
    <p>def <span class="ident">score</span>(</p><p>self, before=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the score of the game immediately after this play as a
tuple of the form <code>(home_score, away_score)</code>.</p>
<p>If <code>before</code> is <code>True</code>, then the score will <em>not</em> include this
play.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.score', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.score" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the score of the game immediately after this play as a</span>
<span class="sd">    tuple of the form `(home_score, away_score)`.</span>
<span class="sd">    If `before` is `True`, then the score will *not* include this</span>
<span class="sd">    play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">Game</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">score_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="c"># The heuristic in `nfldb.Game.score_in_plays` blends TDs and XPs</span>
    <span class="c"># into a single play (with respect to scoring). So we have to undo</span>
    <span class="c"># that if we want the score of the game after a TD but before an XP.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kicking_xpmade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">score_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring_team</span>
        <span class="k">if</span> <span class="n">score_team</span> <span class="o">==</span> <span class="n">game</span><span class="o">.</span><span class="n">home_team</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Play.sql_fields">
    <p>def <span class="ident">sql_fields</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of all SQL fields across all tables for this
entity, including derived fields. This method can be used
in conjunction with <code>nfldb.Entity.from_row_tuple</code> to quickly
create new <code>nfldb</code> objects without every constructing a dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Play.sql_fields', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Play.sql_fields" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sql_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all SQL fields across all tables for this</span>
<span class="sd">    entity, including derived fields. This method can be used</span>
<span class="sd">    in conjunction with `nfldb.Entity.from_row_tuple` to quickly</span>
<span class="sd">    create new `nfldb` objects without every constructing a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_cached_sql_fields&#39;</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_columns</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">+=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.PlayPlayer" class="name">class <span class="ident">PlayPlayer</span></p>
      
  
    <div class="desc"><p>A "play player" is a statistical grouping of categories for a
single player inside a play. For example, passing the ball to
a receiver necessarily requires two "play players": the pass
(by player X) and the reception (by player Y). Statistics that
aren't included, for example, are blocks and penalties. (Although
penalty information can be gleaned from a play's free-form
<a href="#nfldb.Play.description"><code>description</code></a> attribute.)</p>
<p>Each <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> object belongs to exactly one
<a href="#nfldb.Play"><code>Play</code></a> and exactly one <a href="#nfldb.Player"><code>Player</code></a>.</p>
<p>Any statistical categories not relevant to this particular play
and player default to <code>0</code>.</p>
<p>Most of the statistical fields are documented on the
<a href="http://goo.gl/wZstcY">statistical categories</a>
wiki page. Each statistical field is an instance attribute in
this class.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">PlayPlayer</span> <span class="p">(</span><span class="n">SQLPlayPlayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;play player&quot; is a statistical grouping of categories for a</span>
<span class="sd">    single player inside a play. For example, passing the ball to</span>
<span class="sd">    a receiver necessarily requires two &quot;play players&quot;: the pass</span>
<span class="sd">    (by player X) and the reception (by player Y). Statistics that</span>
<span class="sd">    aren&#39;t included, for example, are blocks and penalties. (Although</span>
<span class="sd">    penalty information can be gleaned from a play&#39;s free-form</span>
<span class="sd">    `nfldb.Play.description` attribute.)</span>

<span class="sd">    Each `nfldb.PlayPlayer` object belongs to exactly one</span>
<span class="sd">    `nfldb.Play` and exactly one `nfldb.Player`.</span>

<span class="sd">    Any statistical categories not relevant to this particular play</span>
<span class="sd">    and player default to `0`.</span>

<span class="sd">    Most of the statistical fields are documented on the</span>
<span class="sd">    [statistical categories](http://goo.gl/wZstcY)</span>
<span class="sd">    wiki page. Each statistical field is an instance attribute in</span>
<span class="sd">    this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="n">SQLPlayPlayer</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span> \
        <span class="o">+</span> <span class="p">[</span><span class="s">&#39;_db&#39;</span><span class="p">,</span> <span class="s">&#39;_play&#39;</span><span class="p">,</span> <span class="s">&#39;_player&#39;</span><span class="p">,</span> <span class="s">&#39;_fields&#39;</span><span class="p">]</span>

    <span class="c"># Document instance variables for derived SQL fields.</span>
    <span class="c"># We hide them from the public interface, but make the doco</span>
    <span class="c"># available to nfldb-mk-stat-table. Evil!</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;PlayPlayer.offense_yds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_PlayPlayer.offense_yds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any yardage that is manufactured by the offense.</span>
<span class="sd">        Namely, the following fields:</span>
<span class="sd">        `nfldb.PlayPlayer.passing_yds`,</span>
<span class="sd">        `nfldb.PlayPlayer.rushing_yds`,</span>
<span class="sd">        `nfldb.PlayPlayer.receiving_yds` and</span>
<span class="sd">        `nfldb.PlayPlayer.fumbles_rec_yds`.</span>

<span class="sd">        This field is useful when searching for plays by net yardage</span>
<span class="sd">        regardless of how the yards were obtained.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;PlayPlayer.offense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_PlayPlayer.offense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any touchdown manufactured by the offense via</span>
<span class="sd">        a passing, reception, rush or fumble recovery.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;PlayPlayer.defense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;_PlayPlayer.defense_tds&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Corresponds to any touchdown manufactured by the defense.</span>
<span class="sd">        e.g., a pick-6, fumble recovery TD, punt/FG block TD, etc.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;PlayPlayer.points&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of points scored in this player statistic. This</span>
<span class="sd">        accounts for touchdowns, extra points, two point conversions,</span>
<span class="sd">        field goals and safeties.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given `p` as a `nfldb.Play` object and `pp` as a</span>
<span class="sd">        `nflgame.player.PlayPlayerStats` object, `_from_nflgame`</span>
<span class="sd">        converts `pp` to a `nfldb.PlayPlayer` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>

        <span class="n">dbpp</span> <span class="o">=</span> <span class="n">PlayPlayer</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">gsis_id</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">drive_id</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">play_id</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">playerid</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">team</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_player_categories</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">dbpp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">dbpp</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">dbpp</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">pp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dbpp</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_plays</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">play_players</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of `play_players`, fill all of their `play` attributes</span>
<span class="sd">        using as few queries as possible. This will also fill the</span>
<span class="sd">        plays with drive data and each drive with game data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Play</span><span class="p">,</span> <span class="n">play_players</span><span class="p">,</span> <span class="s">&#39;_play&#39;</span><span class="p">)</span>
        <span class="n">Play</span><span class="o">.</span><span class="n">fill_drives</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">_play</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">])</span>
        <span class="n">Drive</span><span class="o">.</span><span class="n">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">_play</span><span class="o">.</span><span class="n">_drive</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_players</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">play_players</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of `play_players`, fill all of their `player`</span>
<span class="sd">        attributes using as few queries as possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">play_players</span><span class="p">,</span> <span class="s">&#39;_player&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new and empty `nfldb.PlayPlayer` object with the</span>
<span class="sd">        given database connection.</span>

<span class="sd">        This constructor should not be used by clients. Instead,</span>
<span class="sd">        you should get `nfldb.PlayPlayer` objects</span>
<span class="sd">        from `nfldb.Query` or from one of the other</span>
<span class="sd">        constructors, like `nfldb.PlayPlayer.from_id` or</span>
<span class="sd">        `nfldb.PlayPlayer.from_row_dict`. (The latter is useful only if</span>
<span class="sd">        you&#39;re writing your own SQL queries.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The GSIS identifier for the game that this &quot;play player&quot;</span>
<span class="sd">        belongs to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numeric drive identifier for this &quot;play player&quot;. It may be</span>
<span class="sd">        interpreted as a sequence number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The numeric play identifier for this &quot;play player&quot;. It can</span>
<span class="sd">        typically be interpreted as a sequence number scoped to its</span>
<span class="sd">        corresponding game.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The player_id linking these stats to a `nfldb.Player` object.</span>
<span class="sd">        Use `nfldb.PlayPlayer.player` to access player meta data.</span>

<span class="sd">        N.B. This is the GSIS identifier string. It always has length</span>
<span class="sd">        10.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team that this player belonged to when he recorded the</span>
<span class="sd">        statistics in this play.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The set of non-zero statistical fields set.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_player_categories</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `nfldb.Play` object that this &quot;play player&quot; belongs</span>
<span class="sd">        to. The play is retrieved from the database if necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="n">Play</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">player</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `nfldb.Player` object that this &quot;play player&quot;</span>
<span class="sd">        corresponds to. The player is retrieved from the database if</span>
<span class="sd">        necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_player</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_player</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scoring_team</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If this is a scoring statistic, returns the team that scored.</span>
<span class="sd">        Otherwise, returns None.</span>

<span class="sd">        N.B. `nfldb.PlayPlayer.scoring_team` returns a valid team if</span>
<span class="sd">        and only if `nfldb.PlayPlayer.points` is greater than 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guess_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Guesses the position of this player based on the statistical</span>
<span class="sd">        categories present.</span>

<span class="sd">        Note that this only distinguishes the offensive positions of</span>
<span class="sd">        QB, RB, WR, P and K. If defensive stats are detected, then</span>
<span class="sd">        the position returned defaults to LB.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stat_to_pos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;passing_att&#39;</span><span class="p">,</span> <span class="s">&#39;QB&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;rushing_att&#39;</span><span class="p">,</span> <span class="s">&#39;RB&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;receiving_tar&#39;</span><span class="p">,</span> <span class="s">&#39;WR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;punting_tot&#39;</span><span class="p">,</span> <span class="s">&#39;P&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;kicking_tot&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;kicking_fga&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;kicking_xpa&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">stat_categories</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;defense_&#39;</span><span class="p">):</span>
                <span class="n">stat_to_pos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;LB&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">stat_to_pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="o">.</span><span class="n">UNK</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_player</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_player</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlayPlayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given two `nfldb.PlayPlayer` objects, `_add` accumulates `b`</span>
<span class="sd">        into `self`. Namely, no new `nfldb.PlayPlayer` objects are</span>
<span class="sd">        created.</span>

<span class="sd">        Both `self` and `b` must refer to the same player, or else an</span>
<span class="sd">        assertion error is raised.</span>

<span class="sd">        The `nfldb.aggregate` function should be used to sum collections</span>
<span class="sd">        of `nfldb.PlayPlayer` objects (or objects that can provide</span>
<span class="sd">        `nfldb.PlayPlayer` objects).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">player_id</span>
        <span class="n">a</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">gsis_id</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">gsis_id</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">a</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">drive_id</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">drive_id</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">a</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">play_id</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">play_id</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">play_id</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">a</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">team</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">team</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">_player_categories</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cat</span><span class="p">))</span>

        <span class="c"># Try to copy player meta data too.</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">_player</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">_player</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">_player</span>

        <span class="c"># A play attached to aggregate statistics is always wrong.</span>
        <span class="n">a</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a copy of `self`.&quot;&quot;&quot;</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">PlayPlayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span>

        <span class="n">ga</span><span class="p">,</span> <span class="n">sa</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">,</span> <span class="nb">setattr</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_player_categories</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sa</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_player</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_play</span>
        <span class="k">return</span> <span class="n">pp</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pp</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">_player_categories</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">PlayPlayer</span><span class="o">.</span><span class="n">__slots__</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.PlayPlayer">PlayPlayer</a></li>
          <li>nfldb.types.SQLPlayPlayer</li>
          <li>nfldb.sql.Entity</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.fill_players">
    <p>def <span class="ident">fill_players</span>(</p><p>db, play_players)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <code>play_players</code>, fill all of their <code>player</code>
attributes using as few queries as possible.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.fill_players', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.fill_players" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fill_players</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">play_players</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of `play_players`, fill all of their `player`</span>
<span class="sd">    attributes using as few queries as possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">play_players</span><span class="p">,</span> <span class="s">&#39;_player&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.fill_plays">
    <p>def <span class="ident">fill_plays</span>(</p><p>db, play_players)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of <code>play_players</code>, fill all of their <code>play</code> attributes
using as few queries as possible. This will also fill the
plays with drive data and each drive with game data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.fill_plays', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.fill_plays" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fill_plays</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">play_players</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of `play_players`, fill all of their `play` attributes</span>
<span class="sd">    using as few queries as possible. This will also fill the</span>
<span class="sd">    plays with drive data and each drive with game data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fill</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">Play</span><span class="p">,</span> <span class="n">play_players</span><span class="p">,</span> <span class="s">&#39;_play&#39;</span><span class="p">)</span>
    <span class="n">Play</span><span class="o">.</span><span class="n">fill_drives</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">_play</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">])</span>
    <span class="n">Drive</span><span class="o">.</span><span class="n">fill_games</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">_play</span><span class="o">.</span><span class="n">_drive</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.PlayPlayer.drive_id" class="name">var <span class="ident">drive_id</span></p>
            

            
  
    <div class="desc"><p>The numeric drive identifier for this "play player". It may be
interpreted as a sequence number.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.fields" class="name">var <span class="ident">fields</span></p>
            

            
  
    <div class="desc"><p>The set of non-zero statistical fields set.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.gsis_id" class="name">var <span class="ident">gsis_id</span></p>
            

            
  
    <div class="desc"><p>The GSIS identifier for the game that this "play player"
belongs to.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.guess_position" class="name">var <span class="ident">guess_position</span></p>
            

            
  
    <div class="desc"><p>Guesses the position of this player based on the statistical
categories present.</p>
<p>Note that this only distinguishes the offensive positions of
QB, RB, WR, P and K. If defensive stats are detected, then
the position returned defaults to LB.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.play" class="name">var <span class="ident">play</span></p>
            

            
  
    <div class="desc"><p>The <a href="#nfldb.Play"><code>Play</code></a> object that this "play player" belongs
to. The play is retrieved from the database if necessary.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.play_id" class="name">var <span class="ident">play_id</span></p>
            

            
  
    <div class="desc"><p>The numeric play identifier for this "play player". It can
typically be interpreted as a sequence number scoped to its
corresponding game.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.player" class="name">var <span class="ident">player</span></p>
            

            
  
    <div class="desc"><p>The <a href="#nfldb.Player"><code>Player</code></a> object that this "play player"
corresponds to. The player is retrieved from the database if
necessary.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.player_id" class="name">var <span class="ident">player_id</span></p>
            

            
  
    <div class="desc"><p>The player_id linking these stats to a <a href="#nfldb.Player"><code>Player</code></a> object.
Use <a href="#nfldb.PlayPlayer.player"><code>player</code></a> to access player meta data.</p>
<p>N.B. This is the GSIS identifier string. It always has length
10.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.points" class="name">var <span class="ident">points</span></p>
            

            
  
    <div class="desc"><p>The number of points scored in this player statistic. This
accounts for touchdowns, extra points, two point conversions,
field goals and safeties.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.scoring_team" class="name">var <span class="ident">scoring_team</span></p>
            

            
  
    <div class="desc"><p>If this is a scoring statistic, returns the team that scored.
Otherwise, returns None.</p>
<p>N.B. <a href="#nfldb.PlayPlayer.scoring_team"><code>scoring_team</code></a> returns a valid team if
and only if <a href="#nfldb.PlayPlayer.points"><code>points</code></a> is greater than 0.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PlayPlayer.team" class="name">var <span class="ident">team</span></p>
            

            
  
    <div class="desc"><p>The team that this player belonged to when he recorded the
statistics in this play.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new and empty <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> object with the
given database connection.</p>
<p>This constructor should not be used by clients. Instead,
you should get <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> objects
from <a href="#nfldb.Query"><code>Query</code></a> or from one of the other
constructors, like <code>nfldb.PlayPlayer.from_id</code> or
<a href="#nfldb.PlayPlayer.from_row_dict"><code>from_row_dict</code></a>. (The latter is useful only if
you're writing your own SQL queries.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new and empty `nfldb.PlayPlayer` object with the</span>
<span class="sd">    given database connection.</span>
<span class="sd">    This constructor should not be used by clients. Instead,</span>
<span class="sd">    you should get `nfldb.PlayPlayer` objects</span>
<span class="sd">    from `nfldb.Query` or from one of the other</span>
<span class="sd">    constructors, like `nfldb.PlayPlayer.from_id` or</span>
<span class="sd">    `nfldb.PlayPlayer.from_row_dict`. (The latter is useful only if</span>
<span class="sd">    you&#39;re writing your own SQL queries.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_play</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_player</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GSIS identifier for the game that this &quot;play player&quot;</span>
<span class="sd">    belongs to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drive_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The numeric drive identifier for this &quot;play player&quot;. It may be</span>
<span class="sd">    interpreted as a sequence number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">play_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The numeric play identifier for this &quot;play player&quot;. It can</span>
<span class="sd">    typically be interpreted as a sequence number scoped to its</span>
<span class="sd">    corresponding game.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The player_id linking these stats to a `nfldb.Player` object.</span>
<span class="sd">    Use `nfldb.PlayPlayer.player` to access player meta data.</span>
<span class="sd">    N.B. This is the GSIS identifier string. It always has length</span>
<span class="sd">    10.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team that this player belonged to when he recorded the</span>
<span class="sd">    statistics in this play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.from_row_dict">
    <p>def <span class="ident">from_row_dict</span>(</p><p>cls, db, row)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new entity object from a full SQL row result from
the entity's tables. (i.e., <code>row</code> is a dictionary mapping
column to value.) Note that the column names must be of the
form '{entity_name}_{column_name}'. For example, in the <code>game</code>
table, the <code>gsis_id</code> column must be named <code>game_gsis_id</code> in
<code>row</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.from_row_dict', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.from_row_dict" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new entity object from a full SQL row result from</span>
<span class="sd">    the entity&#39;s tables. (i.e., `row` is a dictionary mapping</span>
<span class="sd">    column to value.) Note that the column names must be of the</span>
<span class="sd">    form &#39;{entity_name}_{column_name}&#39;. For example, in the `game`</span>
<span class="sd">    table, the `gsis_id` column must be named `game_gsis_id` in</span>
<span class="sd">    `row`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_primary_table</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span>
    <span class="n">slice_from</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">slice_from</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.from_row_tuple">
    <p>def <span class="ident">from_row_tuple</span>(</p><p>cls, db, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tuple <code>t</code> corresponding to a result from a SELECT query,
this will construct a new instance for this entity. Note that
the tuple <code>t</code> must be in <em>exact</em> correspondence with the columns
returned by <code>nfldb.Entity.sql_fields</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.from_row_tuple', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.from_row_tuple" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tuple `t` corresponding to a result from a SELECT query,</span>
<span class="sd">    this will construct a new instance for this entity. Note that</span>
<span class="sd">    the tuple `t` must be in *exact* correspondence with the columns</span>
<span class="sd">    returned by `nfldb.Entity.sql_fields`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.PlayPlayer.sql_fields">
    <p>def <span class="ident">sql_fields</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of all SQL fields across all tables for this
entity, including derived fields. This method can be used
in conjunction with <code>nfldb.Entity.from_row_tuple</code> to quickly
create new <code>nfldb</code> objects without every constructing a dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PlayPlayer.sql_fields', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PlayPlayer.sql_fields" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sql_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all SQL fields across all tables for this</span>
<span class="sd">    entity, including derived fields. This method can be used</span>
<span class="sd">    in conjunction with `nfldb.Entity.from_row_tuple` to quickly</span>
<span class="sd">    create new `nfldb` objects without every constructing a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_cached_sql_fields&#39;</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_columns</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">+=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Player" class="name">class <span class="ident">Player</span></p>
      
  
    <div class="desc"><p>A representation of an NFL player. Note that the representation
is inherently ephemeral; it always corresponds to the most recent
knowledge about a player.</p>
<p>Most of the fields in this object can have a <code>None</code> value. This is
because the source JSON data only guarantees that a GSIS identifier
and abbreviated name will be available. The rest of the player meta
data is scraped from NFL.com's team roster pages (which invites
infrequent uncertainty).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Player</span> <span class="p">(</span><span class="n">SQLPlayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A representation of an NFL player. Note that the representation</span>
<span class="sd">    is inherently ephemeral; it always corresponds to the most recent</span>
<span class="sd">    knowledge about a player.</span>

<span class="sd">    Most of the fields in this object can have a `None` value. This is</span>
<span class="sd">    because the source JSON data only guarantees that a GSIS identifier</span>
<span class="sd">    and abbreviated name will be available. The rest of the player meta</span>
<span class="sd">    data is scraped from NFL.com&#39;s team roster pages (which invites</span>
<span class="sd">    infrequent uncertainty).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="n">SQLPlayer</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;_db&#39;</span><span class="p">]</span>

    <span class="n">_existing</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A cache of existing player ids in the database.</span>
<span class="sd">    This is only used when saving data to detect if a player</span>
<span class="sd">    needs to be added.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given `p` as a `nflgame.player.PlayPlayerStats` object,</span>
<span class="sd">        `_from_nflgame` converts `p` to a `nfldb.Player` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbp</span> <span class="o">=</span> <span class="n">Player</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">dbp</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">playerid</span>
        <span class="n">dbp</span><span class="o">.</span><span class="n">gsis_name</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">player</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;full_name&#39;</span><span class="p">,</span> <span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="s">&#39;team&#39;</span><span class="p">,</span> <span class="s">&#39;position&#39;</span><span class="p">,</span>
                    <span class="s">&#39;profile_id&#39;</span><span class="p">,</span> <span class="s">&#39;profile_url&#39;</span><span class="p">,</span> <span class="s">&#39;uniform_number&#39;</span><span class="p">,</span> <span class="s">&#39;birthdate&#39;</span><span class="p">,</span>
                    <span class="s">&#39;college&#39;</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="s">&#39;weight&#39;</span><span class="p">,</span> <span class="s">&#39;years_pro&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                    <span class="c"># Normalize all empty values to `None`</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">dbp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

            <span class="c"># Convert position and status values to an enumeration.</span>
            <span class="n">dbp</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="p">,</span>
                                   <span class="n">dbp</span><span class="o">.</span><span class="n">position</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                                   <span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="o">.</span><span class="n">UNK</span><span class="p">)</span>

            <span class="n">trans</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">_nflgame_player_status</span>
            <span class="n">dbp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dbp</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                                   <span class="n">Enums</span><span class="o">.</span><span class="n">player_status</span><span class="o">.</span><span class="n">Unknown</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dbp</span><span class="p">,</span> <span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dbp</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">player_pos</span><span class="o">.</span><span class="n">UNK</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dbp</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dbp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="n">player_status</span><span class="o">.</span><span class="n">Unknown</span>

        <span class="n">dbp</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">dbp</span><span class="p">,</span> <span class="s">&#39;team&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dbp</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_from_nflgame_player</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given `p` as a `nflgame.player.Player` object,</span>
<span class="sd">        `_from_nflgame_player` converts `p` to a `nfldb.Player` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This hack translates `nflgame.player.Player` to something like</span>
        <span class="c"># a `nflgame.player.PlayPlayerStats` object that can be converted</span>
        <span class="c"># with `nfldb.Player._from_nflgame`.</span>
        <span class="k">class</span> <span class="nc">_Player</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playerid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">player_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">gsis_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">return</span> <span class="n">Player</span><span class="o">.</span><span class="n">_from_nflgame</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">_Player</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">player_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a player GSIS identifier (e.g., `00-0019596`) as a string,</span>
<span class="sd">        returns a `nfldb.Player` object corresponding to `player_id`.</span>
<span class="sd">        This function will always execute a single SQL query.</span>

<span class="sd">        If no corresponding player is found, `None` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">nfldb.query</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">players</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">player</span><span class="p">(</span><span class="n">player_id</span><span class="o">=</span><span class="n">player_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">as_players</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">players</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new and empty `nfldb.Player` object with the given</span>
<span class="sd">        database connection.</span>

<span class="sd">        This constructor should not be used by clients. Instead, you</span>
<span class="sd">        should get `nfldb.Player` objects from `nfldb.Query` or from</span>
<span class="sd">        one of the other constructors, like `nfldb.Player.from_id` or</span>
<span class="sd">        `nfldb.Player.from_row_dict`. (The latter is useful only if</span>
<span class="sd">        you&#39;re writing your own SQL queries.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The player_id linking this object `nfldb.PlayPlayer` object.</span>

<span class="sd">        N.B. This is the GSIS identifier string. It always has length</span>
<span class="sd">        10.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gsis_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of a player from the source GameCenter data. This</span>
<span class="sd">        field is guaranteed to contain a name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The full name of a player.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The first name of a player.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The last name of a player.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The team that the player is currently active on. If the player</span>
<span class="sd">        is no longer playing or is a free agent, this value may</span>
<span class="sd">        correspond to the `UNK` (unknown) team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current position of a player if it&#39;s available. This may</span>
<span class="sd">        be **not** be `None`. If the position is not known, then the</span>
<span class="sd">        `UNK` enum is used from `nfldb.Enums.player_pos`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The profile identifier used on a player&#39;s canonical NFL.com</span>
<span class="sd">        profile page. This is used as a foreign key to connect varying</span>
<span class="sd">        sources of information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_url</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The NFL.com profile URL for this player.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_number</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A player&#39;s uniform number as an integer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A player&#39;s birth date as a free-form string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">college</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A player&#39;s college as a free-form string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A player&#39;s height as a free-form string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A player&#39;s weight as a free-form string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">years_pro</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The number of years a player has played as an integer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The current status of this player as a free-form string.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Player</span><span class="o">.</span><span class="n">_existing</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Player</span><span class="o">.</span><span class="n">_existing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT player_id FROM player&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">Player</span><span class="o">.</span><span class="n">_existing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;player_id&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Player</span><span class="o">.</span><span class="n">_existing</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
            <span class="n">Player</span><span class="o">.</span><span class="n">_existing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span>  <span class="c"># Yikes.</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">full_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">full_name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsis_name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">gsis_name</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">player_id</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Player">Player</a></li>
          <li>nfldb.types.SQLPlayer</li>
          <li>nfldb.sql.Entity</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Player.from_id">
    <p>def <span class="ident">from_id</span>(</p><p>db, player_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a player GSIS identifier (e.g., <code>00-0019596</code>) as a string,
returns a <a href="#nfldb.Player"><code>Player</code></a> object corresponding to <code>player_id</code>.
This function will always execute a single SQL query.</p>
<p>If no corresponding player is found, <code>None</code> is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player.from_id', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player.from_id" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">player_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a player GSIS identifier (e.g., `00-0019596`) as a string,</span>
<span class="sd">    returns a `nfldb.Player` object corresponding to `player_id`.</span>
<span class="sd">    This function will always execute a single SQL query.</span>
<span class="sd">    If no corresponding player is found, `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">nfldb.query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">player</span><span class="p">(</span><span class="n">player_id</span><span class="o">=</span><span class="n">player_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">as_players</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">players</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Player.birthdate" class="name">var <span class="ident">birthdate</span></p>
            

            
  
    <div class="desc"><p>A player's birth date as a free-form string.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.college" class="name">var <span class="ident">college</span></p>
            

            
  
    <div class="desc"><p>A player's college as a free-form string.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.first_name" class="name">var <span class="ident">first_name</span></p>
            

            
  
    <div class="desc"><p>The first name of a player.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.full_name" class="name">var <span class="ident">full_name</span></p>
            

            
  
    <div class="desc"><p>The full name of a player.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.gsis_name" class="name">var <span class="ident">gsis_name</span></p>
            

            
  
    <div class="desc"><p>The name of a player from the source GameCenter data. This
field is guaranteed to contain a name.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.height" class="name">var <span class="ident">height</span></p>
            

            
  
    <div class="desc"><p>A player's height as a free-form string.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.last_name" class="name">var <span class="ident">last_name</span></p>
            

            
  
    <div class="desc"><p>The last name of a player.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.player_id" class="name">var <span class="ident">player_id</span></p>
            

            
  
    <div class="desc"><p>The player_id linking this object <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> object.</p>
<p>N.B. This is the GSIS identifier string. It always has length
10.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.position" class="name">var <span class="ident">position</span></p>
            

            
  
    <div class="desc"><p>The current position of a player if it's available. This may
be <strong>not</strong> be <code>None</code>. If the position is not known, then the
<code>UNK</code> enum is used from <a href="#nfldb.Enums.player_pos"><code>player_pos</code></a>.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.profile_id" class="name">var <span class="ident">profile_id</span></p>
            

            
  
    <div class="desc"><p>The profile identifier used on a player's canonical NFL.com
profile page. This is used as a foreign key to connect varying
sources of information.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.profile_url" class="name">var <span class="ident">profile_url</span></p>
            

            
  
    <div class="desc"><p>The NFL.com profile URL for this player.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.status" class="name">var <span class="ident">status</span></p>
            

            
  
    <div class="desc"><p>The current status of this player as a free-form string.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.team" class="name">var <span class="ident">team</span></p>
            

            
  
    <div class="desc"><p>The team that the player is currently active on. If the player
is no longer playing or is a free agent, this value may
correspond to the <code>UNK</code> (unknown) team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.uniform_number" class="name">var <span class="ident">uniform_number</span></p>
            

            
  
    <div class="desc"><p>A player's uniform number as an integer.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.weight" class="name">var <span class="ident">weight</span></p>
            

            
  
    <div class="desc"><p>A player's weight as a free-form string.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Player.years_pro" class="name">var <span class="ident">years_pro</span></p>
            

            
  
    <div class="desc"><p>The number of years a player has played as an integer.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Player.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new and empty <a href="#nfldb.Player"><code>Player</code></a> object with the given
database connection.</p>
<p>This constructor should not be used by clients. Instead, you
should get <a href="#nfldb.Player"><code>Player</code></a> objects from <a href="#nfldb.Query"><code>Query</code></a> or from
one of the other constructors, like <a href="#nfldb.Player.from_id"><code>from_id</code></a> or
<a href="#nfldb.Player.from_row_dict"><code>from_row_dict</code></a>. (The latter is useful only if
you're writing your own SQL queries.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new and empty `nfldb.Player` object with the given</span>
<span class="sd">    database connection.</span>
<span class="sd">    This constructor should not be used by clients. Instead, you</span>
<span class="sd">    should get `nfldb.Player` objects from `nfldb.Query` or from</span>
<span class="sd">    one of the other constructors, like `nfldb.Player.from_id` or</span>
<span class="sd">    `nfldb.Player.from_row_dict`. (The latter is useful only if</span>
<span class="sd">    you&#39;re writing your own SQL queries.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The player_id linking this object `nfldb.PlayPlayer` object.</span>
<span class="sd">    N.B. This is the GSIS identifier string. It always has length</span>
<span class="sd">    10.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gsis_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The name of a player from the source GameCenter data. This</span>
<span class="sd">    field is guaranteed to contain a name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The full name of a player.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The first name of a player.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The last name of a player.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The team that the player is currently active on. If the player</span>
<span class="sd">    is no longer playing or is a free agent, this value may</span>
<span class="sd">    correspond to the `UNK` (unknown) team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The current position of a player if it&#39;s available. This may</span>
<span class="sd">    be **not** be `None`. If the position is not known, then the</span>
<span class="sd">    `UNK` enum is used from `nfldb.Enums.player_pos`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The profile identifier used on a player&#39;s canonical NFL.com</span>
<span class="sd">    profile page. This is used as a foreign key to connect varying</span>
<span class="sd">    sources of information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile_url</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The NFL.com profile URL for this player.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uniform_number</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A player&#39;s uniform number as an integer.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A player&#39;s birth date as a free-form string.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">college</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A player&#39;s college as a free-form string.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A player&#39;s height as a free-form string.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A player&#39;s weight as a free-form string.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">years_pro</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The number of years a player has played as an integer.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The current status of this player as a free-form string.&quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Player.from_row_dict">
    <p>def <span class="ident">from_row_dict</span>(</p><p>cls, db, row)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new entity object from a full SQL row result from
the entity's tables. (i.e., <code>row</code> is a dictionary mapping
column to value.) Note that the column names must be of the
form '{entity_name}_{column_name}'. For example, in the <code>game</code>
table, the <code>gsis_id</code> column must be named <code>game_gsis_id</code> in
<code>row</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player.from_row_dict', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player.from_row_dict" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new entity object from a full SQL row result from</span>
<span class="sd">    the entity&#39;s tables. (i.e., `row` is a dictionary mapping</span>
<span class="sd">    column to value.) Note that the column names must be of the</span>
<span class="sd">    form &#39;{entity_name}_{column_name}&#39;. For example, in the `game`</span>
<span class="sd">    table, the `gsis_id` column must be named `game_gsis_id` in</span>
<span class="sd">    `row`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_primary_table</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span>
    <span class="n">slice_from</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">slice_from</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Player.from_row_tuple">
    <p>def <span class="ident">from_row_tuple</span>(</p><p>cls, db, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tuple <code>t</code> corresponding to a result from a SELECT query,
this will construct a new instance for this entity. Note that
the tuple <code>t</code> must be in <em>exact</em> correspondence with the columns
returned by <code>nfldb.Entity.sql_fields</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player.from_row_tuple', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player.from_row_tuple" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_row_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tuple `t` corresponding to a result from a SELECT query,</span>
<span class="sd">    this will construct a new instance for this entity. Note that</span>
<span class="sd">    the tuple `t` must be in *exact* correspondence with the columns</span>
<span class="sd">    returned by `nfldb.Entity.sql_fields`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">()</span>
    <span class="n">seta</span> <span class="o">=</span> <span class="nb">setattr</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">seta</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Player.sql_fields">
    <p>def <span class="ident">sql_fields</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of all SQL fields across all tables for this
entity, including derived fields. This method can be used
in conjunction with <code>nfldb.Entity.from_row_tuple</code> to quickly
create new <code>nfldb</code> objects without every constructing a dict.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Player.sql_fields', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Player.sql_fields" class="source">
    <div class="codehilite"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sql_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all SQL fields across all tables for this</span>
<span class="sd">    entity, including derived fields. This method can be used</span>
<span class="sd">    in conjunction with `nfldb.Entity.from_row_tuple` to quickly</span>
<span class="sd">    create new `nfldb` objects without every constructing a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_cached_sql_fields&#39;</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_columns</span><span class="p">()</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span> <span class="o">+=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_cached_sql_fields</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.PossessionTime" class="name">class <span class="ident">PossessionTime</span></p>
      
  
    <div class="desc"><p>Represents the possession time of a drive in seconds.</p>
<p>This class defines a total ordering on possession times. Namely, p1
&lt; p2 if and only if p2 corresponds to a longer time of possession
than p1.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PossessionTime', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PossessionTime" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">PossessionTime</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the possession time of a drive in seconds.</span>

<span class="sd">    This class defines a total ordering on possession times. Namely, p1</span>
<span class="sd">    &lt; p2 if and only if p2 corresponds to a longer time of possession</span>
<span class="sd">    than p1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;_seconds&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">clock_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduces a `nfldb.PossessionTime` object from a string</span>
<span class="sd">        formatted as clock time. For example, `2:00` corresponds to</span>
<span class="sd">        `120` seconds and `14:39` corresponds to `879` seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">clock_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">PossessionTime</span><span class="p">((</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pg_cast</span><span class="p">(</span><span class="n">sqlv</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sqlv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a `nfldb.PossessionTime` object given the number of</span>
<span class="sd">        seconds of the possession.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="n">seconds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if and only if this possession time has a valid</span>
<span class="sd">        representation.</span>

<span class="sd">        Invalid possession times cannot be compared with other</span>
<span class="sd">        possession times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The total seconds elapsed for this possession.</span>
<span class="sd">        `0` is returned if this is not a valid possession time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of whole minutes for a possession.</span>
<span class="sd">        e.g., `0:59` would be `0` minutes and `4:01` would be `4`</span>
<span class="sd">        minutes.</span>
<span class="sd">        `0` is returned if this is not a valid possession time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The seconds portion of the possession time.</span>
<span class="sd">        e.g., `0:59` would be `59` seconds and `4:01` would be `1`</span>
<span class="sd">        second.</span>
<span class="sd">        `0` is returned if this is not a valid possession time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;N/A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_seconds</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_seconds</span>

    <span class="k">def</span> <span class="nf">__conform__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="ow">is</span> <span class="n">ISQLQuote</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;NULL&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;ROW(</span><span class="si">%d</span><span class="s">)::pos_period&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.PossessionTime">PossessionTime</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.PossessionTime.from_str">
    <p>def <span class="ident">from_str</span>(</p><p>clock_str)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a <a href="#nfldb.PossessionTime"><code>PossessionTime</code></a> object from a string
formatted as clock time. For example, <code>2:00</code> corresponds to
<code>120</code> seconds and <code>14:39</code> corresponds to <code>879</code> seconds.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PossessionTime.from_str', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PossessionTime.from_str" class="source">
    <div class="codehilite"><pre><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">clock_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a `nfldb.PossessionTime` object from a string</span>
<span class="sd">    formatted as clock time. For example, `2:00` corresponds to</span>
<span class="sd">    `120` seconds and `14:39` corresponds to `879` seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">clock_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">PossessionTime</span><span class="p">((</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.PossessionTime.minutes" class="name">var <span class="ident">minutes</span></p>
            

            
  
    <div class="desc"><p>The number of whole minutes for a possession.
e.g., <code>0:59</code> would be <code>0</code> minutes and <code>4:01</code> would be <code>4</code>
minutes.
<code>0</code> is returned if this is not a valid possession time.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PossessionTime.seconds" class="name">var <span class="ident">seconds</span></p>
            

            
  
    <div class="desc"><p>The seconds portion of the possession time.
e.g., <code>0:59</code> would be <code>59</code> seconds and <code>4:01</code> would be <code>1</code>
second.
<code>0</code> is returned if this is not a valid possession time.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PossessionTime.total_seconds" class="name">var <span class="ident">total_seconds</span></p>
            

            
  
    <div class="desc"><p>The total seconds elapsed for this possession.
<code>0</code> is returned if this is not a valid possession time.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.PossessionTime.valid" class="name">var <span class="ident">valid</span></p>
            

            
  
    <div class="desc"><p>Returns <code>True</code> if and only if this possession time has a valid
representation.</p>
<p>Invalid possession times cannot be compared with other
possession times.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.PossessionTime.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, seconds)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a <a href="#nfldb.PossessionTime"><code>PossessionTime</code></a> object given the number of
seconds of the possession.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.PossessionTime.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.PossessionTime.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a `nfldb.PossessionTime` object given the number of</span>
<span class="sd">    seconds of the possession.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="n">seconds</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Query" class="name">class <span class="ident">Query</span></p>
      
  
    <div class="desc"><p>A query represents a set of criteria to search nfldb's PostgreSQL
database. Its primary feature is to provide a high-level API for
searching NFL game, drive, play and player data very quickly.</p>
<p>The basic workflow is to specify all of the search criteria that
you want, and then use one of the <code>as_*</code> methods to actually
perform the search and return results from the database.</p>
<p>For example, to get all Patriots games as <a href="#nfldb.Game"><code>Game</code></a> objects from
the 2012 regular season, we could do:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">,</span> <span class="n">team</span><span class="o">=</span><span class="s">&#39;NE&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_games</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">game</span>
</pre></div>


<p>Other comparison operators like <code>&lt;</code> or <code>&gt;=</code> can also be used. To use
them, append a suffix like <code>__lt</code> to the end of a field name. So to get
all games with a home score greater than or equal to 50:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">home_score__ge</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_games</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">game</span>
</pre></div>


<p>Other suffixes are available: <code>__lt</code> for <code>&lt;</code>, <code>__le</code> for <code>&lt;=</code>,
<code>__gt</code> for <code>&gt;</code>, <code>__ge</code> for <code>&gt;=</code>, <code>__ne</code> for <code>!=</code> and <code>__eq</code> for
<code>==</code>. Although, the <code>__eq</code> suffix is used by default and is
therefore never necessary to use.</p>
<p>More criteria can be specified by chaining search criteria. For
example, to get only plays as <a href="#nfldb.Play"><code>Play</code></a> objects where Tom Brady
threw a touchdown pass:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">player</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="s">&quot;Tom Brady&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">passing_tds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">play</span>
</pre></div>


<p>By default, all critera specified are combined conjunctively (i.e.,
all criteria must be met for each result returned). However,
sometimes you may want to specify disjunctive criteria (i.e., any
of the criteria can be met for a result to be returned). To do this
for a single field, simply use a list. For example, to get all
Patriot games from the 2009 to 2013 seasons:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">,</span> <span class="n">team</span><span class="o">=</span><span class="s">&#39;NE&#39;</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="p">[</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2011</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2013</span><span class="p">])</span>
<span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_games</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">game</span>
</pre></div>


<p>Disjunctions can also be applied to multiple fields by creating a
<a href="#nfldb.Query"><code>Query</code></a> object with <a href="#nfldb.QueryOR"><code>QueryOR</code></a>. For example, to find
all games where either team had more than 50 points:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">QueryOR</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">home_score__ge</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">away_score__ge</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_games</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">game</span>
</pre></div>


<p>Finally, multiple queries can be combined with <a href="#nfldb.Query.andalso"><code>andalso</code></a>.
For example, to restrict the last search to games in the 2012 regular
season:</p>
<div class="codehilite"><pre><span class="n">big_score</span> <span class="o">=</span> <span class="n">QueryOR</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">home_score__ge</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">away_score__ge</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">andalso</span><span class="p">(</span><span class="n">big_score</span><span class="p">)</span>
<span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_games</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">game</span>
</pre></div>


<p>This is only the beginning of what can be done. More examples that run
the gamut can be found on
<a href="https://github.com/BurntSushi/nfldb/wiki">nfldb's wiki</a>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Query</span> <span class="p">(</span><span class="n">Condition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A query represents a set of criteria to search nfldb&#39;s PostgreSQL</span>
<span class="sd">    database. Its primary feature is to provide a high-level API for</span>
<span class="sd">    searching NFL game, drive, play and player data very quickly.</span>

<span class="sd">    The basic workflow is to specify all of the search criteria that</span>
<span class="sd">    you want, and then use one of the `as_*` methods to actually</span>
<span class="sd">    perform the search and return results from the database.</span>

<span class="sd">    For example, to get all Patriots games as `nfldb.Game` objects from</span>
<span class="sd">    the 2012 regular season, we could do:</span>

<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;, team=&#39;NE&#39;)</span>
<span class="sd">        for game in q.as_games():</span>
<span class="sd">            print game</span>

<span class="sd">    Other comparison operators like `&lt;` or `&gt;=` can also be used. To use</span>
<span class="sd">    them, append a suffix like `__lt` to the end of a field name. So to get</span>
<span class="sd">    all games with a home score greater than or equal to 50:</span>

<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(home_score__ge=50)</span>
<span class="sd">        for game in q.as_games():</span>
<span class="sd">            print game</span>

<span class="sd">    Other suffixes are available: `__lt` for `&lt;`, `__le` for `&lt;=`,</span>
<span class="sd">    `__gt` for `&gt;`, `__ge` for `&gt;=`, `__ne` for `!=` and `__eq` for</span>
<span class="sd">    `==`. Although, the `__eq` suffix is used by default and is</span>
<span class="sd">    therefore never necessary to use.</span>

<span class="sd">    More criteria can be specified by chaining search criteria. For</span>
<span class="sd">    example, to get only plays as `nfldb.Play` objects where Tom Brady</span>
<span class="sd">    threw a touchdown pass:</span>

<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">        q.player(full_name=&quot;Tom Brady&quot;).play(passing_tds=1)</span>
<span class="sd">        for play in q.as_plays():</span>
<span class="sd">            print play</span>

<span class="sd">    By default, all critera specified are combined conjunctively (i.e.,</span>
<span class="sd">    all criteria must be met for each result returned). However,</span>
<span class="sd">    sometimes you may want to specify disjunctive criteria (i.e., any</span>
<span class="sd">    of the criteria can be met for a result to be returned). To do this</span>
<span class="sd">    for a single field, simply use a list. For example, to get all</span>
<span class="sd">    Patriot games from the 2009 to 2013 seasons:</span>

<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_type=&#39;Regular&#39;, team=&#39;NE&#39;)</span>
<span class="sd">        q.game(season_year=[2009, 2010, 2011, 2012, 2013])</span>
<span class="sd">        for game in q.as_games():</span>
<span class="sd">            print game</span>

<span class="sd">    Disjunctions can also be applied to multiple fields by creating a</span>
<span class="sd">    `nfldb.Query` object with `nfldb.QueryOR`. For example, to find</span>
<span class="sd">    all games where either team had more than 50 points:</span>

<span class="sd">        #!python</span>
<span class="sd">        q = QueryOR(db).game(home_score__ge=50, away_score__ge=50)</span>
<span class="sd">        for game in q.as_games():</span>
<span class="sd">            print game</span>

<span class="sd">    Finally, multiple queries can be combined with `nfldb.Query.andalso`.</span>
<span class="sd">    For example, to restrict the last search to games in the 2012 regular</span>
<span class="sd">    season:</span>

<span class="sd">        #!python</span>
<span class="sd">        big_score = QueryOR(db).game(home_score__ge=50, away_score__ge=50)</span>

<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">        q.andalso(big_score)</span>
<span class="sd">        for game in q.as_games():</span>
<span class="sd">            print game</span>

<span class="sd">    This is only the beginning of what can be done. More examples that run</span>
<span class="sd">    the gamut can be found on</span>
<span class="sd">    [nfldb&#39;s wiki](https://github.com/BurntSushi/nfldb/wiki).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduces a new `nfldb.Query` object. Criteria can be</span>
<span class="sd">        added with any combination of the `nfldb.Query.game`,</span>
<span class="sd">        `nfldb.Query.drive`, `nfldb.Query.play`, `nfldb.Query.player`</span>
<span class="sd">        and `nfldb.Query.aggregate` methods. Results can</span>
<span class="sd">        then be retrieved with any of the `as_*` methods:</span>
<span class="sd">        `nfldb.Query.as_games`, `nfldb.Query.as_drives`,</span>
<span class="sd">        `nfldb.Query.as_plays`, `nfldb.Query.as_play_players`,</span>
<span class="sd">        `nfldb.Query.as_players` and `nfldb.Query.as_aggregate`.</span>

<span class="sd">        Note that if aggregate criteria are specified with</span>
<span class="sd">        `nfldb.Query.aggregate`, then the **only** way to retrieve</span>
<span class="sd">        results is with the `nfldb.Query.as_aggregate` method. Invoking</span>
<span class="sd">        any of the other `as_*` methods will raise an assertion error.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="sd">&quot;&quot;&quot;A psycopg2 database connection object.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;Expressions used to sort the results.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The number of results to limit the search to.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;A list of conjunctive conditions.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of disjunctive conditions applied to</span>
<span class="sd">        `Query._andalso`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="k">if</span> <span class="n">orelse</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether to use conjunctive or disjunctive conditions by</span>
<span class="sd">        default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># The aggregate counter-parts of the above.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exprs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify sorting criteria for the result set returned by</span>
<span class="sd">        using sort expressions. A sort expression is a tuple with</span>
<span class="sd">        two elements: a field to sort by and the order to use. The</span>
<span class="sd">        field should correspond to an attribute of the objects you&#39;re</span>
<span class="sd">        returning and the order should be `asc` for ascending (smallest</span>
<span class="sd">        to biggest) or `desc` for descending (biggest to smallest).</span>

<span class="sd">        For example, `(&#39;passing_yds&#39;, &#39;desc&#39;)` would sort plays by the</span>
<span class="sd">        number of passing yards in the play, with the biggest coming</span>
<span class="sd">        first.</span>

<span class="sd">        Remember that a sort field must be an attribute of the</span>
<span class="sd">        results being returned. For example, you can&#39;t sort plays by</span>
<span class="sd">        `home_score`, which is an attribute of a `nfldb.Game` object.</span>
<span class="sd">        If you require this behavior, you will need to do it in Python</span>
<span class="sd">        with its `sorted` built in function. (Or alternatively, use</span>
<span class="sd">        two separate queries if the result set is large.)</span>

<span class="sd">        You may provide multiple sort expressions. For example,</span>
<span class="sd">        `[(&#39;gsis_id&#39;, &#39;asc&#39;), (&#39;time&#39;, &#39;asc&#39;), (&#39;play_id&#39;, &#39;asc&#39;)]`</span>
<span class="sd">        would sort plays in the order in which they occurred within</span>
<span class="sd">        each game.</span>

<span class="sd">        `exprs` may also just be a string specifying a single</span>
<span class="sd">        field which defaults to a descending order. For example,</span>
<span class="sd">        `sort(&#39;passing_yds&#39;)` sorts plays by passing yards in</span>
<span class="sd">        descending order.</span>

<span class="sd">        If `exprs` is set to the empty list, then sorting will be</span>
<span class="sd">        disabled for this query.</span>

<span class="sd">        Note that sorting criteria can be combined with</span>
<span class="sd">        `nfldb.Query.limit` to limit results which can dramatically</span>
<span class="sd">        speed up larger searches. For example, to fetch the top 10</span>
<span class="sd">        passing plays in the 2012 season:</span>

<span class="sd">            #!python</span>
<span class="sd">            q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">            q.sort(&#39;passing_yds&#39;).limit(10)</span>
<span class="sd">            for p in q.as_plays():</span>
<span class="sd">                print p</span>

<span class="sd">        A more naive approach might be to fetch all plays and sort them</span>
<span class="sd">        with Python:</span>

<span class="sd">            #!python</span>
<span class="sd">            q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">            plays = q.as_plays()</span>

<span class="sd">            plays = sorted(plays, key=lambda p: p.passing_yds, reverse=True)</span>
<span class="sd">            for p in plays[:10]:</span>
<span class="sd">                print p</span>

<span class="sd">        But this is over **43 times slower** on my machine than using</span>
<span class="sd">        `nfldb.Query.sort` and `nfldb.Query.limit`. (The performance</span>
<span class="sd">        difference is due to making PostgreSQL perform the search and</span>
<span class="sd">        restricting the number of results returned to process.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span> <span class="o">=</span> <span class="n">exprs</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Limits the number of results to the integer `count`. If `count` is</span>
<span class="sd">        `0` (the default), then no limiting is done.</span>

<span class="sd">        See the documentation for `nfldb.Query.sort` for an example on how</span>
<span class="sd">        to combine it with `nfldb.Query.limit` to get results quickly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="n">count</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_sorter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_entity</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sorter</span><span class="p">(</span><span class="n">default_entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assert_no_aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> \
            <span class="s">&#39;aggregate criteria are only compatible with as_aggregate&#39;</span>

    <span class="k">def</span> <span class="nf">andalso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the list of `nfldb.Query` objects in `conds` to this</span>
<span class="sd">        query&#39;s list of conjunctive conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span> <span class="o">+=</span> <span class="n">conds</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">orelse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the list of `nfldb.Query` objects in `conds` to this</span>
<span class="sd">        query&#39;s list of disjunctive conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="o">+=</span> <span class="n">conds</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify search criteria for an NFL game. The possible fields</span>
<span class="sd">        correspond to columns in the `game` table (or derived columns).</span>
<span class="sd">        They are documented as instance variables in the `nfldb.Game`</span>
<span class="sd">        class. Additionally, there are some special fields that provide</span>
<span class="sd">        convenient access to common conditions:</span>

<span class="sd">          * **team** - Find games that the team given played in, regardless</span>
<span class="sd">                       of whether it is the home or away team.</span>

<span class="sd">        Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">        how to specify search criteria.</span>

<span class="sd">        Please</span>
<span class="sd">        [open an issue](https://github.com/BurntSushi/nfldb/issues/new)</span>
<span class="sd">        if you can think of other special fields to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;team&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">team</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;team&#39;</span><span class="p">)</span>
            <span class="n">ors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;home_team&#39;</span><span class="p">:</span> <span class="n">team</span><span class="p">,</span> <span class="s">&#39;away_team&#39;</span><span class="p">:</span> <span class="n">team</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">andalso</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="o">**</span><span class="n">ors</span><span class="p">))</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify search criteria for a drive. The possible fields</span>
<span class="sd">        correspond to columns in the `drive` table (or derived</span>
<span class="sd">        columns). They are documented as instance variables in the</span>
<span class="sd">        `nfldb.Drive` class.</span>

<span class="sd">        Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">        how to specify search criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify search criteria for a play. The possible fields</span>
<span class="sd">        correspond to columns in the `play` or `play_player` tables (or</span>
<span class="sd">        derived columns). They are documented as instance variables in</span>
<span class="sd">        the `nfldb.Play` and `nfldb.PlayPlayer` classes. Additionally,</span>
<span class="sd">        the fields listed on the</span>
<span class="sd">        [statistical categories](http://goo.gl/1qYG3C)</span>
<span class="sd">        wiki page may be used. That includes **both** `play` and</span>
<span class="sd">        `player` statistical categories.</span>

<span class="sd">        Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">        how to specify search criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">play_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify search criteria for individual play player statistics.</span>
<span class="sd">        The allowed fields are the columns in the `play_player`</span>
<span class="sd">        table.  They are documented as instance variables in the</span>
<span class="sd">        `nfldb.PlayPlayer` class. Additionally, the fields listed on</span>
<span class="sd">        the [statistical categories](http://goo.gl/1qYG3C) wiki page</span>
<span class="sd">        may be used. (Only the `player` statistical categories.)</span>

<span class="sd">        This method differs from `nfldb.Query.play` in that it can be</span>
<span class="sd">        used to select for individual player statistics in a play. In</span>
<span class="sd">        particular, there are *zero or more* player statistics for</span>
<span class="sd">        every play.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Technically, it isn&#39;t necessary to handle derived fields manually</span>
        <span class="c"># since their SQL can be generated automatically, but it can be</span>
        <span class="c"># much faster to express them in terms of boolean logic with other</span>
        <span class="c"># fields rather than generate them.</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nosuff</span> <span class="o">=</span> <span class="n">_no_comp_suffix</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">suff</span> <span class="o">=</span> <span class="n">_comp_suffix</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">replace_or</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">ors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">__</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">suff</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">andalso</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">play_player</span><span class="p">(</span><span class="o">**</span><span class="n">ors</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">nosuff</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">:</span>
                <span class="n">replace_or</span><span class="p">(</span><span class="o">*</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">[</span><span class="n">nosuff</span><span class="p">])</span>
                <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c"># Now add the rest of the query.</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify search criteria for a player. The possible fields</span>
<span class="sd">        correspond to columns in the `player` table (or derived</span>
<span class="sd">        columns). They are documented as instance variables in the</span>
<span class="sd">        `nfldb.Player` class.</span>

<span class="sd">        Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">        how to specify search criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is just like `nfldb.Query.play_player`, except the search</span>
<span class="sd">        parameters are applied to aggregate statistics.</span>

<span class="sd">        For example, to retrieve all quarterbacks who passed for at</span>
<span class="sd">        least 4000 yards in the 2012 season:</span>

<span class="sd">            #!python</span>
<span class="sd">            q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">            q.aggregate(passing_yds__ge=4000)</span>
<span class="sd">            for pp in q.as_aggregate():</span>
<span class="sd">                print pp.player, pp.passing_yds</span>

<span class="sd">        Aggregate results can also be sorted:</span>

<span class="sd">            #!python</span>
<span class="sd">            for pp in q.sort(&#39;passing_yds&#39;).as_aggregate():</span>
<span class="sd">                print pp.player, pp.passing_yds</span>

<span class="sd">        Note that this method can **only** be used with</span>
<span class="sd">        `nfldb.Query.as_aggregate`. Use with any of the other</span>
<span class="sd">        `as_*` methods will result in an assertion error. Note</span>
<span class="sd">        though that regular criteria can still be specified with</span>
<span class="sd">        `nfldb.Query.game`, `nfldb.Query.play`, etc. (Regular criteria</span>
<span class="sd">        restrict *what to aggregate* while aggregate criteria restrict</span>
<span class="sd">        *aggregated results*.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_make_join_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">only_prim</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">ent_fillers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sorter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sorter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorter</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span><span class="p">()</span>
        <span class="n">entities</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sorter</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">ent_fillers</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
        <span class="n">entities</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="c"># If we&#39;re joining the `player` table with any other table except</span>
        <span class="c"># `play_player`, then we MUST add `play_player` as a joining table.</span>
        <span class="c"># It is the only way to bridge players and games/drives/plays.</span>
        <span class="c">#</span>
        <span class="c"># TODO: This could probably be automatically deduced in general case,</span>
        <span class="c"># but we only have one case so just check for it manually.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span> <span class="ow">and</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">entity</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">only_prim</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;primary&#39;</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">ent_fillers</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="n">fields</span> <span class="o">+=</span> <span class="n">ent</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">ent</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">())</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">())</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;columns&#39;</span><span class="p">:</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
            <span class="s">&#39;from&#39;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_from</span><span class="p">(),</span>
            <span class="s">&#39;joins&#39;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_join_all</span><span class="p">(</span><span class="n">entities</span><span class="p">),</span>
            <span class="s">&#39;where&#39;</span><span class="p">:</span> <span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cursor</span><span class="p">)),</span>
            <span class="s">&#39;groupby&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;sortby&#39;</span><span class="p">:</span> <span class="n">sorter</span><span class="o">.</span><span class="n">sql</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="c"># We need a GROUP BY if we&#39;re joining with a table that has more</span>
        <span class="c"># specific information. e.g., selecting from game with criteria</span>
        <span class="c"># for plays.</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">_sql_relation_distance</span><span class="p">(</span><span class="n">to</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">to</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;tables&#39;</span><span class="p">]:</span>
                <span class="n">fields</span> <span class="o">+=</span> <span class="n">entity</span><span class="o">.</span><span class="n">_sql_primary_key</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">args</span><span class="p">[</span><span class="s">&#39;groupby&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;GROUP BY &#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">            SELECT {columns} {from} {joins}</span>
<span class="s">            WHERE {where}</span>
<span class="s">            {groupby}</span>
<span class="s">            {sortby}</span>
<span class="s">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">as_games</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as a list of</span>
<span class="sd">        `nfldb.Game` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">from_row_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">as_drives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as a list of</span>
<span class="sd">        `nfldb.Drive` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="o">.</span><span class="n">from_row_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">as_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as a dictionary</span>
<span class="sd">        of `nlfdb.Play` objects that don&#39;t have the `play_player`</span>
<span class="sd">        attribute filled. The keys of the dictionary are play id</span>
<span class="sd">        tuples with the spec `(gsis_id, drive_id, play_id)`.</span>

<span class="sd">        The primary key membership SQL expression is also returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">make_pid</span><span class="p">(</span><span class="n">play</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">play</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">play</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span> <span class="n">play</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>

        <span class="c"># This is pretty terrifying.</span>
        <span class="c"># Apparently PostgreSQL can change the order of rows returned</span>
        <span class="c"># depending on the columns selected. So e.g., if you sort by `down`</span>
        <span class="c"># and limit to 20 results, you might get a different 20 plays if</span>
        <span class="c"># you change which columns you&#39;re selecting.</span>
        <span class="c"># This is pertinent here because if we&#39;re filling plays with player</span>
        <span class="c"># statistics, then we are assuming that this order never changes.</span>
        <span class="c"># To make the ordering consistent, we add the play&#39;s primary key to</span>
        <span class="c"># the existing sort criteria, which guarantees that the sort will</span>
        <span class="c"># always be the same.</span>
        <span class="c"># (We are careful not to override the user specified</span>
        <span class="c"># `self._sort_exprs`.)</span>
        <span class="c">#</span>
        <span class="c"># That was a lie. We override the user settings if the user asks</span>
        <span class="c"># to sort by `gsis_id`, `drive_id` or `play_id`.</span>
        <span class="n">consistent</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;gsis_id&#39;</span><span class="p">,</span> <span class="s">&#39;drive_id&#39;</span><span class="p">,</span> <span class="s">&#39;play_id&#39;</span><span class="p">]]</span>
        <span class="n">sorter</span> <span class="o">=</span> <span class="n">Sorter</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span><span class="p">)</span>
        <span class="n">sorter</span><span class="o">.</span><span class="n">add_exprs</span><span class="p">(</span><span class="o">*</span><span class="n">consistent</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="o">.</span><span class="n">from_row_tuple</span>
                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plays</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">init_play</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="o">.</span><span class="n">from_row_tuple</span>
                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                    <span class="n">play</span> <span class="o">=</span> <span class="n">init_play</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                    <span class="n">play</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">plays</span><span class="p">[</span><span class="n">make_pid</span><span class="p">(</span><span class="n">play</span><span class="p">)]</span> <span class="o">=</span> <span class="n">play</span>

                <span class="c"># Run the above query *again* as a subquery.</span>
                <span class="c"># This time, only fetch the primary key, and use that to</span>
                <span class="c"># fetch all the `play_player` records in one swoop.</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;play_player&#39;</span><span class="p">:</span> <span class="s">&#39;pp&#39;</span><span class="p">}</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span>
                                            <span class="n">only_prim</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
                <span class="n">from_tables</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_from</span><span class="p">(</span><span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span>
                    <span class="n">fields</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">(),</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
                <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">                    SELECT {columns} {from_tables}</span>
<span class="s">                    WHERE (pp.gsis_id, pp.drive_id, pp.play_id) IN ({ids})</span>
<span class="s">                &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span>
                           <span class="n">from_tables</span><span class="o">=</span><span class="n">from_tables</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

                <span class="n">init_pp</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">from_row_tuple</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                    <span class="n">pp</span> <span class="o">=</span> <span class="n">init_pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                    <span class="n">plays</span><span class="p">[</span><span class="n">make_pid</span><span class="p">(</span><span class="n">pp</span><span class="p">)]</span><span class="o">.</span><span class="n">_play_players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plays</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">as_play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as a list of</span>
<span class="sd">        `nlfdb.PlayPlayer` objects.</span>

<span class="sd">        This provides a way to access player statistics directly</span>
<span class="sd">        by bypassing play data. Usually the results of this method</span>
<span class="sd">        are passed to `nfldb.aggregate`. It is recommended to use</span>
<span class="sd">        `nfldb.Query.aggregate` and `nfldb.Query.as_aggregate` when</span>
<span class="sd">        possible, since it is significantly faster to sum statistics in</span>
<span class="sd">        the database as opposed to Python.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">from_row_tuple</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">as_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as a list of</span>
<span class="sd">        `nfldb.Player` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="o">.</span><span class="n">from_row_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">as_aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the query and returns the results as aggregated</span>
<span class="sd">        `nfldb.PlayPlayer` objects. This method is meant to be a more</span>
<span class="sd">        restricted but much faster version of `nfldb.aggregate`.</span>
<span class="sd">        Namely, this method uses PostgreSQL to compute the aggregate</span>
<span class="sd">        statistics while `nfldb.aggregate` computes them in Python</span>
<span class="sd">        code.</span>

<span class="sd">        If any sorting criteria is specified, it is applied to the</span>
<span class="sd">        aggregate *player* values only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">class</span> <span class="nc">AggPP</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">):</span>
            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">_sql_field</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">:</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
                    <span class="k">return</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;points&#39;</span><span class="p">:</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;(</span><span class="si">%s</span><span class="s"> * </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">),</span> <span class="n">pval</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_point_values</span><span class="p">]</span>
                    <span class="k">return</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sql</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AggPP</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s">&#39;SUM(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">sql</span>

        <span class="n">joins</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ent</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">joins</span> <span class="o">+=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_join_to_all</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

            <span class="n">sum_fields</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">_player_categories</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> \
                <span class="o">+</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
            <span class="n">select_sum_fields</span> <span class="o">=</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">sum_fields</span><span class="p">)</span>
            <span class="n">where</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
            <span class="n">having</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">                SELECT</span>
<span class="s">                    play_player.player_id AS play_player_player_id, {sum_fields}</span>
<span class="s">                FROM play_player</span>
<span class="s">                {joins}</span>
<span class="s">                WHERE {where}</span>
<span class="s">                GROUP BY play_player.player_id</span>
<span class="s">                HAVING {having}</span>
<span class="s">                {order}</span>
<span class="s">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">sum_fields</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">select_sum_fields</span><span class="p">),</span>
                <span class="n">joins</span><span class="o">=</span><span class="n">joins</span><span class="p">,</span>
                <span class="n">where</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="n">where</span><span class="p">),</span>
                <span class="n">having</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="n">having</span><span class="p">),</span>
                <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sorter</span><span class="p">(</span><span class="n">AggPP</span><span class="p">)</span><span class="o">.</span><span class="n">sql</span><span class="p">(),</span>
            <span class="p">)</span>

            <span class="n">init</span> <span class="o">=</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">from_row_dict</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the entity types referenced in the search criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">tabs</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">_entities</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">tabs</span>

    <span class="k">def</span> <span class="nf">show_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an approximate WHERE clause corresponding to the</span>
<span class="sd">        criteria specified in `self`. Note that the WHERE clause given</span>
<span class="sd">        is never explicitly used for performance reasons, but one hopes</span>
<span class="sd">        that it describes the criteria in `self`.</span>

<span class="sd">        If `aggregate` is `True`, then aggregate criteria for the</span>
<span class="sd">        `play` and `play_player` tables is shown with aggregate</span>
<span class="sd">        functions applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_sql_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a WHERE expression representing the search criteria</span>
<span class="sd">        in `self` and restricted to the tables in `tables`.</span>

<span class="sd">        If `aggregate` is `True`, then the appropriate aggregate</span>
<span class="sd">        functions are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Condition</span><span class="o">.</span><span class="n">_disjunctions</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span><span class="p">]</span> <span class="o">+</span> <span class="p">[[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span><span class="p">],</span>
                <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Condition</span><span class="o">.</span><span class="n">_disjunctions</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span><span class="p">]</span> <span class="o">+</span> <span class="p">[[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span><span class="p">],</span>
                <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Query">Query</a></li>
          <li>nfldb.query.Condition</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Query.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db, orelse=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new <a href="#nfldb.Query"><code>Query</code></a> object. Criteria can be
added with any combination of the <a href="#nfldb.Query.game"><code>game</code></a>,
<a href="#nfldb.Query.drive"><code>drive</code></a>, <a href="#nfldb.Query.play"><code>play</code></a>, <a href="#nfldb.Query.player"><code>player</code></a>
and <a href="#nfldb.Query.aggregate"><code>aggregate</code></a> methods. Results can
then be retrieved with any of the <code>as_*</code> methods:
<a href="#nfldb.Query.as_games"><code>as_games</code></a>, <a href="#nfldb.Query.as_drives"><code>as_drives</code></a>,
<a href="#nfldb.Query.as_plays"><code>as_plays</code></a>, <a href="#nfldb.Query.as_play_players"><code>as_play_players</code></a>,
<a href="#nfldb.Query.as_players"><code>as_players</code></a> and <a href="#nfldb.Query.as_aggregate"><code>as_aggregate</code></a>.</p>
<p>Note that if aggregate criteria are specified with
<a href="#nfldb.Query.aggregate"><code>aggregate</code></a>, then the <strong>only</strong> way to retrieve
results is with the <a href="#nfldb.Query.as_aggregate"><code>as_aggregate</code></a> method. Invoking
any of the other <code>as_*</code> methods will raise an assertion error.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new `nfldb.Query` object. Criteria can be</span>
<span class="sd">    added with any combination of the `nfldb.Query.game`,</span>
<span class="sd">    `nfldb.Query.drive`, `nfldb.Query.play`, `nfldb.Query.player`</span>
<span class="sd">    and `nfldb.Query.aggregate` methods. Results can</span>
<span class="sd">    then be retrieved with any of the `as_*` methods:</span>
<span class="sd">    `nfldb.Query.as_games`, `nfldb.Query.as_drives`,</span>
<span class="sd">    `nfldb.Query.as_plays`, `nfldb.Query.as_play_players`,</span>
<span class="sd">    `nfldb.Query.as_players` and `nfldb.Query.as_aggregate`.</span>
<span class="sd">    Note that if aggregate criteria are specified with</span>
<span class="sd">    `nfldb.Query.aggregate`, then the **only** way to retrieve</span>
<span class="sd">    results is with the `nfldb.Query.as_aggregate` method. Invoking</span>
<span class="sd">    any of the other `as_*` methods will raise an assertion error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="sd">&quot;&quot;&quot;A psycopg2 database connection object.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;Expressions used to sort the results.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The number of results to limit the search to.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;A list of conjunctive conditions.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of disjunctive conditions applied to</span>
<span class="sd">    `Query._andalso`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="k">if</span> <span class="n">orelse</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Whether to use conjunctive or disjunctive conditions by</span>
<span class="sd">    default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># The aggregate counter-parts of the above.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">orelse</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_orelse</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agg_andalso</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.aggregate">
    <p>def <span class="ident">aggregate</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>This is just like <a href="#nfldb.Query.play_player"><code>play_player</code></a>, except the search
parameters are applied to aggregate statistics.</p>
<p>For example, to retrieve all quarterbacks who passed for at
least 4000 yards in the 2012 season:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">passing_yds__ge</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_aggregate</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">pp</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">passing_yds</span>
</pre></div>


<p>Aggregate results can also be sorted:</p>
<div class="codehilite"><pre><span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;passing_yds&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">as_aggregate</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">pp</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">passing_yds</span>
</pre></div>


<p>Note that this method can <strong>only</strong> be used with
<a href="#nfldb.Query.as_aggregate"><code>as_aggregate</code></a>. Use with any of the other
<code>as_*</code> methods will result in an assertion error. Note
though that regular criteria can still be specified with
<a href="#nfldb.Query.game"><code>game</code></a>, <a href="#nfldb.Query.play"><code>play</code></a>, etc. (Regular criteria
restrict <em>what to aggregate</em> while aggregate criteria restrict
<em>aggregated results</em>.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.aggregate', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.aggregate" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is just like `nfldb.Query.play_player`, except the search</span>
<span class="sd">    parameters are applied to aggregate statistics.</span>
<span class="sd">    For example, to retrieve all quarterbacks who passed for at</span>
<span class="sd">    least 4000 yards in the 2012 season:</span>
<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">        q.aggregate(passing_yds__ge=4000)</span>
<span class="sd">        for pp in q.as_aggregate():</span>
<span class="sd">            print pp.player, pp.passing_yds</span>
<span class="sd">    Aggregate results can also be sorted:</span>
<span class="sd">        #!python</span>
<span class="sd">        for pp in q.sort(&#39;passing_yds&#39;).as_aggregate():</span>
<span class="sd">            print pp.player, pp.passing_yds</span>
<span class="sd">    Note that this method can **only** be used with</span>
<span class="sd">    `nfldb.Query.as_aggregate`. Use with any of the other</span>
<span class="sd">    `as_*` methods will result in an assertion error. Note</span>
<span class="sd">    though that regular criteria can still be specified with</span>
<span class="sd">    `nfldb.Query.game`, `nfldb.Query.play`, etc. (Regular criteria</span>
<span class="sd">    restrict *what to aggregate* while aggregate criteria restrict</span>
<span class="sd">    *aggregated results*.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.andalso">
    <p>def <span class="ident">andalso</span>(</p><p>self, *conds)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds the list of <a href="#nfldb.Query"><code>Query</code></a> objects in <code>conds</code> to this
query's list of conjunctive conditions.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.andalso', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.andalso" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">andalso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds the list of `nfldb.Query` objects in `conds` to this</span>
<span class="sd">    query&#39;s list of conjunctive conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_andalso</span> <span class="o">+=</span> <span class="n">conds</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_aggregate">
    <p>def <span class="ident">as_aggregate</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as aggregated
<a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> objects. This method is meant to be a more
restricted but much faster version of <a href="#nfldb.aggregate"><code>aggregate</code></a>.
Namely, this method uses PostgreSQL to compute the aggregate
statistics while <a href="#nfldb.aggregate"><code>aggregate</code></a> computes them in Python
code.</p>
<p>If any sorting criteria is specified, it is applied to the
aggregate <em>player</em> values only.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_aggregate', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_aggregate" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as aggregated</span>
<span class="sd">    `nfldb.PlayPlayer` objects. This method is meant to be a more</span>
<span class="sd">    restricted but much faster version of `nfldb.aggregate`.</span>
<span class="sd">    Namely, this method uses PostgreSQL to compute the aggregate</span>
<span class="sd">    statistics while `nfldb.aggregate` computes them in Python</span>
<span class="sd">    code.</span>
<span class="sd">    If any sorting criteria is specified, it is applied to the</span>
<span class="sd">    aggregate *player* values only.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">AggPP</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">):</span>
        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">_sql_field</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
                <span class="k">return</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;points&#39;</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;(</span><span class="si">%s</span><span class="s"> * </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">),</span> <span class="n">pval</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">_point_values</span><span class="p">]</span>
                <span class="k">return</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AggPP</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">_sql_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&#39;SUM(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">sql</span>
    <span class="n">joins</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ent</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">joins</span> <span class="o">+=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_join_to_all</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
        <span class="n">sum_fields</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">_player_categories</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> \
            <span class="o">+</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">_sql_tables</span><span class="p">[</span><span class="s">&#39;derived&#39;</span><span class="p">]</span>
        <span class="n">select_sum_fields</span> <span class="o">=</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span><span class="n">sum_fields</span><span class="p">)</span>
        <span class="n">where</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="n">having</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">            SELECT</span>
<span class="s">                play_player.player_id AS play_player_player_id, {sum_fields}</span>
<span class="s">            FROM play_player</span>
<span class="s">            {joins}</span>
<span class="s">            WHERE {where}</span>
<span class="s">            GROUP BY play_player.player_id</span>
<span class="s">            HAVING {having}</span>
<span class="s">            {order}</span>
<span class="s">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">sum_fields</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">select_sum_fields</span><span class="p">),</span>
            <span class="n">joins</span><span class="o">=</span><span class="n">joins</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="n">where</span><span class="p">),</span>
            <span class="n">having</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">ands</span><span class="p">(</span><span class="n">having</span><span class="p">),</span>
            <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sorter</span><span class="p">(</span><span class="n">AggPP</span><span class="p">)</span><span class="o">.</span><span class="n">sql</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">AggPP</span><span class="o">.</span><span class="n">from_row_dict</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_drives">
    <p>def <span class="ident">as_drives</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as a list of
<a href="#nfldb.Drive"><code>Drive</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_drives', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_drives" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_drives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as a list of</span>
<span class="sd">    `nfldb.Drive` objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="o">.</span><span class="n">from_row_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_games">
    <p>def <span class="ident">as_games</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as a list of
<a href="#nfldb.Game"><code>Game</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_games', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_games" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_games</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as a list of</span>
<span class="sd">    `nfldb.Game` objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">from_row_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_play_players">
    <p>def <span class="ident">as_play_players</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as a list of
<code>nlfdb.PlayPlayer</code> objects.</p>
<p>This provides a way to access player statistics directly
by bypassing play data. Usually the results of this method
are passed to <a href="#nfldb.aggregate"><code>aggregate</code></a>. It is recommended to use
<a href="#nfldb.Query.aggregate"><code>aggregate</code></a> and <a href="#nfldb.Query.as_aggregate"><code>as_aggregate</code></a> when
possible, since it is significantly faster to sum statistics in
the database as opposed to Python.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_play_players', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_play_players" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as a list of</span>
<span class="sd">    `nlfdb.PlayPlayer` objects.</span>
<span class="sd">    This provides a way to access player statistics directly</span>
<span class="sd">    by bypassing play data. Usually the results of this method</span>
<span class="sd">    are passed to `nfldb.aggregate`. It is recommended to use</span>
<span class="sd">    `nfldb.Query.aggregate` and `nfldb.Query.as_aggregate` when</span>
<span class="sd">    possible, since it is significantly faster to sum statistics in</span>
<span class="sd">    the database as opposed to Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">from_row_tuple</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_players">
    <p>def <span class="ident">as_players</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as a list of
<a href="#nfldb.Player"><code>Player</code></a> objects.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_players', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_players" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as a list of</span>
<span class="sd">    `nfldb.Player` objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="o">.</span><span class="n">from_row_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.as_plays">
    <p>def <span class="ident">as_plays</span>(</p><p>self, fill=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes the query and returns the results as a dictionary
of <code>nlfdb.Play</code> objects that don't have the <code>play_player</code>
attribute filled. The keys of the dictionary are play id
tuples with the spec <code>(gsis_id, drive_id, play_id)</code>.</p>
<p>The primary key membership SQL expression is also returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.as_plays', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.as_plays" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">as_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes the query and returns the results as a dictionary</span>
<span class="sd">    of `nlfdb.Play` objects that don&#39;t have the `play_player`</span>
<span class="sd">    attribute filled. The keys of the dictionary are play id</span>
<span class="sd">    tuples with the spec `(gsis_id, drive_id, play_id)`.</span>
<span class="sd">    The primary key membership SQL expression is also returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">make_pid</span><span class="p">(</span><span class="n">play</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">play</span><span class="o">.</span><span class="n">gsis_id</span><span class="p">,</span> <span class="n">play</span><span class="o">.</span><span class="n">drive_id</span><span class="p">,</span> <span class="n">play</span><span class="o">.</span><span class="n">play_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_no_aggregate</span><span class="p">()</span>
    <span class="c"># This is pretty terrifying.</span>
    <span class="c"># Apparently PostgreSQL can change the order of rows returned</span>
    <span class="c"># depending on the columns selected. So e.g., if you sort by `down`</span>
    <span class="c"># and limit to 20 results, you might get a different 20 plays if</span>
    <span class="c"># you change which columns you&#39;re selecting.</span>
    <span class="c"># This is pertinent here because if we&#39;re filling plays with player</span>
    <span class="c"># statistics, then we are assuming that this order never changes.</span>
    <span class="c"># To make the ordering consistent, we add the play&#39;s primary key to</span>
    <span class="c"># the existing sort criteria, which guarantees that the sort will</span>
    <span class="c"># always be the same.</span>
    <span class="c"># (We are careful not to override the user specified</span>
    <span class="c"># `self._sort_exprs`.)</span>
    <span class="c">#</span>
    <span class="c"># That was a lie. We override the user settings if the user asks</span>
    <span class="c"># to sort by `gsis_id`, `drive_id` or `play_id`.</span>
    <span class="n">consistent</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;asc&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;gsis_id&#39;</span><span class="p">,</span> <span class="s">&#39;drive_id&#39;</span><span class="p">,</span> <span class="s">&#39;play_id&#39;</span><span class="p">]]</span>
    <span class="n">sorter</span> <span class="o">=</span> <span class="n">Sorter</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span><span class="p">)</span>
    <span class="n">sorter</span><span class="o">.</span><span class="n">add_exprs</span><span class="p">(</span><span class="o">*</span><span class="n">consistent</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="o">.</span><span class="n">from_row_tuple</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plays</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">tuple_cursor</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">init_play</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="o">.</span><span class="n">from_row_tuple</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">play</span> <span class="o">=</span> <span class="n">init_play</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="n">play</span><span class="o">.</span><span class="n">_play_players</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">plays</span><span class="p">[</span><span class="n">make_pid</span><span class="p">(</span><span class="n">play</span><span class="p">)]</span> <span class="o">=</span> <span class="n">play</span>
            <span class="c"># Run the above query *again* as a subquery.</span>
            <span class="c"># This time, only fetch the primary key, and use that to</span>
            <span class="c"># fetch all the `play_player` records in one swoop.</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;play_player&#39;</span><span class="p">:</span> <span class="s">&#39;pp&#39;</span><span class="p">}</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_join_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span>
                                        <span class="n">only_prim</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
            <span class="n">from_tables</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_from</span><span class="p">(</span><span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_sql_select_fields</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">sql_fields</span><span class="p">(),</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">                SELECT {columns} {from_tables}</span>
<span class="s">                WHERE (pp.gsis_id, pp.drive_id, pp.play_id) IN ({ids})</span>
<span class="s">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span>
                       <span class="n">from_tables</span><span class="o">=</span><span class="n">from_tables</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>
            <span class="n">init_pp</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">from_row_tuple</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">init_pp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="n">plays</span><span class="p">[</span><span class="n">make_pid</span><span class="p">(</span><span class="n">pp</span><span class="p">)]</span><span class="o">.</span><span class="n">_play_players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plays</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.drive">
    <p>def <span class="ident">drive</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify search criteria for a drive. The possible fields
correspond to columns in the <code>drive</code> table (or derived
columns). They are documented as instance variables in the
<a href="#nfldb.Drive"><code>Drive</code></a> class.</p>
<p>Please see the documentation for <a href="#nfldb.Query"><code>Query</code></a> for examples on
how to specify search criteria.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.drive', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.drive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify search criteria for a drive. The possible fields</span>
<span class="sd">    correspond to columns in the `drive` table (or derived</span>
<span class="sd">    columns). They are documented as instance variables in the</span>
<span class="sd">    `nfldb.Drive` class.</span>
<span class="sd">    Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">    how to specify search criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Drive</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.game">
    <p>def <span class="ident">game</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify search criteria for an NFL game. The possible fields
correspond to columns in the <code>game</code> table (or derived columns).
They are documented as instance variables in the <a href="#nfldb.Game"><code>Game</code></a>
class. Additionally, there are some special fields that provide
convenient access to common conditions:</p>
<ul>
<li><strong>team</strong> - Find games that the team given played in, regardless
               of whether it is the home or away team.</li>
</ul>
<p>Please see the documentation for <a href="#nfldb.Query"><code>Query</code></a> for examples on
how to specify search criteria.</p>
<p>Please
<a href="https://github.com/BurntSushi/nfldb/issues/new">open an issue</a>
if you can think of other special fields to add.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.game', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.game" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify search criteria for an NFL game. The possible fields</span>
<span class="sd">    correspond to columns in the `game` table (or derived columns).</span>
<span class="sd">    They are documented as instance variables in the `nfldb.Game`</span>
<span class="sd">    class. Additionally, there are some special fields that provide</span>
<span class="sd">    convenient access to common conditions:</span>
<span class="sd">      * **team** - Find games that the team given played in, regardless</span>
<span class="sd">                   of whether it is the home or away team.</span>
<span class="sd">    Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">    how to specify search criteria.</span>
<span class="sd">    Please</span>
<span class="sd">    [open an issue](https://github.com/BurntSushi/nfldb/issues/new)</span>
<span class="sd">    if you can think of other special fields to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s">&#39;team&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;team&#39;</span><span class="p">)</span>
        <span class="n">ors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;home_team&#39;</span><span class="p">:</span> <span class="n">team</span><span class="p">,</span> <span class="s">&#39;away_team&#39;</span><span class="p">:</span> <span class="n">team</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">andalso</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="o">**</span><span class="n">ors</span><span class="p">))</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Game</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.limit">
    <p>def <span class="ident">limit</span>(</p><p>self, count)</p>
    </div>
    

    
  
    <div class="desc"><p>Limits the number of results to the integer <code>count</code>. If <code>count</code> is
<code>0</code> (the default), then no limiting is done.</p>
<p>See the documentation for <a href="#nfldb.Query.sort"><code>sort</code></a> for an example on how
to combine it with <a href="#nfldb.Query.limit"><code>limit</code></a> to get results quickly.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.limit', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.limit" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Limits the number of results to the integer `count`. If `count` is</span>
<span class="sd">    `0` (the default), then no limiting is done.</span>
<span class="sd">    See the documentation for `nfldb.Query.sort` for an example on how</span>
<span class="sd">    to combine it with `nfldb.Query.limit` to get results quickly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="n">count</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.orelse">
    <p>def <span class="ident">orelse</span>(</p><p>self, *conds)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds the list of <a href="#nfldb.Query"><code>Query</code></a> objects in <code>conds</code> to this
query's list of disjunctive conditions.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.orelse', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.orelse" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">orelse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds the list of `nfldb.Query` objects in `conds` to this</span>
<span class="sd">    query&#39;s list of disjunctive conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_orelse</span> <span class="o">+=</span> <span class="n">conds</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.play">
    <p>def <span class="ident">play</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify search criteria for a play. The possible fields
correspond to columns in the <code>play</code> or <code>play_player</code> tables (or
derived columns). They are documented as instance variables in
the <a href="#nfldb.Play"><code>Play</code></a> and <a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> classes. Additionally,
the fields listed on the
<a href="http://goo.gl/1qYG3C">statistical categories</a>
wiki page may be used. That includes <strong>both</strong> <code>play</code> and
<code>player</code> statistical categories.</p>
<p>Please see the documentation for <a href="#nfldb.Query"><code>Query</code></a> for examples on
how to specify search criteria.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.play', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.play" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify search criteria for a play. The possible fields</span>
<span class="sd">    correspond to columns in the `play` or `play_player` tables (or</span>
<span class="sd">    derived columns). They are documented as instance variables in</span>
<span class="sd">    the `nfldb.Play` and `nfldb.PlayPlayer` classes. Additionally,</span>
<span class="sd">    the fields listed on the</span>
<span class="sd">    [statistical categories](http://goo.gl/1qYG3C)</span>
<span class="sd">    wiki page may be used. That includes **both** `play` and</span>
<span class="sd">    `player` statistical categories.</span>
<span class="sd">    Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">    how to specify search criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Play</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.play_player">
    <p>def <span class="ident">play_player</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify search criteria for individual play player statistics.
The allowed fields are the columns in the <code>play_player</code>
table.  They are documented as instance variables in the
<a href="#nfldb.PlayPlayer"><code>PlayPlayer</code></a> class. Additionally, the fields listed on
the <a href="http://goo.gl/1qYG3C">statistical categories</a> wiki page
may be used. (Only the <code>player</code> statistical categories.)</p>
<p>This method differs from <a href="#nfldb.Query.play"><code>play</code></a> in that it can be
used to select for individual player statistics in a play. In
particular, there are <em>zero or more</em> player statistics for
every play.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.play_player', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.play_player" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">play_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify search criteria for individual play player statistics.</span>
<span class="sd">    The allowed fields are the columns in the `play_player`</span>
<span class="sd">    table.  They are documented as instance variables in the</span>
<span class="sd">    `nfldb.PlayPlayer` class. Additionally, the fields listed on</span>
<span class="sd">    the [statistical categories](http://goo.gl/1qYG3C) wiki page</span>
<span class="sd">    may be used. (Only the `player` statistical categories.)</span>
<span class="sd">    This method differs from `nfldb.Query.play` in that it can be</span>
<span class="sd">    used to select for individual player statistics in a play. In</span>
<span class="sd">    particular, there are *zero or more* player statistics for</span>
<span class="sd">    every play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Technically, it isn&#39;t necessary to handle derived fields manually</span>
    <span class="c"># since their SQL can be generated automatically, but it can be</span>
    <span class="c"># much faster to express them in terms of boolean logic with other</span>
    <span class="c"># fields rather than generate them.</span>
    <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nosuff</span> <span class="o">=</span> <span class="n">_no_comp_suffix</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">suff</span> <span class="o">=</span> <span class="n">_comp_suffix</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">replace_or</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">orelse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">__</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">suff</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">andalso</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">play_player</span><span class="p">(</span><span class="o">**</span><span class="n">ors</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nosuff</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">:</span>
            <span class="n">replace_or</span><span class="p">(</span><span class="o">*</span><span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="o">.</span><span class="n">_derived_combined</span><span class="p">[</span><span class="n">nosuff</span><span class="p">])</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="c"># Now add the rest of the query.</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">PlayPlayer</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.player">
    <p>def <span class="ident">player</span>(</p><p>self, **kw)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify search criteria for a player. The possible fields
correspond to columns in the <code>player</code> table (or derived
columns). They are documented as instance variables in the
<a href="#nfldb.Player"><code>Player</code></a> class.</p>
<p>Please see the documentation for <a href="#nfldb.Query"><code>Query</code></a> for examples on
how to specify search criteria.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.player', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.player" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify search criteria for a player. The possible fields</span>
<span class="sd">    correspond to columns in the `player` table (or derived</span>
<span class="sd">    columns). They are documented as instance variables in the</span>
<span class="sd">    `nfldb.Player` class.</span>
<span class="sd">    Please see the documentation for `nfldb.Query` for examples on</span>
<span class="sd">    how to specify search criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_append_conds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_cond</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Player</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.show_where">
    <p>def <span class="ident">show_where</span>(</p><p>self, aggregate=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns an approximate WHERE clause corresponding to the
criteria specified in <code>self</code>. Note that the WHERE clause given
is never explicitly used for performance reasons, but one hopes
that it describes the criteria in <code>self</code>.</p>
<p>If <code>aggregate</code> is <code>True</code>, then aggregate criteria for the
<code>play</code> and <code>play_player</code> tables is shown with aggregate
functions applied.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.show_where', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.show_where" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">show_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an approximate WHERE clause corresponding to the</span>
<span class="sd">    criteria specified in `self`. Note that the WHERE clause given</span>
<span class="sd">    is never explicitly used for performance reasons, but one hopes</span>
<span class="sd">    that it describes the criteria in `self`.</span>
<span class="sd">    If `aggregate` is `True`, then aggregate criteria for the</span>
<span class="sd">    `play` and `play_player` tables is shown with aggregate</span>
<span class="sd">    functions applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_where</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nfldb.Query.sort">
    <p>def <span class="ident">sort</span>(</p><p>self, exprs)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify sorting criteria for the result set returned by
using sort expressions. A sort expression is a tuple with
two elements: a field to sort by and the order to use. The
field should correspond to an attribute of the objects you're
returning and the order should be <code>asc</code> for ascending (smallest
to biggest) or <code>desc</code> for descending (biggest to smallest).</p>
<p>For example, <code>('passing_yds', 'desc')</code> would sort plays by the
number of passing yards in the play, with the biggest coming
first.</p>
<p>Remember that a sort field must be an attribute of the
results being returned. For example, you can't sort plays by
<code>home_score</code>, which is an attribute of a <a href="#nfldb.Game"><code>Game</code></a> object.
If you require this behavior, you will need to do it in Python
with its <code>sorted</code> built in function. (Or alternatively, use
two separate queries if the result set is large.)</p>
<p>You may provide multiple sort expressions. For example,
<code>[('gsis_id', 'asc'), ('time', 'asc'), ('play_id', 'asc')]</code>
would sort plays in the order in which they occurred within
each game.</p>
<p><code>exprs</code> may also just be a string specifying a single
field which defaults to a descending order. For example,
<code>sort('passing_yds')</code> sorts plays by passing yards in
descending order.</p>
<p>If <code>exprs</code> is set to the empty list, then sorting will be
disabled for this query.</p>
<p>Note that sorting criteria can be combined with
<a href="#nfldb.Query.limit"><code>limit</code></a> to limit results which can dramatically
speed up larger searches. For example, to fetch the top 10
passing plays in the 2012 season:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;passing_yds&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">p</span>
</pre></div>


<p>A more naive approach might be to fetch all plays and sort them
with Python:</p>
<div class="codehilite"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">.</span><span class="n">game</span><span class="p">(</span><span class="n">season_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span> <span class="n">season_type</span><span class="o">=</span><span class="s">&#39;Regular&#39;</span><span class="p">)</span>
<span class="n">plays</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">as_plays</span><span class="p">()</span>

<span class="n">plays</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">passing_yds</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plays</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">p</span>
</pre></div>


<p>But this is over <strong>43 times slower</strong> on my machine than using
<a href="#nfldb.Query.sort"><code>sort</code></a> and <a href="#nfldb.Query.limit"><code>limit</code></a>. (The performance
difference is due to making PostgreSQL perform the search and
restricting the number of results returned to process.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Query.sort', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Query.sort" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exprs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify sorting criteria for the result set returned by</span>
<span class="sd">    using sort expressions. A sort expression is a tuple with</span>
<span class="sd">    two elements: a field to sort by and the order to use. The</span>
<span class="sd">    field should correspond to an attribute of the objects you&#39;re</span>
<span class="sd">    returning and the order should be `asc` for ascending (smallest</span>
<span class="sd">    to biggest) or `desc` for descending (biggest to smallest).</span>
<span class="sd">    For example, `(&#39;passing_yds&#39;, &#39;desc&#39;)` would sort plays by the</span>
<span class="sd">    number of passing yards in the play, with the biggest coming</span>
<span class="sd">    first.</span>
<span class="sd">    Remember that a sort field must be an attribute of the</span>
<span class="sd">    results being returned. For example, you can&#39;t sort plays by</span>
<span class="sd">    `home_score`, which is an attribute of a `nfldb.Game` object.</span>
<span class="sd">    If you require this behavior, you will need to do it in Python</span>
<span class="sd">    with its `sorted` built in function. (Or alternatively, use</span>
<span class="sd">    two separate queries if the result set is large.)</span>
<span class="sd">    You may provide multiple sort expressions. For example,</span>
<span class="sd">    `[(&#39;gsis_id&#39;, &#39;asc&#39;), (&#39;time&#39;, &#39;asc&#39;), (&#39;play_id&#39;, &#39;asc&#39;)]`</span>
<span class="sd">    would sort plays in the order in which they occurred within</span>
<span class="sd">    each game.</span>
<span class="sd">    `exprs` may also just be a string specifying a single</span>
<span class="sd">    field which defaults to a descending order. For example,</span>
<span class="sd">    `sort(&#39;passing_yds&#39;)` sorts plays by passing yards in</span>
<span class="sd">    descending order.</span>
<span class="sd">    If `exprs` is set to the empty list, then sorting will be</span>
<span class="sd">    disabled for this query.</span>
<span class="sd">    Note that sorting criteria can be combined with</span>
<span class="sd">    `nfldb.Query.limit` to limit results which can dramatically</span>
<span class="sd">    speed up larger searches. For example, to fetch the top 10</span>
<span class="sd">    passing plays in the 2012 season:</span>
<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">        q.sort(&#39;passing_yds&#39;).limit(10)</span>
<span class="sd">        for p in q.as_plays():</span>
<span class="sd">            print p</span>
<span class="sd">    A more naive approach might be to fetch all plays and sort them</span>
<span class="sd">    with Python:</span>
<span class="sd">        #!python</span>
<span class="sd">        q = Query(db).game(season_year=2012, season_type=&#39;Regular&#39;)</span>
<span class="sd">        plays = q.as_plays()</span>
<span class="sd">        plays = sorted(plays, key=lambda p: p.passing_yds, reverse=True)</span>
<span class="sd">        for p in plays[:10]:</span>
<span class="sd">            print p</span>
<span class="sd">    But this is over **43 times slower** on my machine than using</span>
<span class="sd">    `nfldb.Query.sort` and `nfldb.Query.limit`. (The performance</span>
<span class="sd">    difference is due to making PostgreSQL perform the search and</span>
<span class="sd">    restricting the number of results returned to process.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sort_exprs</span> <span class="o">=</span> <span class="n">exprs</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Team" class="name">class <span class="ident">Team</span></p>
      
  
    <div class="desc"><p>Represents information about an NFL team. This includes its
standard three letter abbreviation, city and mascot name.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Team', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Team" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Team</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents information about an NFL team. This includes its</span>
<span class="sd">    standard three letter abbreviation, city and mascot name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># BUG: If multiple databases are used with different team information,</span>
    <span class="c"># this class won&#39;t behave correctly since it&#39;s using a global cache.</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;team_id&#39;</span><span class="p">,</span> <span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">__cache</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">abbr</span><span class="p">):</span>
        <span class="n">abbr</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">abbr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">abbr</span> <span class="ow">in</span> <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">[</span><span class="n">abbr</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">abbr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduces a new team given an abbreviation and a database</span>
<span class="sd">        connection. The database connection is used to retrieve other</span>
<span class="sd">        team information if it isn&#39;t cached already. The abbreviation</span>
<span class="sd">        given is passed to `nfldb.standard_team` for you.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;team_id&#39;</span><span class="p">):</span>
            <span class="c"># Loaded from cache.</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">abbr</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unique team identifier represented as its standard</span>
<span class="sd">        2 or 3 letter abbreviation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The city where this team resides.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The full &quot;mascot&quot; name of this team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT * FROM team WHERE team_id = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,))</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__conform__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="ow">is</span> <span class="n">ISQLQuote</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AsIs</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Team">Team</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nfldb.Team.city" class="name">var <span class="ident">city</span></p>
            

            
  
    <div class="desc"><p>The city where this team resides.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Team.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>The full "mascot" name of this team.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nfldb.Team.team_id" class="name">var <span class="ident">team_id</span></p>
            

            
  
    <div class="desc"><p>The unique team identifier represented as its standard
2 or 3 letter abbreviation.</p></div>
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Team.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db, abbr)</p>
    </div>
    

    
  
    <div class="desc"><p>Introduces a new team given an abbreviation and a database
connection. The database connection is used to retrieve other
team information if it isn't cached already. The abbreviation
given is passed to <a href="#nfldb.standard_team"><code>standard_team</code></a> for you.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Team.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Team.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">abbr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Introduces a new team given an abbreviation and a database</span>
<span class="sd">    connection. The database connection is used to retrieve other</span>
<span class="sd">    team information if it isn&#39;t cached already. The abbreviation</span>
<span class="sd">    given is passed to `nfldb.standard_team` for you.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;team_id&#39;</span><span class="p">):</span>
        <span class="c"># Loaded from cache.</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span> <span class="o">=</span> <span class="n">nfldb</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">standard_team</span><span class="p">(</span><span class="n">abbr</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The unique team identifier represented as its standard</span>
<span class="sd">    2 or 3 letter abbreviation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The city where this team resides.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The full &quot;mascot&quot; name of this team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT * FROM team WHERE team_id = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,))</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">Team</span><span class="o">.</span><span class="n">__cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nfldb.Tx" class="name">class <span class="ident">Tx</span></p>
      
  
    <div class="desc"><p>Tx is a <code>with</code> compatible class that abstracts a transaction given
a connection. If an exception occurs inside the <code>with</code> block, then
rollback is automatically called. Otherwise, upon exit of the with
block, commit is called.</p>
<p>Tx blocks can be nested inside other Tx blocks. Nested Tx blocks
never commit or rollback a transaction. Instead, the exception is
passed along to the caller. Only the outermost transaction will
commit or rollback the entire transaction.</p>
<p>Use it like so:</p>
<div class="codehilite"><pre><span class="k">with</span> <span class="n">Tx</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>


<p>Which is meant to be roughly equivalent to the following:</p>
<div class="codehilite"><pre><span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">curs</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>


<p>This should only be used when you're running SQL queries directly.
(Or when interfacing with another part of the API that requires
a database cursor.)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Tx', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Tx" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Tx</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tx is a `with` compatible class that abstracts a transaction given</span>
<span class="sd">    a connection. If an exception occurs inside the `with` block, then</span>
<span class="sd">    rollback is automatically called. Otherwise, upon exit of the with</span>
<span class="sd">    block, commit is called.</span>

<span class="sd">    Tx blocks can be nested inside other Tx blocks. Nested Tx blocks</span>
<span class="sd">    never commit or rollback a transaction. Instead, the exception is</span>
<span class="sd">    passed along to the caller. Only the outermost transaction will</span>
<span class="sd">    commit or rollback the entire transaction.</span>

<span class="sd">    Use it like so:</span>

<span class="sd">        #!python</span>
<span class="sd">        with Tx(conn) as cursor:</span>
<span class="sd">            ...</span>

<span class="sd">    Which is meant to be roughly equivalent to the following:</span>

<span class="sd">        #!python</span>
<span class="sd">        with conn:</span>
<span class="sd">            with conn.cursor() as curs:</span>
<span class="sd">                ...</span>

<span class="sd">    This should only be used when you&#39;re running SQL queries directly.</span>
<span class="sd">    (Or when interfacing with another part of the API that requires</span>
<span class="sd">    a database cursor.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psycho_conn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `psycho_conn` is a DB connection returned from `nfldb.connect`,</span>
<span class="sd">        `name` is passed as the `name` argument to the cursor</span>
<span class="sd">        constructor (for server-side cursors), and `factory` is passed</span>
<span class="sd">        as the `cursor_factory` parameter to the cursor constructor.</span>

<span class="sd">        Note that the default cursor factory is</span>
<span class="sd">        `psycopg2.extras.RealDictCursor`. However, using</span>
<span class="sd">        `psycopg2.extensions.cursor` (the default tuple cursor) can be</span>
<span class="sd">        much more efficient when fetching large result sets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tstatus</span> <span class="o">=</span> <span class="n">psycho_conn</span><span class="o">.</span><span class="n">get_transaction_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nested</span> <span class="o">=</span> <span class="n">tstatus</span> <span class="o">==</span> <span class="n">TRANSACTION_STATUS_INTRANS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span> <span class="o">=</span> <span class="n">psycho_conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="o">=</span> <span class="n">RealDictCursor</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No biscuits for the psycopg2 author. Changed the public API in</span>
        <span class="c"># 2.5 in a very very subtle way.</span>
        <span class="c"># In 2.4, apparently `name` cannot be `None`. Why? I don&#39;t know.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__factory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span>

        <span class="k">if</span> <span class="n">_SHOW_QUERIES</span><span class="p">:</span>
            <span class="k">class</span> <span class="nc">_</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="k">global</span> <span class="n">_NUM_QUERIES</span>

                    <span class="n">_NUM_QUERIES</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nested</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nested</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nfldb.Tx">Tx</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nfldb.Tx.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, psycho_conn, name=None, factory=None)</p>
    </div>
    

    
  
    <div class="desc"><p><code>psycho_conn</code> is a DB connection returned from <a href="#nfldb.connect"><code>connect</code></a>,
<code>name</code> is passed as the <code>name</code> argument to the cursor
constructor (for server-side cursors), and <code>factory</code> is passed
as the <code>cursor_factory</code> parameter to the cursor constructor.</p>
<p>Note that the default cursor factory is
<code>psycopg2.extras.RealDictCursor</code>. However, using
<code>psycopg2.extensions.cursor</code> (the default tuple cursor) can be
much more efficient when fetching large result sets.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nfldb.Tx.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nfldb.Tx.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psycho_conn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `psycho_conn` is a DB connection returned from `nfldb.connect`,</span>
<span class="sd">    `name` is passed as the `name` argument to the cursor</span>
<span class="sd">    constructor (for server-side cursors), and `factory` is passed</span>
<span class="sd">    as the `cursor_factory` parameter to the cursor constructor.</span>
<span class="sd">    Note that the default cursor factory is</span>
<span class="sd">    `psycopg2.extras.RealDictCursor`. However, using</span>
<span class="sd">    `psycopg2.extensions.cursor` (the default tuple cursor) can be</span>
<span class="sd">    much more efficient when fetching large result sets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tstatus</span> <span class="o">=</span> <span class="n">psycho_conn</span><span class="o">.</span><span class="n">get_transaction_status</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__nested</span> <span class="o">=</span> <span class="n">tstatus</span> <span class="o">==</span> <span class="n">TRANSACTION_STATUS_INTRANS</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span> <span class="o">=</span> <span class="n">psycho_conn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="o">=</span> <span class="n">factory</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__factory</span> <span class="o">=</span> <span class="n">RealDictCursor</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
